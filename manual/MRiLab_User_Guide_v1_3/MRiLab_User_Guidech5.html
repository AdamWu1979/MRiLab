<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" 
"http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd" > 
<html> 
<head><title>5 MRiLab Toolboxes</title> 
<meta charset="UTF-8" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<link rel="stylesheet" type="text/css" href="MRiLab_User_Guide.css" /> 
<script src="mathjax-config.js"></script> 
<script type="text/javascript" 
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" 
></script> 
<style type="text/css"> 
.MathJax_MathML {text-indent: 0;} 
</style> 
</head><body 
>
   <!--l. 918--><div class="crosslinks"><p class="noindent">[<a 
href="MRiLab_User_Guidech6.html" >next</a>] [<a 
href="MRiLab_User_Guidech4.html" >prev</a>] [<a 
href="MRiLab_User_Guidech4.html#tailMRiLab_User_Guidech4.html" >prev-tail</a>] [<a 
href="#tailMRiLab_User_Guidech5.html">tail</a>] [<a 
href="MRiLab_User_Guide3.html#MRiLab_User_Guidech5.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;5</span><br /><a 
 id="x10-400005"></a>MRiLab Toolboxes</h2>
<!--l. 920--><p class="noindent" >MRiLab toolboxes consists of several individual GUIs for conducting design task for
RF pulse, MR sequence and Coil etc. These toolboxes allow to build and customize
project specific MR simulation experiment. This chapter covers the introduction to
each toolbox and corresponding macro libraries.
</p>
   <h3 class="sectionHead"><span class="titlemark">5.1   </span> <a 
 id="x10-410005.1"></a>RF Pulse Design</h3>
<!--l. 924--><p class="noindent" >The RF pulse design toolbox can be activated by pressing &#8216;RF Design Panel&#8217; toolbar
icon located at the top of the main simulation console.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-410011"></a>


<!--l. 928--><p class="noindent" ><img 
src="Pictures/RFDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.1: </span><span  
class="content">RF Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-410011 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.1.1   </span> <a 
 id="x10-420005.1.1"></a>RF Design GUI</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-420012"></a>


<!--l. 937--><p class="noindent" ><img 
src="Pictures/RFDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.2: </span><span  
class="content">RF Design Panel. An example of simulating the slice profile of a
linear phase Shinnar-Le Roux RF pulse.</span></div><!--tex4ht:label?: x10-420012 -->

   </div><hr class="endfigure" />
<!--l. 942--><p class="indent" >   Figure <a 
href="#x10-420012">5.2<!--tex4ht:ref: fig:RFDesignGUI --></a> demonstrates an overview of the RF Pulse Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-42003x1">RF and Gradient Pulse Macro Library <br 
class="newline" />
     <!--l. 948--><p class="noindent" >The user can use this interface to analyze tissue spin response regarding
     a selected RF and gradient pulse. To select a RF pulse macro, the user
     needs to click the macro library tree to unfold the tree structure, and then
     click a desired RF macro. The properties of the chosen RF macro will
     show on the left panel under &#8216;rf:rf name&#8217; tab. The RF memo information is
     also shown at the &#8216;rf Memo&#8217; panel below the tree structure. The user can
     press &#8216;Execute&#8217; button to start analysis process. MRiLab supports three
     analysis modes for analyzing 1D spatial RF pulse, 2D spatial RF pulse
     and Spatial-Spectral RF pulse:
</p>
         <ul class="itemize1">
         <li class="itemize">1D Spatial Mode
         <!--l. 953--><p class="noindent" >MRiLab assumes a gradient is applied in the Z direction, therefore a
         constant gradient will be applied if &#8216;Gz&#8217; tab is empty (Figure <a 
href="#x10-420043">5.3<!--tex4ht:ref: fig:ConstantGradient --></a>). To
         select a &#8216;Gz&#8217; gradient, the user needs to choose a gradient macro under
         &#8216;GzSS&#8217;. For example, the &#8216;GzSelective&#8217; is a recommended gradient
         macro typically used for performing slice selection in MRiLab. Once
         the user selected a gradient macro, the &#8216;Gz:gradient name&#8217; tab will
         become activated and the properties of this gradient macro become
         accessible and editable. The user can modify macro attributes to meet
         design goals. To make any modification effective, the user must press
         &#8216;Update&#8217; button before executing the slice profile analysis. Although
         the library tree contains macros for another gradient line (e.g. GyPE,
         GxR), they are typically ignored in this mode.
         </p></li>
         <li class="itemize">2D Spatial Mode
         <!--l. 956--><p class="noindent" >MRiLab assumes a gradient is applied in both the X and Y directions,
         a constant gradient will be applied if &#8216;Gx&#8217; tab or &#8216;Gy&#8217; tab is empty.
         The user can choose any Gx and Gy gradient macros for these two
         tabs and modify macro attributes to satisfy 2D RF pulse design. To
         activate 2D pulse analysis, the &#8216;Spat_Flag&#8217; under &#8216;XSpatial&#8217; tab has
         to be turned on (<a 
href="#x10-420203">4c<!--tex4ht:ref: it:XSpatial --></a>). The Gz gradient is typically ignored under this
         mode.
         </p></li>
         <li class="itemize">Spatial-Spectral Mode
         <!--l. 960--><p class="noindent" >MRiLab assumes a gradient is applied in the Z direction, a constant
         gradient will be applied if &#8216;Gz&#8217; tab is empty. The user can choose

         any Gz gradient macros for this tab and modify macro attributes to
         satisfy Spatial-Spectral pulse design. The user can also modify the
         frequency range and resolution under &#8216;Spectral&#8217; tab (<a 
href="#x10-420245">4e<!--tex4ht:ref: it:Spectral --></a>). To activate
         Spatial-Spectral pulse analysis, the &#8216;Freq_Flag&#8217; has to be turned on
         (<a 
href="#x10-420245">4e<!--tex4ht:ref: it:Spectral --></a>). The Gx and Gy gradient are typically ignored under this mode.
</p>
         </li></ul>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420043"></a>   <img 
src="Pictures/ConstantGradient.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.3: </span><span  
class="content">A Warning Window for Using Constant Gradient</span></div><!--tex4ht:label?: x10-420043 -->
     </div><hr class="endfigure" />
     </li>
     <li 
  class="enumerate" id="x10-42006x2">Spin Response <br 
class="newline" />
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420074"></a>   <img 
src="Pictures/SliceProfile.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.4: </span><span  
class="content">A Slice Profile Analysis of A linear phase SLR Pulse</span></div><!--tex4ht:label?: x10-420074 -->
     </div><hr class="endfigure" />
     <!--l. 980--><p class="noindent" >Under 1D Spatial Mode, MRiLab provides three slice profile figures (Figure <a 
href="#x10-420074">5.4<!--tex4ht:ref: fig:SliceProfile --></a>)
     on the &#8216;Spin Response&#8217; panel under different tabs. These figures include slice
     profile regarding
</p>
         <ul class="itemize1">
         <li class="itemize">Mx My Mz : three independent spin component
         </li>
         <li class="itemize"><!--l. 984--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo></math>Mxy<!--l. 984--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo></math>
         Mz : transverse and longitudinal component
         </li>
         <li class="itemize">Mg Pe : transverse component magnitude and phase</li></ul>
     <!--l. 988--><p class="noindent" >The horizontal axis is the spin position in units of meters, and the vertical axis
     is the value of the components in normalized units. <br 
class="newline" />
     </p><!--l. 990--><p class="noindent" >Under 2D Spatial or Spatial-Spectral Mode, MRiLab provides five spin
     response figures on the &#8216;Spin Response&#8217; panel under different tabs. These
     figures include
</p>
         <ul class="itemize1">
         <li class="itemize">Mx : spin X component
         </li>
         <li class="itemize">My : spin Y component

         </li>
         <li class="itemize">Mz : spin Z component
         </li>
         <li class="itemize">Mag : transverse component magnitude
         </li>
         <li class="itemize">Ph : transverse component phase</li></ul>
     <!--l. 1000--><p class="noindent" >The horizontal axis is the spin position for 2D Spatial mode and the frequency
     range for Spatial-Spectral mode, and the vertical axis is the spin location in
     both mode. Notice the units of both axes use spin index for either spatial
     position or frequency position according to spin property and environment (<a 
href="#x10-420203">4c<!--tex4ht:ref: it:XSpatial --></a>,
     <a 
href="#x10-420224">4d<!--tex4ht:ref: it:YSpatial --></a> and <a 
href="#x10-420245">4e<!--tex4ht:ref: it:Spectral --></a>).
     </p><!--l. 1002--><p class="noindent" >MRiLab also plots the RF and gradient waveform. In MRiLab, the
     property of a RF pulse contains RF amplitude (T), RF phase (rad) and
     RF frequency (Hz). The RF frequency is defined as the spin Larmor
     frequency minus the laboratory frequency of the RF pulse. Notice
     that in those figures, for display purpose, the gradient amplitude is in
     units of G/cm and RF amplitude is in units of G. Both time axes are
     in units of milliseconds. At the bottom of this interface, there is a
     group of pushbuttons (Figure <a 
href="#x10-420085">5.5<!--tex4ht:ref: fig:PlaybackButtonGroup --></a>) allowing the user to investigate
     intermediate spin response during a applied RF and gradient (Figure
     <a 
href="#x10-420096">5.6<!--tex4ht:ref: fig:SliceProfileAtMiddle --></a>).
</p>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420085"></a>   <img 
src="Pictures/PlaybackButtonGroup.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.5: </span><span  
class="content">The Playback Control Group for Spin Response</span></div><!--tex4ht:label?: x10-420085 -->
     </div><hr class="endfigure" />
         <ul class="itemize1">
         <li class="itemize">Scroll  Bar  :  Drag  the  scroll  bar  to  any  intermediate  time  point
         between beginning and end
         </li>
         <li class="itemize"><!--l. 1013--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">&#x003C;</mo></math>
         : Move to the beginning
         </li>
         <li class="itemize">X : Pause animation, notice that the interface can only be closed
         while animation is paused
         </li>
         <li class="itemize">O : Resume animation
         </li>
         <li class="itemize"><!--l. 1016--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo></math>
         : Play at normal speed
         </li>
         <li class="itemize"><!--l. 1017--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo><mo 
class="MathClass-rel">&#x003E;</mo></math>
         : Play at double normal speed

         </li>
         <li class="itemize"><!--l. 1018--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo> <mo 
class="MathClass-rel">|</mo></math>
         : Move to the end</li></ul>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420096"></a>   <img 
src="Pictures/SliceProfileAtMiddle.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.6: </span><span  
class="content">An Intermediate Slice Profile in The Middle of RF Pulse</span></div><!--tex4ht:label?: x10-420096 -->
     </div><hr class="endfigure" />
     </li>
     <li 
  class="enumerate" id="x10-42011x3">3D Spin Response <br 
class="newline" />
     <!--l. 1030--><p class="noindent" >MRiLab renders 3D spin response in &#8216;3D Spin Response&#8217; panel based on
     different modes. The user can inspect the behavior of spins at specific location
     under a chosen RF pulse and gradient. The user can use Matlab default
     graphical tools for interactively changing display view and size (Figure <a 
href="#x10-420138">5.8<!--tex4ht:ref: fig:MatlabDefaultTools --></a>). To
     change three-dimensional spin response content reflecting different tabs in 2D
     spatial mode or Spatial-Spectral model (Figure <a 
href="#x10-420127">5.7<!--tex4ht:ref: fig:SpatialSpectral --></a>), the trick is to simply
     activate any item of the playback control group (e.g. click the scroll
     bar).
</p>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420127"></a>   <img 
src="Pictures/SpatialSpectral.png" alt="pict"  
 />
<br />  <div class="caption" 
><span class="id">Figure&#x00A0;5.7:   </span><span  
class="content">The   Magnitude   of   Spin   Transverse   Component   from   A
Spatial-Spectral Analysis of An Inversion Adiabatic rf Pulse</span></div><!--tex4ht:label?: x10-420127 -->
     </div><hr class="endfigure" />
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420138"></a>   <img 
src="Pictures/MatlabDefaultTools.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.8: </span><span  
class="content">Matlab Default Graphical Tools</span></div><!--tex4ht:label?: x10-420138 -->
     </div><hr class="endfigure" />
     </li>
     <li 
  class="enumerate" id="x10-42015x4">Spin Property and Environment <br 
class="newline" />
     <!--l. 1048--><p class="noindent" >The user can modify spin properties and environment to satisfy specific
     experiment design. The editable properties provided in this interface
     include:
         </p><ol  class="enumerate2" >
         <li 
  class="enumerate" id="x10-42017x1">Spin
             <ul class="itemize1">
             <li class="itemize">ChemShift (Hz/T): The chemical shift of the spin
             </li>
             <li class="itemize">Gyro (rad/s/T): The gyromagnetic ratio of the spin
             </li>
             <li class="itemize">Rho : The spin density of the spin

             </li>
             <li class="itemize">T1 (s): The longitudinal relaxation time
             </li>
             <li class="itemize">T2 (s): The transverse relaxation time
             </li>
             <li class="itemize">TypeNum : The number of spin species</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42019x2">ZSpatial <a 
 id="x10-420182"></a>
             <ul class="itemize1">
             <li class="itemize">ZCenter : The index of the centeral spin in Z direction
             </li>
             <li class="itemize">ZSpin : The number of the spins in Z direction
             </li>
             <li class="itemize">ZSpinGap  (m):  The  distance  between  adjacent  spins  in  Z
             direction</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42021x3">XSpatial <a 
 id="x10-420203"></a>
             <ul class="itemize1">
             <li class="itemize">XCenter : The index of the centeral spin in X direction
             </li>
             <li class="itemize">XSpin : The number of the spins in X direction
             </li>
             <li class="itemize">XSpinGap  (m):  The  distance  between  adjacent  spins  in  X
             direction
             </li>
             <li class="itemize">Spat_Flag: The flag to turn on and off 2D spatial RF analysis</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42023x4">YSpatial <a 
 id="x10-420224"></a>
             <ul class="itemize1">
             <li class="itemize">YCenter : The index of the centeral spin in Y direction
             </li>
             <li class="itemize">YSpin : The number of the spins in Y direction
             </li>
             <li class="itemize">YSpinGap  (m):  The  distance  between  adjacent  spins  in  Y
             direction</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42025x5">Spectral <a 
 id="x10-420245"></a>
             <ul class="itemize1">
             <li class="itemize">FreqRes : The number of linear frequency sample points
             </li>
             <li class="itemize">FreqUpLimit : The upper limit of frequency range

             </li>
             <li class="itemize">FreqDownLimit : The lower limit of frequency range
             </li>
             <li class="itemize">Freq_Flag:  The  flag  to  turn  on  and  off  Spatial-Spectral  RF
             analysis</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42027x6">Gradient
             <ul class="itemize1">
             <li class="itemize">ConstantGrad  (T/m):  The  constant  gradient  applied  when
             gradient tab is empty</li></ul>
         </li>
         <li 
  class="enumerate" id="x10-42029x7">Magnet
             <ul class="itemize1">
             <li class="itemize">dB0 (T): The main static magnetic field offset</li></ul>
         </li></ol>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-420309"></a>   <img 
src="Pictures/SliceProfileTwoSpecies.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.9: </span><span  
class="content">A Slice Profile Analysis of Two Spin Species</span></div><!--tex4ht:label?: x10-420309 -->
     </div><hr class="endfigure" />
     <!--l. 1116--><p class="noindent" >Figure <a 
href="#x10-420309">5.9<!--tex4ht:ref: fig:SliceProfileTwoSpecies --></a> demonstrates a slice profile for two different spin species under the
     same RF pulse and gradient in 1D spatial mode. To enable slice profile
     analysis for multiple spin species, the user needs to provide multiple
     values for T1, T2, Rho and ChemShift in an array, and give the correct
     number of spin species. The values must be separated with space. For
     example
</p>
         <ul class="itemize1">
         <li class="itemize">ChemShift = 0 -210
         </li>
         <li class="itemize">Rho = 1.0 0.5
         </li>
         <li class="itemize">T1 = 1.2 1.0
         </li>
         <li class="itemize">T2 = 0.02 0.03
         </li>
         <li class="itemize">TypeNum = 2</li></ul>
     </li></ol>

   <h4 class="subsectionHead"><span class="titlemark">5.1.2   </span> <a 
 id="x10-430005.1.2"></a>RF Macro Library</h4>
<!--l. 1130--><p class="noindent" >MRiLab uses a concept of macros to simplify experiment design. A RF macro is a
predefined module for one type of RF pulse which allows flexible programming-free
modification for specific experimental design. MRiLab RF macro library is a
collection of RF macros covering from simple RF pulses such as hard pulse, to
complex RF pulses such as adiabatic pulses. A specific RF macro to interact with
external RF pulse file is also provided to create more extensible pulse design
environment. This section will give an introduction to each of the RF macros
provided in MRiLab.
</p><!--l. 1132--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-440005.1.2"></a>rfSinc</h5>
<!--l. 1134--><p class="noindent" >A RF macro that creates a Sinc type RF pulse. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">Apod : Apodization methods including &#8216;Non&#8217;, &#8216;Hamming&#8217; and &#8216;Hanning&#8217;
     </li>
     <li class="itemize">FA (Degree) : Prescribed flip angle
     </li>
     <li class="itemize">TBP : The time bandwidth product
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on

     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1153--><p class="indent" >   The time dependence of the Sinc RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-44001r1"></a>
<!--l. 1155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation"><msub><mrow 
>
<mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mi 
>A</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mfrac><mrow 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mi 
>&#x03C0;</mi><mi 
>t</mi></mrow>
<mrow 
><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow></mrow> 
    <mrow 
><mi 
>&#x03C0;</mi><mi 
>t</mi></mrow></mfrac>   <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>L</mi></mrow></msub 
><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>R</mi></mrow></msub 
><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mn>0</mn>             <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mstyle 
class="text"><mtext  >elsewhere</mtext></mstyle>             </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                               </mrow></mfenced>
</math></td><td class="eq-no">(5.1)</td></tr></table>
<!--l. 1164--><p class="indent" >   where <!--l. 1164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
is the peak RF amplitude automatically calculated and scaled according to flip angle,
<!--l. 1164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is one-half the width of
the central lobe, and the <!--l. 1164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>L</mi></mrow></msub 
></math>
and <!--l. 1164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>R</mi></mrow></msub 
></math> are the
number of zero-crossings to the left and right of the central peak, respectively. In MRiLab,
the <!--l. 1164--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>L</mi></mrow></msub 
> <mo 
class="MathClass-rel">&#x2261;</mo> <msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>R</mi></mrow></msub 
></math>,
thus the Sinc RF pulse is always symmetric. Notice that the The time bandwidth
product of a Sinc pulse equals the number of zero-crossings including the
start and end. In order to address the discontinuity at the start and end,
apodization can be applied using &#8216;Hamming&#8217; or &#8216;Hanning&#8217; window as described
by:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-44002r2"></a>

<!--l. 1166--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mi 
>p</mi><mi 
>o</mi><mi 
>d</mi><mi 
>i</mi><mi 
>z</mi><mi 
>a</mi><mi 
>t</mi><mi 
>i</mi><mi 
>o</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mrow ><mo 
class="MathClass-open">(</mo><mrow><mn>1</mn> <mo 
class="MathClass-bin">-</mo> <mi 
>&#x03B1;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-bin">+</mo> <mi 
>&#x03B1;</mi><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow> <mfrac><mrow 
><mi 
>&#x03C0;</mi><mi 
>t</mi></mrow>
<mrow 
><mi 
>N</mi><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>L</mi></mrow></msub 
><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>R</mi></mrow></msub 
><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mn>0</mn>                          <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mstyle 
class="text"><mtext  >elsewhere</mtext></mstyle>             </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                   </mrow></mfenced>
</math></td><td class="eq-no">(5.2)</td></tr></table>
<!--l. 1175--><p class="indent" >   where <!--l. 1175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>N</mi></math>
equals <!--l. 1175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>L</mi></mrow></msub 
></math> and
<!--l. 1175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>N</mi></mrow><mrow 
><mi 
>R</mi></mrow></msub 
></math>. Hamming window
uses <!--l. 1175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B1;</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn><mo 
class="MathClass-punc">.</mo><mn>4</mn><mn>6</mn></math>, and Hanning
window uses <!--l. 1175--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B1;</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn><mo 
class="MathClass-punc">.</mo><mn>5</mn></math>.
If &#8216;Non&#8217; is used, apodization is disabled.
</p><!--l. 1177--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-450005.1.2"></a>rfRect</h5>
<!--l. 1179--><p class="noindent" >A RF macro that creates a hard RF pulse. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">FA (Degree) : Prescribed flip angle
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on

     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1197--><p class="indent" >   The time dependence of the hard RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-45001r3"></a>
<!--l. 1199--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation"><msub><mrow 
>
<mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mi 
>A</mi><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-rel">|</mo><mi 
>t</mi><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">&#x2264;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac> </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mn>0</mn>  <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-rel">|</mo><mi 
>t</mi><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">&#x003E;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac> </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                                                                                 </mrow></mfenced>
</math></td><td class="eq-no">(5.3)</td></tr></table>
<!--l. 1208--><p class="indent" >   where <!--l. 1208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
is the peak RF amplitude automatically calculated and scaled according to flip angle,
<!--l. 1208--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math> is the
width of RF pulse that equals tEnd-tStart.
</p><!--l. 1210--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-460005.1.2"></a>rfGaussian</h5>
<!--l. 1212--><p class="noindent" >A RF macro that creates a Gaussian type RF pulse. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">FA (Degree) : Prescribed flip angle
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points

     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1229--><p class="indent" >   The time dependence of the Gaussian RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-46001r4"></a>
<!--l. 1231--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                 <mspace width="1em" class="nbsp" /><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mi 
>A</mi><msup><mrow 
><mi 
>e</mi></mrow><mrow 
><mo 
class="MathClass-bin">-</mo> <mfrac><mrow 
><msup><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>2</mn></mrow></msup 
></mrow> 
<mrow 
><mn>2</mn><msup><mrow 
><mi 
>&#x03C3;</mi></mrow><mrow 
><mn>2</mn></mrow></msup 
></mrow></mfrac> </mrow></msup 
><mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >pulse&#x00A0;centered&#x00A0;at&#x00A0;</mtext></mstyle><mi 
>t</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn>
</math></td><td class="eq-no">(5.4)</td></tr></table>

<!--l. 1236--><p class="indent" >   where <!--l. 1236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
is the peak RF amplitude automatically calculated and scaled according to flip angle,
<!--l. 1236--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03C3;</mi></math> is
linearly proportional to the pulse width. Also the Gaussian RF pulse is terminated
with a 60-dB attenuation.
</p><!--l. 1238--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-470005.1.2"></a>rfFermi</h5>
<!--l. 1240--><p class="noindent" >A RF macro that creates a Fermi RF pulse. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">PW : The measure of the pulse width
     </li>
     <li class="itemize">FA (Degree) : Prescribed flip angle
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates

     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1258--><p class="indent" >   The time dependence of the Fermi RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-47001r5"></a>
<!--l. 1260--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
               <mspace width="1em" class="nbsp" /><msub><mrow 
><mi 
>B</mi></mrow><mrow 
><mn>1</mn></mrow></msub 
><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>       <mfrac><mrow 
><mi 
>A</mi></mrow> 
<mrow 
><mn>1</mn> <mo 
class="MathClass-bin">+</mo> <msup><mrow 
><mi 
>e</mi></mrow><mrow 
><mfrac><mrow 
><mo 
class="MathClass-rel">|</mo><mi 
>t</mi><mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></mrow> 
   <mrow 
><mi 
>&#x03B1;</mi></mrow></mfrac>   </mrow></msup 
></mrow></mfrac><mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >pulse&#x00A0;centered&#x00A0;at&#x00A0;</mtext></mstyle><mi 
>t</mi> <mo 
class="MathClass-rel">=</mo> <mn>0</mn>
</math></td><td class="eq-no">(5.5)</td></tr></table>
<!--l. 1265--><p class="indent" >   where <!--l. 1265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>A</mi></math>
is the peak RF amplitude automatically calculated and scaled according to flip angle,
<!--l. 1265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is a measure of the pulse width that corresponds to PW,
<!--l. 1265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B1;</mi></math> is a
measure of the transition width. The Fermi pulse approximates more to a rectangle pulse
with larger <!--l. 1265--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>t</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
value. Also the Fermi RF pulse is terminated with a 60-dB attenuation.
</p><!--l. 1267--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-480005.1.2"></a>rfSLR</h5>
<!--l. 1269--><p class="noindent" >A RF macro that creates a RF pulse using Shinnar-Le Roux algorithm. This macro
contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">PulseType : The type of this SLR pulse, including &#8216;st&#8217; (small tip angle
     pulse),  &#8216;ex&#8217;  (excitation  pulse),  &#8216;se&#8217;  (spin-echo  pulse),  &#8216;sat&#8217;  (saturation
     pulse) and &#8216;inv&#8217; (inversion pulse)

     </li>
     <li class="itemize">FilterType : The type of the applied filter design method, including &#8216;ls&#8217;
     (least squares), &#8216;min&#8217; (minimum phase), &#8216;max&#8217; (maximum phase), &#8216;pm&#8217;
     (Parks-McClellan equal ripple), and &#8216;ms&#8217; (Hamming windowed sinc)
     </li>
     <li class="itemize">PRipple : The ripple factor at passband
     </li>
     <li class="itemize">SRipple : The ripple factor at stopband
     </li>
     <li class="itemize">FA (Degree) : Prescribed flip angle
     </li>
     <li class="itemize">TBP : The time bandwidth product
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting

     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1291--><p class="indent" >   MRiLab implements a library of Matlab SLR pulse design routines,
originally developed by Prof. John Pauly and published online at
<a 
href="http://rsl.stanford.edu/research/software.html" class="url" ><span 
class="cmtt-10">http://rsl.stanford.edu/research/software.html</span></a>. Thorough explanation of the
algorithm is beyond the scope of this manual, users who are interested in the SLR
algorithm are referred to literature <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>,&#x00A0;<a 
href="MRiLab_User_Guideli3.html#XPauly1991">7</a>]</span>.
</p><!--l. 1294--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-490005.1.2"></a>rfHyperbolicSecant</h5>
<!--l. 1296--><p class="noindent" >A RF macro that creates an adiabatic inversion RF pulse based on hyperbolic secant
modulation. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">Adiab : The adiabatic factor
     </li>
     <li class="itemize">MaxB1 (T) : The maximum B1 field
     </li>
     <li class="itemize">TBP : The time bandwidth product
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape

     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1314--><p class="indent" >   The time dependence of the hyperbolic secant RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-49001r6"></a>
<!--l. 1316--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mspace width="1em" class="nbsp" /><mtable 
class="aligned"><mtr 
><mtd columnalign="right" ><mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>e</mi><mi 
>c</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >amplitude&#x00A0;modulation&#x00A0;</mtext></mstyle></mtd>
</mtr><mtr 
><mtd columnalign="right" ><mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
> <mo 
class="MathClass-bin">-</mo> <mi 
>&#x03BC;</mi><mi 
>&#x03B2;</mi></mrow> 
  <mrow 
><mn>2</mn><mi 
>&#x03C0;</mi></mrow></mfrac>  <mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >frequency&#x00A0;modulation&#x00A0;</mtext></mstyle></mtd><mtd columnalign="left" ></mtd>
</mtr><mtr 
><mtd columnalign="right" ></mtd>
   </mtr>                                                               </mtable>
</math></td><td class="eq-no">(5.6)</td></tr></table>
<!--l. 1324--><p class="indent" >   where <!--l. 1324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03BC;</mi></math>
is a dimensionless adiabatic factor corresponding to Adiab,
<!--l. 1324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B2;</mi></math> is an
modulation angular frequency. It can be shown that TBP has the relationship with
<!--l. 1324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B2;</mi></math> and
<!--l. 1324--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03BC;</mi></math>
as
</p>
   <table class="equation"><tr><td> <a 
 id="x10-49002r7"></a>

<!--l. 1326--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                           <mspace width="1em" class="nbsp" /><mi 
>T</mi><mi 
>B</mi><mi 
>P</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>T</mi><mi 
>&#x03BC;</mi><mi 
>&#x03B2;</mi></mrow> 
  <mrow 
><mi 
>&#x03C0;</mi></mrow></mfrac>
</math></td><td class="eq-no">(5.7)</td></tr></table>
<!--l. 1331--><p class="indent" >   where <!--l. 1331--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>
is the pulse width.
</p><!--l. 1333--><p class="indent" >   To satisfy the Adiabatic Condition, the parameter setting has to meet
</p>
   <table class="equation"><tr><td> <a 
 id="x10-49003r8"></a>
<!--l. 1335--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                            <mspace width="1em" class="nbsp" /><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
> <mo 
class="MathClass-rel">&#x226B;</mo> <mfrac><mrow 
><msqrt><mrow><mi 
>&#x03BC;</mi></mrow></msqrt><mi 
>&#x03B2;</mi></mrow> 
  <mrow 
><mi 
>&#x03B3;</mi></mrow></mfrac>
</math></td><td class="eq-no">(5.8)</td></tr></table>
<!--l. 1340--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-500005.1.2"></a>rfTanhTan</h5>
<!--l. 1342--><p class="noindent" >A RF macro that creates an adiabatic inversion RF pulse based on tanh/tan
modulation. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">MaxB1 (T) : The maximum B1 field
     </li>
     <li class="itemize">TBP : The time bandwidth product
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time

     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1359--><p class="indent" >   The tanh/tan RF pulse is constructed from an adiabatic half passage and its
time-reversed adiabatic half passage. The time dependence of the first adiabatic half
passage is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHwang1998">8</a>]</span>:
</p>
   <table class="equation"><tr><td> <a 
 id="x10-50001r9"></a>
<!--l. 1361--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mspace width="1em" class="nbsp" /><mtable 
class="aligned"><mtr 
><mtd columnalign="right" ><mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mi 
>&#x03B3;</mi><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>2</mn><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow>
 <mrow 
><mi 
>T</mi></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac> <mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >amplitude&#x00A0;modulation&#x00A0;</mtext></mstyle></mtd>
</mtr><mtr 
><mtd columnalign="right" ><mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mi 
>A</mi><mfrac><mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BA;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mn>1</mn> <mo 
class="MathClass-bin">-</mo><mfrac><mrow 
><mn>2</mn><mi 
>t</mi></mrow> 
<mrow 
><mi 
>T</mi></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow>
    <mrow 
><mn>2</mn><mi 
>&#x03C0;</mi><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BA;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow></mfrac>    <mspace width="1em" class="quad"/><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac> <mspace width="1em" class="quad"/><mstyle 
class="text"><mtext  >frequency&#x00A0;modulation&#x00A0;</mtext></mstyle></mtd><mtd columnalign="left" ></mtd>
</mtr><mtr 
><mtd columnalign="right" ></mtd>
   </mtr>                                                               </mtable>
</math></td><td class="eq-no">(5.9)</td></tr></table>
<!--l. 1369--><p class="indent" >   where <!--l. 1369--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1369--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03BE;</mi> <mo 
class="MathClass-rel">=</mo> <mn>1</mn><mn>0</mn></math>,
<!--l. 1369--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BA;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mn>2</mn><mn>0</mn></math>,

<!--l. 1369--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math> is the
pulse width. The TBP can be estimated using
</p>
   <table class="equation"><tr><td> <a 
 id="x10-50002r10"></a>
<!--l. 1371--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                           <mspace width="1em" class="nbsp" /><mi 
>T</mi><mi 
>B</mi><mi 
>P</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>A</mi> <mo 
class="MathClass-bin">&#x22C5;</mo> <mi 
>T</mi></mrow> 
  <mrow 
><mi 
>&#x03C0;</mi></mrow></mfrac>
</math></td><td class="eq-no">(5.10)</td></tr></table>
<!--l. 1377--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-510005.1.2"></a>rfBIR</h5>
<!--l. 1379--><p class="noindent" >A RF macro that creates an adiabatic B1 Independent Rotation (BIR) RF pulse.
This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">MaxB1 (T) : The maximum B1 field
     </li>
     <li class="itemize">MaxFreq (Hz) : The maximum RF frequency
     </li>
     <li class="itemize">Lambda : The <!--l. 1384--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03BB;</mi></math>
     adiabatic factor
     </li>
     <li class="itemize">Beta : The <!--l. 1385--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B2;</mi></math>
     adiabatic factor
     </li>
     <li class="itemize">BIRFlag : The type of BIR pulse, including &#8216;BIR-1&#8217;, &#8216;BIR-2&#8217; and &#8216;BIR-4&#8217;
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time

     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1398--><p class="indent" >   The time dependence of the BIR-1 RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51001r11"></a>
<!--l. 1400--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mi 
>&#x0177;</mi><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                             </mrow></mfenced>
</math></td><td class="eq-no">(5.11)</td></tr></table>
<!--l. 1409--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51002r12"></a>

<!--l. 1410--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                               </mrow></mfenced>
</math></td><td class="eq-no">(5.12)</td></tr></table>
<!--l. 1419--><p class="indent" >   where <!--l. 1419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is the
maximum RF frequency corresponding to MaxFreq. The RF pulse width is
<!--l. 1419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>&#x03C0;</mi></mrow> 
<mrow 
><mi 
>&#x03BE;</mi></mrow></mfrac> </math>, and
<!--l. 1419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover></math> and
<!--l. 1419--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x0177;</mi></math> are
unit vectors for indicating RF phase. <br 
class="newline" />
</p><!--l. 1421--><p class="indent" >   The time dependence of the BIR-2 RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51003r13"></a>
<!--l. 1423--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><mo 
class="MathClass-rel">|</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>   </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mi 
>&#x0177;</mi><mo 
class="MathClass-rel">|</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mi 
>T</mi> </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><mi 
>&#x0177;</mi><mo 
class="MathClass-rel">|</mo><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mi 
>T</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mn>2</mn><mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                          </mrow></mfenced>
</math></td><td class="eq-no">(5.13)</td></tr></table>
<!--l. 1433--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51004r14"></a>
<!--l. 1434--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                         <mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mo 
class="MathClass-rel">|</mo><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo>
</math></td><td class="eq-no">(5.14)</td></tr></table>
<!--l. 1439--><p class="indent" >   where <!--l. 1439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is the

maximum RF frequency corresponding to MaxFreq. The RF pulse width is
<!--l. 1439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>&#x03C0;</mi></mrow> 
<mrow 
><mi 
>&#x03BE;</mi></mrow></mfrac> </math>, and
<!--l. 1439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover></math> and
<!--l. 1439--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x0177;</mi></math> are
unit vectors for indicating RF phase. <br 
class="newline" />
</p><!--l. 1441--><p class="indent" >   The time dependence of the BIR-4 RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51005r15"></a>
<!--l. 1443--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03BB;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mn>1</mn> <mo 
class="MathClass-bin">-</mo><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow> 
<mrow 
><mi 
>T</mi></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>4</mn></mrow></mfrac>   </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03BB;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow>
<mrow 
><mi 
>T</mi></mrow></mfrac> <mo 
class="MathClass-bin">-</mo> <mn>1</mn></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>4</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03BB;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mn>3</mn> <mo 
class="MathClass-bin">-</mo><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow> 
<mrow 
><mi 
>T</mi></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow> 
 <mrow 
><mn>4</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mi 
>h</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03BB;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow>
<mrow 
><mi 
>T</mi></mrow></mfrac> <mo 
class="MathClass-bin">-</mo> <mn>3</mn></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow>
 <mrow 
><mn>4</mn></mrow></mfrac>   <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi> </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                      </mrow></mfenced>
</math></td><td class="eq-no">(5.15)</td></tr></table>
<!--l. 1454--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-51006r16"></a>
<!--l. 1455--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>&#x03B2;</mi><mi 
>t</mi></mrow>
 <mrow 
><mi 
>T</mi></mrow></mfrac> </mrow><mo 
class="MathClass-close">)</mo></mrow></mrow>
 <mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow></mfrac>      <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>4</mn></mrow></mfrac>   </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03B2;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow>
<mrow 
><mi 
>T</mi></mrow></mfrac> <mo 
class="MathClass-bin">-</mo><mn>2</mn></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></mrow>
    <mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow></mfrac>     <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>4</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03B2;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow>
<mrow 
><mi 
>T</mi></mrow></mfrac> <mo 
class="MathClass-bin">-</mo><mn>2</mn></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></mrow>
    <mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow></mfrac>     <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow> 
 <mrow 
><mn>4</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">[</mo><mrow><mi 
>&#x03B2;</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mfrac><mrow 
><mn>4</mn><mi 
>t</mi></mrow>
<mrow 
><mi 
>T</mi></mrow></mfrac> <mo 
class="MathClass-bin">-</mo><mn>4</mn></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow><mo 
class="MathClass-close">]</mo></mrow></mrow>
    <mrow 
><mi 
>t</mi><mi 
>a</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03B2;</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></mrow></mfrac>     <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow>
 <mrow 
><mn>4</mn></mrow></mfrac>   <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi> </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                              </mrow></mfenced>
</math></td><td class="eq-no">(5.16)</td></tr></table>
<!--l. 1466--><p class="indent" >   where <!--l. 1466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1. The RF pulse width is
<!--l. 1466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi></math>. The
<!--l. 1466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03BB;</mi></math> and
<!--l. 1466--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>&#x03B2;</mi></math> are
dimensionless constants that describe the degree to which extent the RF pulse
satisfies the adiabatic condition.

</p><!--l. 1469--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-520005.1.2"></a>rfBIREF</h5>
<!--l. 1471--><p class="noindent" >A RF macro that creates an adiabatic B1 Independent Refocusing (BIREF) RF
pulse. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">MaxB1 (T) : The maximum B1 field
     </li>
     <li class="itemize">MaxFreq (Hz) : The maximum RF frequency
     </li>
     <li class="itemize">BIREFFlag : The type of BIREF pulse, including &#8216;BIREF-1&#8217;, &#8216;BIREF-2a&#8217;
     and &#8216;BIREF-2b&#8217;
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>

<!--l. 1488--><p class="indent" >   The time dependence of the BIREF-1 RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52001r17"></a>
<!--l. 1490--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                            </mrow></mfenced>
</math></td><td class="eq-no">(5.17)</td></tr></table>
<!--l. 1499--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52002r18"></a>
<!--l. 1500--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                         <mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-rel">|</mo><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo>
</math></td><td class="eq-no">(5.18)</td></tr></table>
<!--l. 1505--><p class="indent" >   where <!--l. 1505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is the
maximum RF frequency corresponding to MaxFreq. The RF pulse width is
<!--l. 1505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>&#x03C0;</mi></mrow> 
<mrow 
><mi 
>&#x03BE;</mi></mrow></mfrac> </math>, and
<!--l. 1505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover></math>
is an unit vector for indicating RF phase along the
<!--l. 1505--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> axis.
<br 
class="newline" />
</p><!--l. 1507--><p class="indent" >   The time dependence of the BIREF-2a RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52003r19"></a>

<!--l. 1509--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
                        <mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo> <mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-rel">|</mo><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo>
</math></td><td class="eq-no">(5.19)</td></tr></table>
<!--l. 1514--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52004r20"></a>
<!--l. 1515--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                               </mrow></mfenced>
</math></td><td class="eq-no">(5.20)</td></tr></table>
<!--l. 1524--><p class="indent" >   where <!--l. 1524--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1524--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is the
maximum RF frequency corresponding to MaxFreq. The RF pulse width is
<!--l. 1524--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mi 
>&#x03C0;</mi></mrow> 
<mrow 
><mi 
>&#x03BE;</mi></mrow></mfrac> </math>, and
<!--l. 1524--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover></math>
is an unit vector for indicating RF phase along the
<!--l. 1524--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> axis.
<br 
class="newline" />
</p><!--l. 1526--><p class="indent" >   The time dependence of the BIREF-2b RF pulse is given by <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XHandbook2004">6</a>]</span>: <br 
class="newline" />Amplitude modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52005r21"></a>
<!--l. 1528--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>A</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mo 
class="MathClass-rel">|</mo><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mo 
class="MathClass-rel">|</mo><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>2</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>c</mi><mi 
>o</mi><mi 
>s</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>2</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi></mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                            </mrow></mfenced>
</math></td><td class="eq-no">(5.21)</td></tr></table>

<!--l. 1537--><p class="indent" >   Frequency modulation: </p><table class="equation"><tr><td> <a 
 id="x10-52006r22"></a>
<!--l. 1538--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="block" class="equation">
<mi 
>F</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mo 
class="MathClass-rel">=</mo>  <mfenced separators="" 
open="{"  close="" ><mrow> <mtable  style="text-align:axis;"  
equalrows="false" columnlines="none" equalcolumns="false" class="array"><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow> <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mn>0</mn> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mi 
>T</mi></mrow> 
<mrow 
><mn>4</mn></mrow></mfrac>   </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><mo 
class="MathClass-bin">-</mo><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow><mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mi 
>T</mi></mrow>
<mrow 
><mn>4</mn></mrow></mfrac>  <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x003C;</mo> <mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow> 
 <mrow 
><mn>4</mn></mrow></mfrac>  </mtd>
</mtr><mtr><mtd 
class="array"  columnalign="left"><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
><mi 
>s</mi><mi 
>i</mi><mi 
>n</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mi 
>&#x03BE;</mi><mi 
>t</mi></mrow><mo 
class="MathClass-close">)</mo></mrow>  <mspace width="1em" class="quad"/></mtd><mtd 
class="array"  columnalign="left"><mfrac><mrow 
><mn>3</mn><mi 
>T</mi></mrow>
 <mrow 
><mn>4</mn></mrow></mfrac>   <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>t</mi> <mo 
class="MathClass-rel">&#x2264;</mo> <mi 
>T</mi> </mtd></mtr> <!--@{}l@{\quad }l@{}--></mtable>                                                              </mrow></mfenced>
</math></td><td class="eq-no">(5.22)</td></tr></table>
<!--l. 1548--><p class="indent" >   where <!--l. 1548--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>A</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math>
is the maximum B1 field corresponding to MaxB1,
<!--l. 1548--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>F</mi></mrow><mrow 
><mn>0</mn></mrow></msub 
></math> is the
maximum RF frequency corresponding to MaxFreq. The RF pulse width is
<!--l. 1548--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi> <mo 
class="MathClass-rel">=</mo> <mfrac><mrow 
><mn>2</mn><mi 
>&#x03C0;</mi></mrow> 
 <mrow 
><mi 
>&#x03BE;</mi></mrow></mfrac> </math>, and
<!--l. 1548--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mover 
accent="true"><mrow 
><mi 
>x</mi></mrow><mo 
class="MathClass-op">^</mo></mover></math>
is an unit vector for indicating RF phase along the
<!--l. 1548--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> axis.
<br 
class="newline" />
</p><!--l. 1550--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-530005.1.2"></a>rfRandom</h5>
<!--l. 1552--><p class="noindent" >A RF macro that creates a RF pulse with normally distributed pseudo-random
amplitude. This macro is used for program testing purpose, however it shows that
almost any arbitrary RF pulse could potentially be supported by MRiLab. This
macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">rfGain : The standard deviation of the normal distribution
     </li>
     <li class="itemize">dt (s) : The time interval of RF pulse sample points
     </li>
     <li class="itemize">rfPhase (rad) : RF pulse phase
     </li>
     <li class="itemize">rfFreq (Hz) : RF pulse frequency

     </li>
     <li class="itemize">tStart (s) : RF pulse starting time
     </li>
     <li class="itemize">tEnd (s) : RF pulse ending time
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1569--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-540005.1.2"></a>rfUser</h5>
<!--l. 1571--><p class="noindent" >If the user has specific RF pulse waveform data saved in a MAT file, the user can
easily import the RF file into MRiLab pulse design interface by using &#8216;rfUser&#8217; macro.
The RF pulse MAT file needs to contain four matrices including &#8216;rfTime&#8217; (i.e. RF
time points) , &#8216;rfAmp&#8217; (i.e. RF amplitude), &#8216;rfPhase&#8217; (i.e. RF phase) and &#8216;rfFreq&#8217; (i.e.
RF frequency). All four matrices must have the same size of m-by-n, where m is the
number of TR sections and n is the number of RF waveform points. In typical MR
sequence, the entire sequence is composed of multiple TR sections. The
<!--l. 1571--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th TR section uses
the <!--l. 1571--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th RF pulse
stored in the <!--l. 1571--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
row of these four matrices. If the number of row is less than the number of TR
sections, the last RF pulse will be used for all the remaining TR sections. Notice that
if &#8216;rfPhase&#8217; and/or &#8216;rfFreq&#8217; are not provided, MRiLab initializes them as
a value of 0. However, &#8216;rfTime&#8217; and &#8216;rfAmp&#8217; must be provided. Also note
that MRiLab only uses the first RF pulse in the MAT file for pulse analysis
in the RF pulse design interface. The &#8216;rfUser&#8217; macro contains attributes
including:

</p>
     <ul class="itemize1">
     <li class="itemize">rfFile : The path to the file that stores the RF pulse data, quoted using
     single quotes
     </li>
     <li class="itemize">Switch : The flag for turning on and off RF pulse in the RF sequence line
     </li>
     <li class="itemize">AnchorTE : The flag for turning on and off TE reference, TE is calculated
     from this RF pulse if this flag is turned on
     </li>
     <li class="itemize">Duplicates : The number of the RF pulse duplicates, used for creating
     multiple RF pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between RF pulse duplicates
     </li>
     <li class="itemize">CoilID : The ID of the coil element used with this RF pulse, applied for
     multiple RF transmitting
     </li>
     <li class="itemize">Notes : The notes of the RF pulse</li></ul>
<!--l. 1583--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1.3   </span> <a 
 id="x10-550005.1.3"></a>Make New RF Macro</h4>
<!--l. 1585--><p class="noindent" >The RF pulse macro library covers several common types of RF pulse waveform.
However, comprehensive coverage of existing RF pulses is nearly impossible for
almost any pulse sequence design tools. To address this problem in MRiLab,
the user can use the &#8216;rfUser&#8217; to import RF pulses from files generated by
other programs. Another way to import RF pulse is to simply write a RF
macro. To create a RF macro, the user should follow the following steps
:
</p><!--l. 1587--><p class="indent" >
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-55002x1">Write RF macro code <br 
class="newline" />
     <!--l. 1591--><p class="noindent" >It is strongly recommended to write your own RF macro code based on
     similar RF macros in the MRiLab macro library, for example, the &#8216;rfRect&#8217;
     macro is coded as:

</p>
     <div class="verbatim" id="verbatim-2">
     function&#x00A0;[rfAmp,rfPhase,rfFreq,rfCoil,rfTime]=rfRect(p)
     &#x00A0;<br />%Create&#x00A0;a&#x00A0;hard&#x00A0;RF&#x00A0;pulse&#x00A0;starting&#x00A0;from&#x00A0;tStart&#x00A0;and&#x00A0;ending&#x00A0;at&#x00A0;tEnd
     &#x00A0;<br />%tStart&#x00A0;RF&#x00A0;start&#x00A0;time
     &#x00A0;<br />%tEnd&#x00A0;RF&#x00A0;end&#x00A0;time
     &#x00A0;<br />%FA&#x00A0;RF&#x00A0;actual&#x00A0;flip&#x00A0;angle
     &#x00A0;<br />%dt&#x00A0;RF&#x00A0;sample&#x00A0;time
     &#x00A0;<br />%rfPhase&#x00A0;RF&#x00A0;phase
     &#x00A0;<br />%rfFreq&#x00A0;RF&#x00A0;off-res&#x00A0;freq
     &#x00A0;<br />
     &#x00A0;<br />tStart=p.tStart;
     &#x00A0;<br />tEnd=p.tEnd;
     &#x00A0;<br />FA=p.FA;
     &#x00A0;<br />dt=p.dt;
     &#x00A0;<br />rfPhase=p.rfPhase;
     &#x00A0;<br />rfFreq=p.rfFreq;
     &#x00A0;<br />rfCoil=p.CoilID;
     &#x00A0;<br />Duplicates=max(1,p.Duplicates);
     &#x00A0;<br />DupSpacing=max(0,p.DupSpacing);
     &#x00A0;<br />
     &#x00A0;<br />rfTime=linspace(tStart,tEnd,ceil((tEnd-tStart)/dt)+1);
     &#x00A0;<br />rfAmp=ones(size(rfTime));&#x00A0;%&#x00A0;Rectangle
     &#x00A0;<br />rfAmp(1)=0;
     &#x00A0;<br />rfAmp(end)=0;
     &#x00A0;<br />rfAmp=DoB1Scaling(rfAmp,dt,FA)*rfAmp;&#x00A0;%B1&#x00A0;Scaling
     &#x00A0;<br />
     &#x00A0;<br />rfPhase=(rfPhase)*ones(size(rfTime));
     &#x00A0;<br />rfFreq=(rfFreq)*ones(size(rfTime));
     &#x00A0;<br />rfCoil=(rfCoil)*ones(size(rfTime));
     &#x00A0;<br />rfPhase(1)=0;
     &#x00A0;<br />rfPhase(end)=0;
     &#x00A0;<br />rfFreq(1)=0;
     &#x00A0;<br />rfFreq(end)=0;
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Create&#x00A0;Duplicates
     &#x00A0;<br />if&#x00A0;Duplicates~=1&#x00A0;&amp;&#x00A0;DupSpacing&#x00A0;~=0
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfAmp=repmat(rfAmp,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfFreq=repmat(rfFreq,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfPhase=repmat(rfPhase,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfCoil=repmat(rfCoil,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;TimeOffset&#x00A0;=&#x00A0;repmat(0:DupSpacing:(Duplicates-1)*DupSpacing,&#x00A0;...

     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;[length(rfTime)&#x00A0;1]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfTime=repmat(rfTime,[1&#x00A0;Duplicates])&#x00A0;+&#x00A0;(TimeOffset(:))&#8217;;
     &#x00A0;<br />end
     &#x00A0;<br />
     &#x00A0;<br />end
</div>
     <!--l. 1639--><p class="nopar" >
     </p><!--l. 1641--><p class="noindent" >Your macro must start from a function declaration at the beginning, then
     followed by attribute input section. The &#8216;tStart&#8217; and &#8216;tEnd&#8217; need to be added
     for indicating the time scale. It&#8217;s also strongly recommended to add attribute
     input &#8216;rfCoil&#8217;,&#8216;Duplicates&#8217; and &#8216;DupSpacing&#8217; for multi-transmitting and
     multi-echo support.

</p>
     <div class="verbatim" id="verbatim-3">
     function&#x00A0;[rfAmp,rfPhase,rfFreq,rfCoil,rfTime]=rfMacroName(p)
     &#x00A0;<br />%Create&#x00A0;a&#x00A0;RF&#x00A0;pulse&#x00A0;based&#x00A0;on&#x00A0;user&#x00A0;code
     &#x00A0;<br />
     &#x00A0;<br />tStart=p.tStart;
     &#x00A0;<br />tEnd=p.tEnd;
     &#x00A0;<br />rfCoil=p.CoilID;
     &#x00A0;<br />Duplicates=max(1,p.Duplicates);
     &#x00A0;<br />DupSpacing=max(0,p.DupSpacing);
     &#x00A0;<br />...
     &#x00A0;<br />attribute1=p.attribute1;
     &#x00A0;<br />attribute2=p.attribute2;
     &#x00A0;<br />attribute3=p.attribute3;
     &#x00A0;<br />...
</div>
     <!--l. 1657--><p class="nopar" >
     </p><!--l. 1659--><p class="noindent" >The main code should deal with calculation for &#8216;rfAmp&#8217;, &#8216;rfPhase&#8217;, &#8216;rfFreq&#8217; and
     &#8216;rfTime&#8217;. Notice that they should have the same size as 1-by-m where m is the
     number of RF waveform points.

</p>
     <div class="verbatim" id="verbatim-4">
     %&#x00A0;The&#x00A0;main&#x00A0;code&#x00A0;for&#x00A0;user&#x00A0;macro
     &#x00A0;<br />...
     &#x00A0;<br />rfTime&#x00A0;=&#x00A0;...;
     &#x00A0;<br />rfAmp&#x00A0;=&#x00A0;...;
     &#x00A0;<br />rfPhase&#x00A0;=&#x00A0;...;
     &#x00A0;<br />rfFreq&#x00A0;=&#x00A0;...;
     &#x00A0;<br />...
</div>
     <!--l. 1669--><p class="nopar" >
     </p><!--l. 1672--><p class="noindent" >Then you should add several lines to end your macro,

</p>
     <div class="verbatim" id="verbatim-5">
     %&#x00A0;Avoid&#x00A0;baseline&#x00A0;offset
     &#x00A0;<br />rfAmp(1)=0;
     &#x00A0;<br />rfAmp(end)=0;
     &#x00A0;<br />rfPhase(1)=0;
     &#x00A0;<br />rfPhase(end)=0;
     &#x00A0;<br />rfFreq(1)=0;
     &#x00A0;<br />rfFreq(end)=0;
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Assign&#x00A0;coil&#x00A0;element&#x00A0;index&#x00A0;number
     &#x00A0;<br />rfCoil=(rfCoil)*ones(size(rfTime));
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Create&#x00A0;Duplicates
     &#x00A0;<br />if&#x00A0;Duplicates~=1&#x00A0;&amp;&#x00A0;DupSpacing&#x00A0;~=0
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfAmp=repmat(rfAmp,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfFreq=repmat(rfFreq,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfPhase=repmat(rfPhase,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfCoil=repmat(rfCoil,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;TimeOffset=repmat(0:DupSpacing:(Duplicates-1)*DupSpacing,&#x00A0;...
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;[length(rfTime)&#x00A0;1]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;rfTime=repmat(rfTime,[1&#x00A0;Duplicates])&#x00A0;+&#x00A0;(TimeOffset(:))&#8217;;
     &#x00A0;<br />end
     &#x00A0;<br />
</div>
     <!--l. 1697--><p class="nopar" >
     </p></li>
     <li 
  class="enumerate" id="x10-55004x2">Register RF macro <br 
class="newline" />
     <!--l. 1701--><p class="noindent" >The RF macro file can be placed anywhere as long as the file is included
     in Matlab search path, however it is recommended to save the file
     under /MRiLab/Macro/SeqElem/rf for consistent file organization.
     Besides a RF macro file that performs pulse generation, MRiLab also
     requires a memo .txt file that accompanies the RF macro with the name
     &#8216;rfMacroName_Memo&#8217;. This file contains information about RF pulse
     description if necessary.
     </p><!--l. 1703--><p class="noindent" >The customized RF macro needs to be registered in the macro library before using. To
     register a macro, open file &#8216;SeqElem.xml&#8217; under /SeqElem, then add one entry under
     <!--l. 1703--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math>rf<!--l. 1703--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo></math>
     category with the proper attribute list. One example could be

</p>
     <div class="verbatim" id="verbatim-6">
     &#x003C;rfMacroName
     &#x00A0;<br />AnchorTE="$2&#8217;on&#8217;,&#8217;off&#8217;"
     &#x00A0;<br />CoilID="1"
     &#x00A0;<br />DupSpacing="0"
     &#x00A0;<br />Duplicates="1"
     &#x00A0;<br />Switch="$1&#8217;on&#8217;,&#8217;off&#8217;"
     &#x00A0;<br />tEnd="1e-3"
     &#x00A0;<br />tStart="0"
     &#x00A0;<br />Notes="A&#x00A0;new&#x00A0;RF&#x00A0;macro"
     &#x00A0;<br />attribute1="0"
     &#x00A0;<br />attribute2="0"
     &#x00A0;<br />attribute3="0"&#x00A0;/&#x003E;
</div>
     <!--l. 1718--><p class="nopar" >
     </p><!--l. 1720--><p class="noindent" >Notice that in the above example, the first 7 attributes are required
     for MRiLab, The remaining attributes are optional based on user&#8217;s
     choice.
</p>
     </li></ol>
<!--l. 1724--><p class="indent" >   Once the RF macro is coded and registered to the library, the user can use this
customized RF macro just like default RF macros in the library.
</p><!--l. 1726--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.2   </span> <a 
 id="x10-560005.2"></a>MR Sequence Design</h3>
<!--l. 1728--><p class="noindent" >The MR Sequence Design toolbox can be activated by pressing &#8216;Sequence Design
Panel&#8217; toolbar icon located at the top of the main simulation console. The current
loaded sequence will show in the MR Sequence Design interface.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-5600110"></a>


<!--l. 1732--><p class="noindent" ><img 
src="Pictures/SequenceDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.10: </span><span  
class="content">Sequence Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-5600110 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.2.1   </span> <a 
 id="x10-570005.2.1"></a>Sequence Design GUI</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-5700111"></a>


<!--l. 1741--><p class="noindent" ><img 
src="Pictures/SequenceDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.11: </span><span  
class="content">Sequence Design Panel. A bSSFP sequence is shown.</span></div><!--tex4ht:label?: x10-5700111 -->

   </div><hr class="endfigure" />
<!--l. 1746--><p class="indent" >   Figure <a 
href="#x10-5700111">5.11<!--tex4ht:ref: fig:SequenceDesignGUI --></a> demonstrates an overview of the MR Sequence Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-57003x1">Macro Library <br 
class="newline" />
     <!--l. 1751--><p class="noindent" >The Macro Library contains a full set of pulse macros for constructing MR
     sequence in MRiLab. It covers not only RF macro library as described
     in above section, but also GzSS, GyPE and GxR gradient macro library,
     ADC macro library and Ext macro library. The user needs to click the
     &#8216;SeqElem&#8217; root as well as the subsequent nodes to unfold those macros.
     </p></li>
     <li 
  class="enumerate" id="x10-57005x2">Sequence Structure <br 
class="newline" />
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5700612"></a>   <img 
src="Pictures/SequenceStructure.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.12: </span><span  
class="content">An Example of A Typical MR Sequence Structure in MRiLab</span></div><!--tex4ht:label?: x10-5700612 -->
     </div><hr class="endfigure" />
     <!--l. 1763--><p class="noindent" >In MRiLab, a MR sequence consists of the following parts :
</p>
         <ul class="itemize1">
         <li class="itemize">CVs : The controllable variables, linked to the &#8216;CVs&#8217; tab on the main
         control console
         </li>
         <li class="itemize">Specials : The applied special techniques by default
         </li>
         <li class="itemize">Pulses
             <ul class="itemize2">
             <li class="itemize">RF : RF sequence line
             </li>
             <li class="itemize">GzSS : GzSS sequence line
             </li>
             <li class="itemize">GyPE : GyPE sequence line
             </li>
             <li class="itemize">GxR : GxR sequence line
             </li>
             <li class="itemize">ADC : Signal acquisition sequence line
             </li>
             <li class="itemize">Ext : Extended process sequence line</li></ul>
         </li></ul>

     <!--l. 1779--><p class="noindent" >The user can construct desired MR sequence by changing the content of the
     MR sequence structure. To add a macro into the sequence structure, click one
     macro in the macro library, then click on the sequence line root (e.g. rf) to
     which this macro is inserted, then click &#8216;+&#8217; macro operation button. To delete
     a macro from the sequence structure, click the unwanted macro at
     the sequence line, then click &#8216;-&#8217; macro operation button. To duplicate
     an existing macro, first click the source macro, then click &#8216;C&#8217; macro
     operation button for copying, click on the sequence line root, then
     click &#8216;P&#8217; macro operation button for pasting. MRiLab requires the
     pulse macro being operated within its belonging category (e.g. RF
     pulse can&#8217;t be added to gradient line). Also empty sequence line is
     prohibited.<br 
class="newline" />
</p>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5700713"></a>   <img 
src="Pictures/MacroOperationButton.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.13: </span><span  
class="content">Macro Operation Buttons</span></div><!--tex4ht:label?: x10-5700713 -->
     </div><hr class="endfigure" />
     <!--l. 1788--><p class="noindent" >In MRiLab v1.2 and v1.3, multiple &#8216;Pulses&#8217; are allowed in a single sequence
     structure to enhance design ability for complex MR sequence. For instance,
     two &#8216;Pulses&#8217; can be used to design a MR sequence with two separate
     sections where one section is for regular image acquisition and the other
     is for fat saturation which occurrs every 5 regular image acquisition
     sections (Figure <a 
href="#x10-5700814">5.14<!--tex4ht:ref: fig:TwoPulses --></a>). To add a new &#8216;Pulses&#8217;, click one &#8216;Pulses&#8217; as a
     source, then click &#8216;C&#8217; macro operation button for copying, click on the
     sequence root &#8216;MRiLabSeq&#8217;, then click &#8216;P&#8217; macro operation button for
     pasting. The duplicated &#8216;Pulses&#8217; will be appended to the end of the
     sequence structure, from where further modification could be made. Also,
     removing a selected &#8216;Pulses&#8217; can be performed by clicking &#8216;-&#8217; operation.
     <br 
class="newline" />
     </p><!--l. 1790--><p class="noindent" >The &#8216;Pulses&#8217; has several properties:
</p>
         <ul class="itemize1">
         <li class="itemize">tS : The starting time point in TR section, <span 
class="cmbx-10">any waveform timing</span>
         <span 
class="cmbx-10">in this pulse group is relative to this time point</span>
         </li>
         <li class="itemize">tE : The ending time point in TR section, <span 
class="cmbx-10">any waveform timing</span>
         <span 
class="cmbx-10">in this pulse group will be truncated after this time point</span>
         </li>
         <li class="itemize">TRStart : The starting TR number when this pulse group starts to
         occur
         </li>
         <li class="itemize">TREnd : The ending TR number when this pulse group stops to

         occur
         </li>
         <li class="itemize">Freq : The occurrence frequency (e.g. 1 means occurring every TR
         section, 5 means occurring every 5 TR sections)
         </li>
         <li class="itemize">Switch : The flag for turning on and off this pulse group
         </li>
         <li class="itemize">Notes : The notes of this pulse group</li></ul>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5700814"></a>   <img 
src="Pictures/TwoPulses.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.14: </span><span  
class="content">A schematic example of a MR sequence containing two pulse
groups. Pulses1 is a fat saturation section occurring every 5 TR sections. Pulses2
is a regular image acquisition section occurring every TR section. Note that
depending on the occurrence of Pulses1, one TR section could be either Pulses2
or Pulses1+Pulses2.</span></div><!--tex4ht:label?: x10-5700814 -->
     </div><hr class="endfigure" />
     </li>
     <li 
  class="enumerate" id="x10-57010x3">Pulse Attribute <br 
class="newline" />
     <!--l. 1811--><p class="noindent" >Upon clicking on a pulse macro within a MR sequence structure, the
     corresponding macro attributes will be shown at the pulse attribute panel down
     below the sequence structure. The user can edit those attributes to modify the
     sequence waveform. To make any modification effective, the user must press
     &#8216;Update&#8217; button to update the associated sequence XML file. Pressing &#8216;Execute&#8217;
     button will update and redraw the MR sequence waveform plotting on this
     interface.
     </p></li>
     <li 
  class="enumerate" id="x10-57012x4">Sequence Waveform <br 
class="newline" />
     <!--l. 1815--><p class="noindent" >The sequence waveform associated with the sequence structure is displayed on
     the &#8216;Sequence Diagram&#8217; panel on the right side of this interface. The user can
     use the waveform diagram to inspect sequence details and layout. The sequence
     diagram consists of individual sequence lines corresponding to RF, GzSS,
     GyPE, GxR, ADC and Ext, respectively. To accommodate multiple RF
     transmitting, MRiLab provides separate RF sequence lines for each RF source.
     When &#8216;MultiTransmit&#8217; flag is turned on in the main control console and the
     chosen sequence structure contains multiple RF pulses for different RF sources
     (i.e. assign RF pulses to different coil channels by using &#8216;CoilID&#8217; attribute),
     the multi-tab will be activated on the &#8216;rf Source&#8217; panel (Figure <a 
href="#x10-5701315">5.15<!--tex4ht:ref: fig:RFSource --></a>).
     The user can switch between these tabs for checking individual RF
     source.<br 
class="newline" />
</p>

     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5701315"></a>   <img 
src="Pictures/RFSource.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.15: </span><span  
class="content">An Example of Multiple RF Source. The &#8216;MultiTransmit&#8217; is turned
on and this sequence contains total 4 RF sources. The RF source 2 is chosen
and the corresponding RF pulse waveform for coil channel 2 is shown.</span></div><!--tex4ht:label?: x10-5701315 -->
     </div><hr class="endfigure" />
     <!--l. 1824--><p class="noindent" >Notice that the vertical axes for all sequence lines are normalized and the
     horizontal axes are in units of milliseconds. MRiLab provides a group of
     sequence display button (Figure <a 
href="#x10-5701416">5.16<!--tex4ht:ref: fig:SequenceDisplayButton --></a>) to help inspect the sequence waveform
     details.
</p>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5701416"></a>   <img 
src="Pictures/SequenceDisplayButton.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.16: </span><span  
class="content">The Sequence Display Button.</span></div><!--tex4ht:label?: x10-5701416 -->
     </div><hr class="endfigure" />
     <!--l. 1833--><p class="noindent" >The sequence display button group consists of :
</p>
         <ul class="itemize1">
         <li class="itemize">Checker : The time checker toggle button
         </li>
         <li class="itemize">Time Ruler : Display current time point according to the time checker
         </li>
         <li class="itemize">Time Clips : Two editable boxes for defining time range
         </li>
         <li class="itemize"><!--l. 1839--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">&#x003C;</mo><mo 
class="MathClass-rel">&#x003C;</mo></math>:
         Move sequence waveform to the beginning
         </li>
         <li class="itemize"><!--l. 1840--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo><mo 
class="MathClass-rel">&#x003C;</mo><mo 
class="MathClass-rel">&#x003C;</mo></math>
         : Move sequence waveform backwards
         </li>
         <li class="itemize"><!--l. 1841--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo> <mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">&#x003C;</mo></math>
         : Zoom out
         </li>
         <li class="itemize">TR : Display a sequence waveform section with a time interval of TR
         </li>
         <li class="itemize">ALL : Display all sequence waveform
         </li>
         <li class="itemize"><!--l. 1844--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo> <mo 
class="MathClass-rel">|</mo><mo 
class="MathClass-rel">|</mo> <mo 
class="MathClass-rel">&#x003E;</mo></math>
         : Zoom in
         </li>
         <li class="itemize"><!--l. 1845--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo><mo 
class="MathClass-rel">&#x003E;</mo><mo 
class="MathClass-rel">&#x003E;</mo></math>:
         Move sequence waveform forwards

         </li>
         <li class="itemize"><!--l. 1846--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003E;</mo><mo 
class="MathClass-rel">&#x003E;</mo> <mo 
class="MathClass-rel">|</mo></math>
         : Move sequence waveform to the end</li></ul>
     <!--l. 1849--><p class="noindent" >The user can use the &#8216;Checker&#8217; toggle button to display a sequence waveform at
     any arbitrary time interval (Figure <a 
href="#x10-5701517">5.17<!--tex4ht:ref: fig:AllSequence --></a>). First press the &#8216;Checker&#8217; button,
     move the mouse cursor into the axes. Notice that the mouse cursor
     changes to a cross-hair. Move the cross-hair in the axes, the amplitude
     value for each sequence line will be displayed accordingly on right
     side of each line with their default units. The user can click on the
     axes to choose one side of the time slot, then click on the another
     side. MRiLab will change the sequence view between the chosen time
     points, and also save time point information in the list at the bottom of
     this interface. To disable &#8216;Checker&#8217; function, simple press this button
     again.
</p>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5701517"></a>   <img 
src="Pictures/AllSequence.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.17: </span><span  
class="content">A Sequence View with Multiple TRs.</span></div><!--tex4ht:label?: x10-5701517 -->
     </div><hr class="endfigure" />
     </li>
     <li 
  class="enumerate" id="x10-57017x5">Display Control
     <!--l. 1860--><p class="noindent" >The &#8216;Waveform&#8217; tab on the &#8216;Sequence Display&#8217; contains parameters for
     controlling sequence wavefrom display.
</p>
         <ul class="itemize1">
         <li class="itemize">TRStart : The first TR to be displayed
         </li>
         <li class="itemize">TREnd : The last TR to be displayed
         </li>
         <li class="itemize">Moments  (:TODO)  :  The  flag  for  turning  on  and  off  the  zeroth
         moment display for the gradient
         </li>
         <li class="itemize">LineMarker : The flag for turning on and off waveform line marker</li></ul>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5701818"></a>   <img 
src="Pictures/MatlabSpiral.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.18: </span><span  
class="content">Matlab Rendered <span 
class="cmti-10">k</span>-space Trajectory for A Spiral Readout with 4
Interleaves. The left figure is without <span 
class="cmti-10">k</span>-space point rendering. The right figure
is with <span 
class="cmti-10">k</span>-space point rendering with the arrows indicating <span 
class="cmti-10">k</span>-space traversing
direction.</span></div><!--tex4ht:label?: x10-5701818 -->
     </div><hr class="endfigure" />
     <!--l. 1876--><p class="noindent" >The &#8216;KSpace&#8217; tab on the &#8216;Sequence Display&#8217; contains parameters for controlling
     <span 
class="cmti-10">k</span>-space trajectory rendering.
</p>

         <ul class="itemize1">
         <li class="itemize">RenderMode  :  The  <span 
class="cmti-10">k</span>-space  rendering  mode,  including  &#8216;Matlab&#8217;
         (Figure <a 
href="#x10-5701818">5.18<!--tex4ht:ref: fig:MatlabSpiral --></a>) and &#8216;VTK&#8217; (Figure <a 
href="#x10-5701919">5.19<!--tex4ht:ref: fig:VTK --></a>)
         </li>
         <li class="itemize">RenderPoint : The flag for turning on and off <span 
class="cmti-10">k</span>-space point rendering</li></ul>
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-5701919"></a>   <img 
src="Pictures/VTK.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.19: </span><span  
class="content">VTK Rendered <span 
class="cmti-10">k</span>-space Trajectory Examples. The top left figure
shows a typical single slice Cartesian readout. The top right figure shows a
single slice multishot EPI readout. The bottom left figure shows a single slice
multishot spiral readout. The bottom right figure shows a 3D Stack-of-Stars
radial readout.</span></div><!--tex4ht:label?: x10-5701919 -->
     </div><hr class="endfigure" />
     <!--l. 1890--><p class="noindent" >Notice that in VTK rendering, the <span 
class="cmti-10">k</span>-space line color starts from green and ends
     to red. If the user uses VTK for <span 
class="cmti-10">k</span>-space rendering, please press keyboard &#8216;q&#8217; to
     quit the VTK window before any subsequent simulation. Pressing the quit
     button on the VTK window under Linux system will force the entire Matlab to
     close, this is &#8216;believed&#8217; to be a compatibility bug between Matlab and OpenGL
     used by VTK.
</p>
     </li></ol>
   <h4 class="subsectionHead"><span class="titlemark">5.2.2   </span> <a 
 id="x10-580005.2.2"></a>Virtual Structure</h4>
<!--l. 1895--><p class="noindent" >For the convenience of transferring data and configuration information across
different modules, MRiLab defined several Matlab structure variables in the global
scope. These structures start with &#8216;V&#8217; standing for &#8216;Virtual Structure&#8217;. Understanding
what these structures are and how they work is important to work with MRiLab and
to customize specific experiment design. There are two virtual structures useful for
designing MR sequences.
</p>
     <ul class="itemize1">
     <li class="itemize">VCtl : Virtual Control <br 
class="newline" />VCtl  encapsules  all  simulation  setting  parameters  in  the  main  control
     console. For example, the user can use &#8216;VCtl.TE&#8217; to reference &#8216;TE&#8217; value
     in the main control console; use &#8216;VCtl.FlipAng&#8217; to reference &#8216;FlipAng&#8217;
     value in the main control console. VCtl also allows the user to reference
     parameters  in  special  techniques  if  loaded.  Another  example  is  that
     MRiLab uses &#8216;VCtl.TR&#8217; in the &#8216;SE&#8217; for determining time interval for each
     TR section. The user can use any legal Matlab syntax combined with VCtl
     to create desired effect, such as use &#8216;2 * VCtl.TR&#8217; to indicate twice of &#8216;TR&#8217;
     value.

     </li>
     <li class="itemize">VVar : Virtual Variable <br 
class="newline" />VVar encapsules loop index variables that MRiLab uses for generating
     MR sequence waveform. A section of code for generating MR sequence is
     shown:

     <div class="verbatim" id="verbatim-7">
     %&#x00A0;MR&#x00A0;Sequence&#x00A0;Generating&#x00A0;Loop
     &#x00A0;<br />VVar.SliceCount=0;
     &#x00A0;<br />VVar.PhaseCount=0;
     &#x00A0;<br />VVar.TRCount=0;
     &#x00A0;<br />s=1;
     &#x00A0;<br />j=1;
     &#x00A0;<br />
     &#x00A0;<br />while&#x00A0;s&#x003C;=VCtl.SecondPhNum
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.SliceCount=s;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;while&#x00A0;j&#x003C;=VCtl.FirstPhNum
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.PhaseCount=j;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.TRCount=VVar.TRCount+1;
     &#x00A0;<br />
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%Sequence&#x00A0;Generating&#x00A0;Code
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;...
     &#x00A0;<br />
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;j=j+1;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;end
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;j=1;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;s=s+1;
     &#x00A0;<br />end
</div>
     <!--l. 1926--><p class="nopar" >
     </p><!--l. 1928--><p class="noindent" >The user can use the loop index variables in VVar
</p>
         <ul class="itemize2">
         <li class="itemize">VVar.TRCount : The TR section index
         </li>
         <li class="itemize">VVar.PhaseCount : The first phase encoding index
         </li>
         <li class="itemize">VVar.SliceCount : The second (i.e. slice) phase encoding index
         </li>
         <li class="itemize">VCtl.FirstPhNum : The total number of first phase encoding steps
         </li>
         <li class="itemize">VCtl.SecondPhNum : The total number of second phase encoding
         steps</li></ul>

     <!--l. 1938--><p class="noindent" >For example, to create <!--l. 1938--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn><mn>8</mn><msup><mrow 
><mn>0</mn></mrow><mrow 
><mo 
class="MathClass-bin">&#x2218;</mo></mrow></msup 
></math>
     RF phase cycling in bSSFP sequence, the user can set the attributes for the
     excitation RF pulse as
</p>
         <ul class="itemize2">
         <li class="itemize">CV3 : 2*pi/2
         </li>
         <li class="itemize">CV4 : 2
         </li>
         <li class="itemize">rfPhase : rem(VVar.TRCount-1,CV4)*CV3</li></ul>
     </li></ul>
<!--l. 1949--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.3   </span> <a 
 id="x10-590005.2.3"></a>GzSS Macro Library</h4>
<!--l. 1951--><p class="noindent" >A GzSS macro is a predefined module for a gradient pulse on the GzSS sequence line.
MRiLab GzSS macro library is a collection of GzSS macros covering different
gradient pulse types including slice selection and slice phase encoding pulses. Notice
that by default the area under the gradient ramp is ignored when calculating <span 
class="cmti-10">k</span>-space.
This section will give an introduction to each of the GzSS macros provided in
MRiLab.
</p><!--l. 1953--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-600005.2.3"></a>GzSelective</h5>
<!--l. 1955--><p class="noindent" >A GzSS macro that creates a typical slice selective gradient pulse (Figure <a 
href="#x10-6000120">5.20<!--tex4ht:ref: fig:GzSelective --></a>). This
macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t2Start (s) : Slice selection gradient pulse starting time
     </li>
     <li class="itemize">t2End (s) : Slice selection gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">GzAmp (T) : The amplitude of the gradient

     </li>
     <li class="itemize">Gz1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gz2Sign : The polarity of the slice selection gradient, set 0 for nulling
     </li>
     <li class="itemize">Gz3Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 1971--><p class="indent" >   Notice that both the prephasing gradient and rephasing gradient have half of the
area of the slice selection gradient.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6000120"></a>


<!--l. 1975--><p class="noindent" ><img 
src="Pictures/GzSelective.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.20: </span><span  
class="content">GzSelective Waveform</span></div><!--tex4ht:label?: x10-6000120 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-610005.2.3"></a>GzSelective2</h5>
<!--l. 1983--><p class="noindent" >A GzSS macro that creates a slice selective gradient pulse straddled with crusher
gradient (Figure <a 
href="#x10-6100121">5.21<!--tex4ht:ref: fig:GzSelective2 --></a>). This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t2Start (s) : Slice selection gradient pulse starting time
     </li>
     <li class="itemize">t2End (s) : Slice selection gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">tGz1 (s) : The duration of the left crusher
     </li>
     <li class="itemize">tGz3 (s) : The duration of the right crusher
     </li>
     <li class="itemize">Gz1Amp (T) : The amplitude of the left crusher
     </li>
     <li class="itemize">Gz2Amp (T) : The amplitude of the slice selective gradient
     </li>
     <li class="itemize">Gz3Amp (T) : The amplitude of the right crusher
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6100121"></a>


<!--l. 2002--><p class="noindent" ><img 
src="Pictures/GzSelective2.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.21: </span><span  
class="content">GzSelective2 Waveform</span></div><!--tex4ht:label?: x10-6100121 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-620005.2.3"></a>GzTrapezoid</h5>
<!--l. 2010--><p class="noindent" >A GzSS macro that creates a trapezoid gradient pulse (Figure <a 
href="#x10-6200122">5.22<!--tex4ht:ref: fig:GzTrapezoid --></a>) on GzSS
sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : The trapezoid pulse ramp time, assume symmetric ramp on
     both side
     </li>
     <li class="itemize">sRamp : The sample points on the ramp, use the value of 2 for ignoring
     the area under the ramp, use above 2 for counting the ramp area
     </li>
     <li class="itemize">GzAmp (T) : The amplitude of the gradient
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6200122"></a>


<!--l. 2026--><p class="noindent" ><img 
src="Pictures/GzTrapezoid.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.22: </span><span  
class="content">GzTrapezoid Waveform</span></div><!--tex4ht:label?: x10-6200122 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-630005.2.3"></a>GzAreaTrapezoid</h5>
<!--l. 2034--><p class="noindent" >A GzSS macro that creates a trapezoid gradient pulse of specified area (Figure <a 
href="#x10-6300123">5.23<!--tex4ht:ref: fig:GzAreaTrapezoid --></a>)
on GzSS sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6300123"></a>


<!--l. 2048--><p class="noindent" ><img 
src="Pictures/GzAreaTrapezoid.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.23: </span><span  
class="content">GzAreaTrapezoid Waveform</span></div><!--tex4ht:label?: x10-6300123 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-640005.2.3"></a>GzAreaTrapezoid2</h5>
<!--l. 2055--><p class="noindent" >A GzSS macro that creates a trapezoid gradient pulse of specified area with highest
system performance (Figure <a 
href="#x10-6400124">5.24<!--tex4ht:ref: fig:GzAreaTrapezoid2 --></a>) on GzSS sequence line. This macro creates a
gradient pulse with nearly shortest pulse width for the given system hardware
constraint. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6400124"></a>


<!--l. 2068--><p class="noindent" ><img 
src="Pictures/GzAreaTrapezoid2.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.24: </span><span  
class="content">GzAreaTrapezoid2 Waveform</span></div><!--tex4ht:label?: x10-6400124 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-650005.2.3"></a>GzCartesian</h5>
<!--l. 2075--><p class="noindent" >A GzSS macro that creates a Cartesian phase encoding gradient pulse (Figure <a 
href="#x10-6500125">5.25<!--tex4ht:ref: fig:GzCartesian --></a>)
along the slice direction. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t1Start (s) : The phase encoding gradient pulse starting time
     </li>
     <li class="itemize">t1End (s) : The phase encoding gradient pulse ending time
     </li>
     <li class="itemize">t2Start (s) : The rephasing gradient pulse starting time
     </li>
     <li class="itemize">t2End (s) : The rephasing gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">Gz1Sign : The polarity of the phase encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gz2Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2091--><p class="indent" >   Notice that the phase encoding gradient and the rephasing gradient have the
same area that is automatically calculated based on the imaging parameters in the
main control console.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-6500125"></a>


<!--l. 2095--><p class="noindent" ><img 
src="Pictures/GzCartesian.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.25: </span><span  
class="content">GzCartesian Waveform</span></div><!--tex4ht:label?: x10-6500125 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-660005.2.3"></a>GzUser</h5>
<!--l. 2102--><p class="noindent" >If the user has gradient pulse data saved in a MAT file, the user can easily import the
gradient file into MRiLab by using &#8216;GzUser&#8217; macro. The gradient pulse MAT file needs
to contain two matrices including &#8216;GTime&#8217; (i.e. gradient time points) and &#8216;GAmp&#8217;
(i.e. gradient amplitude). Both matrices must have the same size of m-by-n, where m
is the number of TR sections and n is the number of gradient waveform points. In
typical MR sequence, the entire sequence is composed of multiple TR sections. The
<!--l. 2102--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th TR section uses
the <!--l. 2102--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th gradient pulse
stored in the <!--l. 2102--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
row of these two matrices. If the number of row is less than the number of TR
sections, the last gradient pulse will be used for all the remaining TR sections. The
&#8216;GzUser&#8217; macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">GzFile : The path to the file that stores the gradient pulse data, quoted
     using single quotes
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2113--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.4   </span> <a 
 id="x10-670005.2.4"></a>GyPE Macro Library</h4>
<!--l. 2115--><p class="noindent" >A GyPE macro is a predefined module for a gradient pulse on the GyPE sequence
line. MRiLab GyPE macro library is a collection of GyPE macros covering different
gradient pulse types for performing phase encoding. Notice that by default the area
under the gradient ramp is ignored. This section will give an introduction to each of
the GyPE macros provided in MRiLab.

</p><!--l. 2117--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-680005.2.4"></a>GyTrapezoid</h5>
<!--l. 2119--><p class="noindent" >Similar to GzTrapezoid (Figure <a 
href="#x10-6200122">5.22<!--tex4ht:ref: fig:GzTrapezoid --></a>), GyTrapezoid creates a trapezoid gradient pulse
on GyPE sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : The trapezoid pulse ramp time, assume symmetric ramp on
     both side
     </li>
     <li class="itemize">sRamp : The sample points on the ramp, use the value of 2 for ignoring
     the area under the ramp, use above 2 for counting the ramp area
     </li>
     <li class="itemize">GyAmp (T) : The amplitude of the gradient
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2134--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-690005.2.4"></a>GyAreaTrapezoid</h5>
<!--l. 2136--><p class="noindent" >Similar to GzAreaTrapezoid (Figure <a 
href="#x10-6300123">5.23<!--tex4ht:ref: fig:GzAreaTrapezoid --></a>), GyAreaTrapezoid creates a trapezoid
gradient pulse of specified area on GyPE sequence line. This macro contains
attributes including:
</p>

     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2149--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-700005.2.4"></a>GyAreaTrapezoid2</h5>
<!--l. 2151--><p class="noindent" >Similar to GzAreaTrapezoid2 (Figure <a 
href="#x10-6400124">5.24<!--tex4ht:ref: fig:GzAreaTrapezoid2 --></a>), GyAreaTrapezoid2 creates a trapezoid
gradient pulse of specified area with highest system performance on GyPE sequence
line. This macro creates a gradient pulse with nearly shortest pulse width
for the given system hardware constraint. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates

     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2163--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-710005.2.4"></a>GyCartesian</h5>
<!--l. 2165--><p class="noindent" >Similar to GzCartesian (Figure <a 
href="#x10-6500125">5.25<!--tex4ht:ref: fig:GzCartesian --></a>), GyCartesian creates a Cartesian phase
encoding gradient pulse on GyPE sequence line. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">t1Start (s) : The phase encoding gradient pulse starting time
     </li>
     <li class="itemize">t1End (s) : The phase encoding gradient pulse ending time
     </li>
     <li class="itemize">t2Start (s) : The rephasing gradient pulse starting time
     </li>
     <li class="itemize">t2End (s) : The rephasing gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">Gy1Sign : The polarity of the phase encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gy2Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>

<!--l. 2181--><p class="indent" >   Notice that the phase encoding gradient and the rephasing gradient have the
same area that is automatically calculated based on the imaging parameters in the
main control console.
</p><!--l. 2184--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-720005.2.4"></a>GyRadial</h5>
<!--l. 2186--><p class="noindent" >A GyPE macro that creates a phase encoding gradient pulse for radial <span 
class="cmti-10">k</span>-space
trajectory (Figure <a 
href="#x10-7200126">5.26<!--tex4ht:ref: fig:GyRadial --></a>) on GyPE sequence line. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">t1Start (s) : The prephasing gradient pulse starting time
     </li>
     <li class="itemize">t2Middle (s) : The phase encoding gradient pulse middle time
     </li>
     <li class="itemize">t3Start (s) : The rephasing gradient pulse starting time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">Gy1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gy2Sign : The polarity of the phase encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gy3Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2200--><p class="indent" >   Notice that both the prephasing gradient and rephasing gradient have half of the
area of the phase encoding gradient that is automatically calculated based on the
imaging parameters in the main control console. MRiLab requires the &#8216;Radial&#8217; special
technique tab to be loaded for properly configuring the &#8216;GyRadial&#8217;, &#8216;GxRadial&#8217; and
&#8216;ADCRadial&#8217; macro. The user can set t2Middle value as &#8216;VCtl.TE&#8217; to acquire the
echo signal.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-7200126"></a>


<!--l. 2204--><p class="noindent" ><img 
src="Pictures/GyRadial.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.26: </span><span  
class="content">GyRadial Waveform</span></div><!--tex4ht:label?: x10-7200126 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-730005.2.4"></a>GySpiral</h5>
<!--l. 2211--><p class="noindent" >A GyPE macro that creates a phase encoding gradient pulse for spiral <span 
class="cmti-10">k</span>-space
trajectory (Figure <a 
href="#x10-7300127">5.27<!--tex4ht:ref: fig:GySpiral --></a>) on GyPE sequence line. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The phase encoding gradient pulse starting time
     </li>
     <li class="itemize">dt (s) : The time interval of gradient pulse sample points
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2220--><p class="indent" >   Notice that the area of the phase encoding gradient is automatically calculated
based on the imaging parameters in the main control console. MRiLab requires the
&#8216;Spiral&#8217; special technique tab to be loaded for properly configuring the &#8216;GySpiral&#8217;,
&#8216;GxSpiral&#8217; and &#8216;ADCSpiral&#8217; macro. The user can set tStart value as &#8216;VCtl.TE&#8217; to
acquire the echo signal.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-7300127"></a>


<!--l. 2224--><p class="noindent" ><img 
src="Pictures/GySpiral.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.27: </span><span  
class="content">GySpiral Waveform</span></div><!--tex4ht:label?: x10-7300127 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-740005.2.4"></a>GyFSE</h5>
<!--l. 2232--><p class="noindent" >A GyPE macro that creates a FSE phase encoding gradient pulse train (Figure <a 
href="#x10-7400128">5.28<!--tex4ht:ref: fig:GyFSE --></a>)
on GyPE sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tMiddle (s) : The middle time of the gradient pulse train
     </li>
     <li class="itemize">tOffset (s) : The time offset of the gradient pulse
     </li>
     <li class="itemize">tGy1 (s) : The duration of the phase encoding gradient
     </li>
     <li class="itemize">tGy2 (s) : The duration of the rephasing gradient
     </li>
     <li class="itemize">Gy1Sign : The polarity of the phase encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gy2Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2245--><p class="indent" >   Notice that the phase encoding gradient and the rephasing gradient have the
same area that is automatically calculated based on the imaging parameters in the
main control console. MRiLab requires the &#8216;FSE&#8217; special technique tab to be loaded
for properly configuring the &#8216;GyFSE&#8217;, &#8216;GxFSE&#8217; and &#8216;ADCFSE&#8217; macro. To satisfy
Carr Purcell Meiboom Gill (CPMG) condition and acquire echo signal at the center
between two consecutive refocusing RF pulse, the effective TE value must equal
(floor(FSE_ETL/2)+1)*FSE_ESP. The user can set tMiddle value as &#8216;VCtl.TE&#8217;
to acquire the echo signal, where the &#8216;VCtl.TE&#8217; becomes the effective TE
value.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-7400128"></a>


<!--l. 2249--><p class="noindent" ><img 
src="Pictures/GyFSE.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.28: </span><span  
class="content">GyFSE Waveform</span></div><!--tex4ht:label?: x10-7400128 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-750005.2.4"></a>GyEPI</h5>
<!--l. 2256--><p class="noindent" >A GyPE macro that creates an EPI phase encoding gradient pulse train (Figure <a 
href="#x10-7500129">5.29<!--tex4ht:ref: fig:GyEPI --></a>)
on GyPE sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t2Middle (s) : The middle time of the blip gradient pulse train
     </li>
     <li class="itemize">t1Start (s) : The prephasing gradient starting time
     </li>
     <li class="itemize">Gy1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gy2Sign : The polarity of the blip gradient train, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2267--><p class="indent" >   Notice that the area of the prephasing gradient and the blip gradient are
automatically calculated based on the imaging parameters in the main control
console. MRiLab requires the &#8216;EPI&#8217; special technique tab to be loaded for properly
configuring the &#8216;GyEPI&#8217;, &#8216;GxEPI&#8217; and &#8216;ADCEPI&#8217; macro. The user can set t2Middle
value as &#8216;VCtl.TE&#8217; to acquire the echo signal, where the &#8216;VCtl.TE&#8217; becomes the
effective TE value.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-7500129"></a>


<!--l. 2271--><p class="noindent" ><img 
src="Pictures/GyEPI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.29: </span><span  
class="content">GyEPI Waveform</span></div><!--tex4ht:label?: x10-7500129 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-760005.2.4"></a>GyUser</h5>
<!--l. 2279--><p class="noindent" >If the user has gradient pulse data saved in a MAT file, the user can easily import the
gradient file into MRiLab by using &#8216;GyUser&#8217; macro. The gradient pulse MAT file needs
to contain two matrices including &#8216;GTime&#8217; (i.e. gradient time points) and &#8216;GAmp&#8217;
(i.e. gradient amplitude). Both matrices must have the same size of m-by-n, where m
is the number of TR sections and n is the number of gradient waveform points. In
typical MR sequence, the entire sequence is composed of multiple TR sections. The
<!--l. 2279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th TR section uses
the <!--l. 2279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th gradient pulse
stored in the <!--l. 2279--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
row of these two matrices. If the number of row is less than the number of TR
sections, the last gradient pulse will be used for all the remaining TR sections. The
&#8216;GyUser&#8217; macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">GyFile : The path to the file that stores the gradient pulse data, quoted
     using single quotes
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2290--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.5   </span> <a 
 id="x10-770005.2.5"></a>GxR Macro Library</h4>
<!--l. 2292--><p class="noindent" >A GxR macro is a predefined module for a gradient pulse on the GxR sequence line.
MRiLab GxR macro library is a collection of GxR macros covering different gradient
pulse types for performing frequency encoding. Notice that by default the area under
the gradient ramp is ignored. This section will give an introduction to each of the
GxR macros provided in MRiLab.

</p><!--l. 2294--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-780005.2.5"></a>GxTrapezoid</h5>
<!--l. 2296--><p class="noindent" >Similar to GzTrapezoid (Figure <a 
href="#x10-6200122">5.22<!--tex4ht:ref: fig:GzTrapezoid --></a>), GxTrapezoid creates a trapezoid gradient pulse
on GxR sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">tRamp (s) : The trapezoid pulse ramp time, assume symmetric ramp on
     both side
     </li>
     <li class="itemize">sRamp : The sample points on the ramp, use the value of 2 for ignoring
     the area under the ramp, use above 2 for counting the ramp area
     </li>
     <li class="itemize">GxAmp (T) : The amplitude of the gradient
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2311--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-790005.2.5"></a>GxAreaTrapezoid</h5>
<!--l. 2313--><p class="noindent" >Similar to GzAreaTrapezoid (Figure <a 
href="#x10-6300123">5.23<!--tex4ht:ref: fig:GzAreaTrapezoid --></a>), GxAreaTrapezoid creates a trapezoid
gradient pulse of specified area on GxR sequence line. This macro contains attributes
including:
</p>

     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">tEnd (s) : The trapezoid gradient pulse ending time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2325--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-800005.2.5"></a>GxAreaTrapezoid2</h5>
<!--l. 2327--><p class="noindent" >Similar to GzAreaTrapezoid2 (Figure <a 
href="#x10-6400124">5.24<!--tex4ht:ref: fig:GzAreaTrapezoid2 --></a>), GxAreaTrapezoid2 creates a trapezoid
gradient pulse of specified area with highest system performance on GxR sequence
line. This macro creates a gradient pulse with nearly shortest pulse width
for the given system hardware constraint. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The trapezoid gradient pulse starting time
     </li>
     <li class="itemize">Area (1/m) : The area under this gradient pulse
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates

     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2338--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-810005.2.5"></a>GxCartesian</h5>
<!--l. 2340--><p class="noindent" >A GxR macro that creates a Cartesian frequency encoding gradient pulse (Figure
<a 
href="#x10-8100130">5.30<!--tex4ht:ref: fig:GxCartesian --></a>) on GxR sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t1Start (s) : The prephasing gradient pulse starting time
     </li>
     <li class="itemize">t2Middle (s) : The frequency encoding gradient pulse middle time
     </li>
     <li class="itemize">t3Start (s) : The rephasing gradient pulse starting time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">Gx1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx2Sign : The polarity of the frequency encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx3Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2356--><p class="indent" >   Notice that both the prephasing gradient and rephasing gradient have half of the
area of the frequency encoding gradient.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-8100130"></a>


<!--l. 2360--><p class="noindent" ><img 
src="Pictures/GxCartesian.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.30: </span><span  
class="content">GxCartesian Waveform</span></div><!--tex4ht:label?: x10-8100130 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-820005.2.5"></a>GxRadial</h5>
<!--l. 2367--><p class="noindent" >Similar to GyRadial (Figure <a 
href="#x10-7200126">5.26<!--tex4ht:ref: fig:GyRadial --></a>), GxRadial creates a phase encoding gradient pulse
for radial <span 
class="cmti-10">k</span>-space trajectory on GxR sequence line. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">t1Start (s) : The prephasing gradient pulse starting time
     </li>
     <li class="itemize">t2Middle (s) : The phase encoding gradient pulse middle time
     </li>
     <li class="itemize">t3Start (s) : The rephasing gradient pulse starting time
     </li>
     <li class="itemize">tRamp (s) : Gradient pulse ramp time, assume symmetric ramp on both
     side
     </li>
     <li class="itemize">Gx1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx2Sign : The polarity of the phase encoding gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx3Sign : The polarity of the rephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2381--><p class="indent" >   Notice that both the prephasing gradient and rephasing gradient have half of the
area of the phase encoding gradient that is automatically calculated based on the
imaging parameters in the main control console. MRiLab requires the &#8216;Radial&#8217; special
technique tab to be loaded for properly configuring the &#8216;GyRadial&#8217;, &#8216;GxRadial&#8217; and
&#8216;ADCRadial&#8217; macro. The user can set t2Middle value as &#8216;VCtl.TE&#8217; to acquire the
echo signal.

</p><!--l. 2383--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-830005.2.5"></a>GxSpiral</h5>
<!--l. 2385--><p class="noindent" >Similar to GySpiral (Figure <a 
href="#x10-7300127">5.27<!--tex4ht:ref: fig:GySpiral --></a>), GxSpiral creates a phase encoding gradient pulse
for spiral <span 
class="cmti-10">k</span>-space trajectory on GxR sequence line. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The phase encoding gradient pulse starting time
     </li>
     <li class="itemize">dt (s) : The time interval of gradient pulse sample points
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2394--><p class="indent" >   Notice that the area of the phase encoding gradient is automatically calculated
based on the imaging parameters in the main control console. MRiLab requires the
&#8216;Spiral&#8217; special technique tab to be loaded for properly configuring the &#8216;GySpiral&#8217;,
&#8216;GxSpiral&#8217; and &#8216;ADCSpiral&#8217; macro. The user can set tStart value as &#8216;VCtl.TE&#8217; to
acquire the echo signal.
</p><!--l. 2396--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-840005.2.5"></a>GxFSE</h5>
<!--l. 2398--><p class="noindent" >A GxR macro that creates a FSE frequency encoding gradient pulse train (Figure
<a 
href="#x10-8400131">5.31<!--tex4ht:ref: fig:GxFSE --></a>) on GxR sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t2Middle (s) : The middle time of the gradient pulse train
     </li>
     <li class="itemize">t1Start (s) : The prephasing gradient starting time
     </li>
     <li class="itemize">Gx1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx2Sign : The polarity of the frequency encoding gradient train, set 0 for
     nulling

     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2409--><p class="indent" >   Notice that the prephasing gradient has half of the area of the frequency encoding
gradient that is automatically calculated based on the imaging parameters in the
main control console. MRiLab requires the &#8216;FSE&#8217; special technique tab to
be loaded for properly configuring the &#8216;GyFSE&#8217;, &#8216;GxFSE&#8217; and &#8216;ADCFSE&#8217;
macro. To satisfy CPMG condition and acquire echo signal at the center
between two consecutive refocusing RF pulse, the effective TE value must equal
(floor(FSE_ETL/2)+1)*FSE_ESP. The user can set t2Middle value as &#8216;VCtl.TE&#8217;
to acquire the echo signal, where the &#8216;VCtl.TE&#8217; becomes the effective TE
value.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-8400131"></a>


<!--l. 2413--><p class="noindent" ><img 
src="Pictures/GxFSE.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.31: </span><span  
class="content">GxFSE Waveform</span></div><!--tex4ht:label?: x10-8400131 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-850005.2.5"></a>GxEPI</h5>
<!--l. 2420--><p class="noindent" >A GxR macro that creates an EPI frequency encoding gradient pulse train (Figure
<a 
href="#x10-8500132">5.32<!--tex4ht:ref: fig:GxEPI --></a>) on GxR sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">t2Middle (s) : The middle time of the frequency encoding gradient pulse
     train
     </li>
     <li class="itemize">t1Start (s) : The prephasing gradient starting time
     </li>
     <li class="itemize">Gx1Sign : The polarity of the prephasing gradient, set 0 for nulling
     </li>
     <li class="itemize">Gx2Sign : The polarity of the frequency encoding gradient train, set 0 for
     nulling
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2431--><p class="indent" >   Notice that the area of the prephasing gradient and the frequency encoding
gradient are automatically calculated based on the imaging parameters in the main
control console. MRiLab requires the &#8216;EPI&#8217; special technique tab to be loaded for
properly configuring the &#8216;GyEPI&#8217;, &#8216;GxEPI&#8217; and &#8216;ADCEPI&#8217; macro. The user can set
t2Middle value as &#8216;VCtl.TE&#8217; to acquire the echo signal, where the &#8216;VCtl.TE&#8217; becomes
the effective TE value.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-8500132"></a>


<!--l. 2435--><p class="noindent" ><img 
src="Pictures/GxEPI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.32: </span><span  
class="content">GxEPI Waveform</span></div><!--tex4ht:label?: x10-8500132 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-860005.2.5"></a>GxUser</h5>
<!--l. 2442--><p class="noindent" >If the user has gradient pulse data saved in a MAT file, the user can easily import the
gradient file into MRiLab by using &#8216;GxUser&#8217; macro. The gradient pulse MAT file needs
to contain two matrices including &#8216;GTime&#8217; (i.e. gradient time points) and &#8216;GAmp&#8217;
(i.e. gradient amplitude). Both matrices must have the same size of m-by-n, where m
is the number of TR sections and n is the number of gradient waveform points. In
typical MR sequence, the entire sequence is composed of multiple TR sections. The
<!--l. 2442--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th TR section uses
the <!--l. 2442--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th gradient pulse
stored in the <!--l. 2442--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
row of these two matrices. If the number of row is less than the number of TR
sections, the last gradient pulse will be used for all the remaining TR sections. The
&#8216;GxUser&#8217; macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">GxFile : The path to the file that stores the gradient pulse data, quoted
     using single quotes
     </li>
     <li class="itemize">Switch : The flag for turning on and off gradient pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the gradient pulse duplicates, used for creating
     multiple gradient pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between gradient pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the gradient pulse</li></ul>
<!--l. 2453--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.6   </span> <a 
 id="x10-870005.2.6"></a>ADC Macro Library</h4>
<!--l. 2455--><p class="noindent" >An ADC macro is a predefined module for an ADC flag pulse on the ADC sequence
line. Signal acquisition starts when ADC flag is 1 and stops when ADC flag is 0. The
ADC flag pulse is sampled at certain sampling rate determined by the imaging
parameters (default by using &#8216;BandWidth&#8217;) in the main control console. MRiLab
ADC macro library is a collection of ADC macros covering different pulse types for
performing signal acquisition. This section will give an introduction to each of the
ADC macros provided in MRiLab.

</p><!--l. 2457--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-880005.2.6"></a>ADCBlock</h5>
<!--l. 2459--><p class="noindent" >An ADC macro that creates an ADC flag pulse with user defined sampling rate on
ADC sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The ADC starting time
     </li>
     <li class="itemize">tEnd (s) : The ADC ending time
     </li>
     <li class="itemize">sSample : The number of linear sample points when ADC flag is 1
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the ADC pulse duplicates, used for creating
     multiple ADC pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between ADC pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-8800133"></a>


<!--l. 2473--><p class="noindent" ><img 
src="Pictures/ADCBlock.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.33: </span><span  
class="content">ADCBlock Waveform</span></div><!--tex4ht:label?: x10-8800133 -->

   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x10-890005.2.6"></a>ADCCartesian</h5>
<!--l. 2481--><p class="noindent" >An ADC macro that creates an ADC flag pulse for Cartesian readout on ADC
sequence line. This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tMiddle (s) : The ADC middle time, typically set &#8216;VCtl.TE&#8217; for acquiring
     echo signal
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the ADC pulse duplicates, used for creating
     multiple ADC pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between ADC pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>
<!--l. 2491--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-900005.2.6"></a>ADCRadial</h5>
<!--l. 2493--><p class="noindent" >An ADC macro that creates an ADC flag pulse for radial readout on ADC sequence
line. This macro needs &#8216;Radial&#8217; tab to be loaded. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tMiddle (s) : The ADC middle time, typically set &#8216;VCtl.TE&#8217; for acquiring
     echo signal
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>

<!--l. 2501--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-910005.2.6"></a>ADCSpiral</h5>
<!--l. 2503--><p class="noindent" >An ADC macro that creates an ADC flag pulse for spiral readout on ADC sequence
line. This macro needs &#8216;Spiral&#8217; tab to be loaded. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The ADC starting time, typically set &#8216;VCtl.TE&#8217; for acquiring
     echo signal
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>
<!--l. 2512--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-920005.2.6"></a>ADCFSE</h5>
<!--l. 2514--><p class="noindent" >An ADC macro that creates an ADC flag pulse train for FSE readout on ADC
sequence line. This macro needs &#8216;FSE&#8217; tab to be loaded. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tMiddle (s) : The ADC pulse train middle time, typically set &#8216;VCtl.TE&#8217;
     for acquiring echo signal
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>
<!--l. 2522--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-930005.2.6"></a>ADCEPI</h5>
<!--l. 2524--><p class="noindent" >An ADC macro that creates an ADC flag pulse train for EPI readout on ADC
sequence line. This macro needs &#8216;EPI&#8217; tab to be loaded. This macro contains
attributes including:
</p>

     <ul class="itemize1">
     <li class="itemize">tMiddle (s) : The ADC pulse train middle time, typically set &#8216;VCtl.TE&#8217;
     for acquiring echo signal
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>
<!--l. 2532--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-940005.2.6"></a>ADCUser</h5>
<!--l. 2534--><p class="noindent" >If the user has ADC pulse data saved in a MAT file, the user can easily import the
ADC file into MRiLab by using &#8216;ADCUser&#8217; macro. The ADC pulse MAT file needs to
contain two matrices including &#8216;GTime&#8217; (i.e. ADC time points) and &#8216;GAmp&#8217; (i.e.
ADC amplitude, use 1 for signal acquisition, 0 for no signal acquisition).
Both matrices must have the same size of m-by-n, where m is the number of
TR sections and n is the number of ADC sample points. In typical MR
sequence, the entire sequence is composed of multiple TR sections. The
<!--l. 2534--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th TR section uses
the <!--l. 2534--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th ADC pulse
stored in the <!--l. 2534--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
row of these two matrices. If the number of row is less than the number of TR
sections, the last ADC pulse will be used for all the remaining TR sections. The
&#8216;ADCUser&#8217; macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">ADCFile : The path to the file that stores the ADC pulse data, quoted
     using single quotes
     </li>
     <li class="itemize">Switch : The flag for turning on and off ADC pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the ADC pulse duplicates, used for creating
     multiple ADC pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between ADC pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the ADC pulse</li></ul>

<!--l. 2544--><p class="indent" >   Notice that &#8216;ADCUser&#8217; macro sets the first and last ADC sample points to 0
regardless of their original value, therefore the signal is not acquired at the first and
last time points.
</p><!--l. 2546--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.7   </span> <a 
 id="x10-950005.2.7"></a>Ext Macro Library</h4>
<!--l. 2548--><p class="noindent" >An Ext macro is a predefined module for an Ext flag pulse on the Ext sequence line.
MRiLab specifies Ext signal for performing extended real time processes including
calculating remaining scan time, manipulating <span 
class="cmti-10">k</span>-space location and triggering object
motion etc. Ext macro library only contains &#8216;ExtBit&#8217; macro, however the &#8216;Ext&#8217;
attribute in this macro triggers different processes.
</p><!--l. 2550--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-960005.2.7"></a>ExtBit</h5>
<!--l. 2552--><p class="noindent" >The &#8216;ExtBit&#8217; macro (Figure <a 
href="#x10-9600134">5.34<!--tex4ht:ref: fig:ExtBit --></a>) creates a triangle blip pulse on Ext sequence line.
This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The Ext starting time
     </li>
     <li class="itemize">Ext : The Ext flag
     </li>
     <li class="itemize">Switch : The flag for turning on and off Ext pulse in the sequence line
     </li>
     <li class="itemize">Duplicates : The number of the Ext pulse duplicates, used for creating
     multiple Ext pulses with the same shape
     </li>
     <li class="itemize">DupSpacing : The time spacing between Ext pulse duplicates
     </li>
     <li class="itemize">Notes : The notes of the Ext pulse</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-9600134"></a>


<!--l. 2565--><p class="noindent" ><img 
src="Pictures/ExtBit.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.34: </span><span  
class="content">ExtBit Waveform</span></div><!--tex4ht:label?: x10-9600134 -->

   </div><hr class="endfigure" />
<!--l. 2571--><p class="indent" >   Different Ext flags execute different extended real time processes during runtime
scan. These extended processes are implemented using Plugin code in the
/MRiLab/Src/Plugin folder. MRiLab reserved several Ext flags for particular
purposes.
</p>
     <ul class="itemize1">
     <li class="itemize">1 : Plugin_ResetK, reset Kx, Ky and Kz to zero
     </li>
     <li class="itemize">2 : Plugin_ReverseK, reverse Kx, Ky and Kz
     </li>
     <li class="itemize">3 : Plugin_LockK, buffer current K space location
     </li>
     <li class="itemize">4 : Plugin_ReleaseK, set K space location to the latest buffered one, used
     after Plugin_LockK
     </li>
     <li class="itemize">5 : Plugin_Timer, calculate remaining scan time, display it on the main
     control console
     </li>
     <li class="itemize">6 : Plugin_IdealSpoiler, dephase transverse magnetization of all the spins,
     set them to zero
     </li>
     <li class="itemize">7 : Plugin_rfRef, buffer current rfPhase value and demodulate signal phase
     according to this value
     </li>
     <li class="itemize">8 : Plugin_ExecuteMotion, trigger object motion
     </li>
     <li class="itemize">9 : Plugin_RTRecon, trigger real time image reconstruction with currently
     stored <span 
class="cmti-10">k</span>-space data</li></ul>
   <h4 class="subsectionHead"><span class="titlemark">5.2.8   </span> <a 
 id="x10-970005.2.8"></a>Make New Ext Plugin</h4>
<!--l. 2587--><p class="noindent" >The user can define Ext flags and use Ext Plugin to create extended real time
process. To make your own Ext flag and Plugin code, you should follow the following
steps :
</p><!--l. 2589--><p class="indent" >
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-97002x1">Write Ext Plugin code <br 
class="newline" />

     <!--l. 2593--><p class="noindent" >It is strongly recommended to write your Plugin code based on a template
     like :

</p>
     <div class="verbatim" id="verbatim-8">
     &#x00A0;<br />function&#x00A0;Plugin_YourPluginName
     &#x00A0;<br />%Create&#x00A0;a&#x00A0;Ext&#x00A0;Plugin&#x00A0;based&#x00A0;on&#x00A0;your&#x00A0;code
     &#x00A0;<br />global&#x00A0;VCtl&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VCtl&#x00A0;structure,&#x00A0;read&#x00A0;only
     &#x00A0;<br />global&#x00A0;VVar&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VVar&#x00A0;structure,&#x00A0;read&#x00A0;only
     &#x00A0;<br />global&#x00A0;VObj&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VObj&#x00A0;structure,&#x00A0;read&#x00A0;and&#x00A0;write
     &#x00A0;<br />global&#x00A0;VMag&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VMag&#x00A0;structure,&#x00A0;read&#x00A0;and&#x00A0;write
     &#x00A0;<br />global&#x00A0;VCoi&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VCoi&#x00A0;structure,&#x00A0;read&#x00A0;and&#x00A0;write
     &#x00A0;<br />
     &#x00A0;<br />...
     &#x00A0;<br />%&#x00A0;The&#x00A0;main&#x00A0;code&#x00A0;for&#x00A0;your&#x00A0;Ext&#x00A0;Plugin
     &#x00A0;<br />...
     &#x00A0;<br />
     &#x00A0;<br />end
     &#x00A0;<br />
     &#x00A0;<br />
</div>
     <!--l. 2612--><p class="nopar" >
     </p><!--l. 2614--><p class="noindent" >As mentioned before, VCtl encapsules all the simulation setting parameters in
     the main control console. VVar not only encapsules loop index variables
     that MRiLab uses for generating MR sequence waveform, but also
     contains variables for temporarily buffering instant sequence line values
     during runtime. <span 
class="cmbx-10">Do keep in mind, VCtl and VVar are read only,</span>
     <span 
class="cmbx-10">changing values inside these two structures may cause MRiLab</span>
     <span 
class="cmbx-10">crash.</span>
</p>
         <ul class="itemize1">
         <li class="itemize">VVar.rfAmp (T) : A array with the size of <!--l. 2617--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>1</mn></math>
         for storing current RF amplitude
         </li>
         <li class="itemize">VVar.rfPhase (rad) : A array with the size of <!--l. 2618--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>1</mn></math>
         for storing current RF phase
         </li>
         <li class="itemize">VVar.rfFreq (Hz) : A array with the size of <!--l. 2619--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>T</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>1</mn></math>
         for storing current RF frequency
         </li>
         <li class="itemize">VVar.rfCoil : The CoilID of current working coil channel, used in
         multiple RF transmitting

         </li>
         <li class="itemize">VVar.rfRef (rad) : The buffered RF phase, used for demodulating
         signal phase at ADC
         </li>
         <li class="itemize">VVar.GzAmp (T/m) : The current GzSS gradient amplitude
         </li>
         <li class="itemize">VVar.GyAmp (T/m) : The current GyPE gradient amplitude
         </li>
         <li class="itemize">VVar.GxAmp (T/m) : The current GXR gradient amplitude
         </li>
         <li class="itemize">VVar.ADC : The current ADC flag
         </li>
         <li class="itemize">VVar.Ext : The current Ext flag
         </li>
         <li class="itemize">VVar.t (s) : The current time
         </li>
         <li class="itemize">VVar.Kz (1/m) : The current Kz value
         </li>
         <li class="itemize">VVar.Ky (1/m) : The current Ky value
         </li>
         <li class="itemize">VVar.Kx (1/m) : The current Kx value
         </li>
         <li class="itemize">VVar.TRCount : The current TR section index</li></ul>
     <!--l. 2635--><p class="noindent" >Notice that there are three new Virtual Structures (VObj, VMag and VCoi) in
     this template, they store variables about the virtual object, B0 field and coil B1
     field which are accessible and editable in Plugin code. <span 
class="cmbx-10">Do keep in</span>
     <span 
class="cmbx-10">mind, do not change the size of the matrices inside these three</span>
     <span 
class="cmbx-10">structures.</span>
</p>
         <ul class="itemize1">
         <li class="itemize">VObj.Rho : A matrix with the size of <!--l. 2638--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing spin density
         </li>
         <li class="itemize">VObj.T1 (s) : A matrix with the size of <!--l. 2639--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T1 relaxation time
         </li>
         <li class="itemize">VObj.T2 (s) : A matrix with the size of <!--l. 2640--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2 relaxation time

         </li>
         <li class="itemize">VObj.Mx : A matrix with the size of <!--l. 2641--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>S</mi><mi 
>p</mi><mi 
>i</mi><mi 
>n</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>V</mi> <mi 
>o</mi><mi 
>x</mi><mi 
>e</mi><mi 
>l</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing magnetization in <!--l. 2641--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
         direction
         </li>
         <li class="itemize">VObj.My : A matrix with the size of <!--l. 2642--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>S</mi><mi 
>p</mi><mi 
>i</mi><mi 
>n</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>V</mi> <mi 
>o</mi><mi 
>x</mi><mi 
>e</mi><mi 
>l</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing magnetization in <!--l. 2642--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
         direction
         </li>
         <li class="itemize">VObj.Mz : A matrix with the size of <!--l. 2643--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>S</mi><mi 
>p</mi><mi 
>i</mi><mi 
>n</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>V</mi> <mi 
>o</mi><mi 
>x</mi><mi 
>e</mi><mi 
>l</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing magnetization in <!--l. 2643--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>z</mi></math>
         direction
         </li>
         <li class="itemize">VMag.dWRnd (rad/s) : A matrix with the size of <!--l. 2644--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>S</mi><mi 
>p</mi><mi 
>i</mi><mi 
>n</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>V</mi> <mi 
>o</mi><mi 
>x</mi><mi 
>e</mi><mi 
>l</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing microscopic resonance frequency variation caused by
         T2* effect
         </li>
         <li class="itemize">VMag.dB0 (T) : A matrix with the size of <!--l. 2645--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing local B0 field variation
         </li>
         <li class="itemize">VMag.Gxgrid (m) : A matrix with the size of <!--l. 2646--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing spatial grid in X direction
         </li>
         <li class="itemize">VMag.Gygrid (m) : A matrix with the size of <!--l. 2647--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing spatial grid in Y direction
         </li>
         <li class="itemize">VMag.Gzgrid (m) : A matrix with the size of <!--l. 2648--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing spatial grid in Z direction
         </li>
         <li class="itemize">VCoi.TxCoilmg (T) : A matrix with the size of <!--l. 2649--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing the magnitude of transmitting B1+ field
         </li>
         <li class="itemize">VCoi.TxCoilpe (rad) : A matrix with the size of <!--l. 2650--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing the phase of transmitting B1+ field
         </li>
         <li class="itemize">VCoi.RxCoilx (T) : A matrix with the size of <!--l. 2651--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing the <!--l. 2651--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
         component of receiving B1- field
         </li>
         <li class="itemize">VCoi.RxCoily (T) : A matrix with the size of <!--l. 2652--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing the <!--l. 2652--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
         component of receiving B1- field</li></ul>

     <!--l. 2655--><p class="noindent" >where &#8216;TxCoilNum&#8217; is the number of transmitting coil channels, &#8216;RxCoilNum&#8217; is
     the number of receiving coil channels.
     </p></li>
     <li 
  class="enumerate" id="x10-97004x2">Register Ext Plugin <br 
class="newline" />
     <!--l. 2659--><p class="noindent" >The user needs to register customized Plugins before MRiLab can use it. To
     register Plugins and assign Ext flags to them, simply open &#8216;DoExtPlugin.m&#8217;
     under /MRiLab/Src/Main folder.

</p>
     <div class="verbatim" id="verbatim-9">
     function&#x00A0;DoExtPlugin
     &#x00A0;<br />%&#x00A0;entry&#x00A0;function&#x00A0;for&#x00A0;extended&#x00A0;plugin&#x00A0;based&#x00A0;on&#x00A0;Ext&#x00A0;flag
     &#x00A0;<br />global&#x00A0;VVar
     &#x00A0;<br />
     &#x00A0;<br />switch&#x00A0;VVar.Ext
     &#x00A0;<br />%%&#x00A0;System&#x00A0;Reserved&#x00A0;Ext&#x00A0;Flags&#x00A0;(Positive)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;0&#x00A0;%&#x00A0;normal&#x00A0;status
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;do&#x00A0;nothing
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;1&#x00A0;%&#x00A0;reset&#x00A0;K&#x00A0;space&#x00A0;location
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_ResetK;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;2&#x00A0;%&#x00A0;reverse&#x00A0;K&#x00A0;space&#x00A0;location
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_ReverseK;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;3&#x00A0;%&#x00A0;lock&#x00A0;K&#x00A0;space&#x00A0;location
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_LockK;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;4&#x00A0;%&#x00A0;release&#x00A0;K&#x00A0;space&#x00A0;location
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_ReleaseK;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;5&#x00A0;%&#x00A0;calculate&#x00A0;remaining&#x00A0;scan&#x00A0;time
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_Timer;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;6&#x00A0;%&#x00A0;ideal&#x00A0;spoiler,&#x00A0;dephase&#x00A0;Mxy
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_IdealSpoiler;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;7&#x00A0;%&#x00A0;rfRef,&#x00A0;demodulate&#x00A0;signal&#x00A0;phase&#x00A0;referring&#x00A0;to&#x00A0;RF&#x00A0;phase&#x00A0;at&#x00A0;ADC
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_rfRef;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;8&#x00A0;%&#x00A0;trigger&#x00A0;object&#x00A0;motion
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_ExecuteMotion;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;9&#x00A0;%&#x00A0;real&#x00A0;time&#x00A0;image&#x00A0;recon
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_RTRecon;
     &#x00A0;<br />
     &#x00A0;<br />%%&#x00A0;User&#x00A0;Defined&#x00A0;Ext&#x00A0;Flags&#x00A0;(Negative)
     &#x00A0;<br />%&#x00A0;add&#x00A0;user&#x00A0;defined&#x00A0;Ext&#x00A0;flags&#x00A0;here&#x00A0;using&#x00A0;case&#x00A0;syntax
     &#x00A0;<br />%&#x00A0;e.g.&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;-5
     &#x00A0;<br />%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;Plugin_XXX;
     &#x00A0;<br />
     &#x00A0;<br />end
     &#x00A0;<br />end
</div>
     <!--l. 2696--><p class="nopar" >
     </p><!--l. 2698--><p class="noindent" >Add one more Switch case line, assign a distinct Ext flag, then add user defined
     Plugin function name under the case line. It is recommended to use
     negative Ext flag for user defined Plugin to differ from system reserved
     plugins.

     </p></li>
     <li 
  class="enumerate" id="x10-97006x3">Register to refresh GPU device memory <br 
class="newline" />
     <!--l. 2702--><p class="noindent" >If the customized Plugin function modifies any variables in VObj, VMag or
     VCoi, the Plugin function needs to be registered for refreshing GPU device
     memory in case GPU parallel computing method is chosen. Simply open
     &#8216;DoGPUFetch.m&#8217; under /MRiLab/Src/Main folder.

</p>
     <div class="verbatim" id="verbatim-10">
     function&#x00A0;DoGPUFetch
     &#x00A0;<br />%&#x00A0;fetch&#x00A0;data&#x00A0;from&#x00A0;GPU?
     &#x00A0;<br />%&#x00A0;VVar.gpuFetch&#x00A0;=&#x00A0;1&#x00A0;&#x00A0;fetch&#x00A0;data&#x00A0;from&#x00A0;GPU&#x00A0;memory&#x00A0;to&#x00A0;CPU&#x00A0;memory
     &#x00A0;<br />%&#x00A0;VVar.gpuFetch&#x00A0;=&#x00A0;0&#x00A0;&#x00A0;no&#x00A0;GPU&#x00A0;data&#x00A0;fetching
     &#x00A0;<br />global&#x00A0;VVar
     &#x00A0;<br />
     &#x00A0;<br />switch&#x00A0;VVar.Ext
     &#x00A0;<br />%%&#x00A0;System&#x00A0;Reserved&#x00A0;Ext&#x00A0;Flags&#x00A0;(Positive)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;6&#x00A0;%&#x00A0;ideal&#x00A0;spoiler,&#x00A0;dephase&#x00A0;Mxy
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.gpuFetch&#x00A0;=&#x00A0;1;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;8&#x00A0;%&#x00A0;trigger&#x00A0;object&#x00A0;motion
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.gpuFetch&#x00A0;=&#x00A0;1;
     &#x00A0;<br />
     &#x00A0;<br />
     &#x00A0;<br />%%&#x00A0;User&#x00A0;Defined&#x00A0;Ext&#x00A0;Flags&#x00A0;(Negative)
     &#x00A0;<br />%&#x00A0;add&#x00A0;user&#x00A0;defined&#x00A0;Ext&#x00A0;flags&#x00A0;here&#x00A0;using&#x00A0;case&#x00A0;syntax
     &#x00A0;<br />%&#x00A0;e.g.&#x00A0;&#x00A0;&#x00A0;&#x00A0;case&#x00A0;-5
     &#x00A0;<br />%&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;VVar.gpuFetch&#x00A0;=&#x00A0;1;
     &#x00A0;<br />
     &#x00A0;<br />end
     &#x00A0;<br />end
</div>
     <!--l. 2726--><p class="nopar" >
     </p><!--l. 2728--><p class="noindent" >Add one more Switch case line, assign VVar.gpuFetch equal to 1.
</p>
     </li></ol>
<!--l. 2732--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.9   </span> <a 
 id="x10-980005.2.9"></a>Make New Gradient Macro</h4>
<!--l. 2734--><p class="noindent" >The user can make customized gradient macros and use them to create desired
<span 
class="cmti-10">k</span>-space trajectory. To make your own gradient macro, you should follow the following
steps :
</p><!--l. 2737--><p class="indent" >
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-98002x1">Write gradient macro code <br 
class="newline" />

     <!--l. 2741--><p class="noindent" >It is strongly recommended to write your own gradient macro code based
     on similar gradient macros in the MRiLab macro library. One template is
     like :

</p>
     <div class="verbatim" id="verbatim-11">
     function&#x00A0;[GAmp,GTime]=GYourGradientMacroName(p)
     &#x00A0;<br />%Create&#x00A0;a&#x00A0;gradient&#x00A0;macro&#x00A0;based&#x00A0;on&#x00A0;your&#x00A0;code
     &#x00A0;<br />
     &#x00A0;<br />global&#x00A0;VCtl&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VCtl&#x00A0;structure,&#x00A0;read&#x00A0;only
     &#x00A0;<br />global&#x00A0;VObj&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VObj&#x00A0;structure,&#x00A0;read&#x00A0;only
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Create&#x00A0;attribute&#x00A0;list
     &#x00A0;<br />Duplicates=max(1,p.Duplicates);
     &#x00A0;<br />DupSpacing=max(0,p.DupSpacing);
     &#x00A0;<br />...
     &#x00A0;<br />attribute1=p.attribute1;
     &#x00A0;<br />attribute2=p.attribute2;
     &#x00A0;<br />attribute3=p.attribute3;
     &#x00A0;<br />...
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;The&#x00A0;main&#x00A0;code&#x00A0;for&#x00A0;your&#x00A0;macro
     &#x00A0;<br />...
     &#x00A0;<br />GTime&#x00A0;=&#x00A0;...;
     &#x00A0;<br />GAmp&#x00A0;=&#x00A0;...;
     &#x00A0;<br />...
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Avoid&#x00A0;baseline&#x00A0;offset
     &#x00A0;<br />GAmp(1)=0;
     &#x00A0;<br />GAmp(end)=0;
     &#x00A0;<br />
     &#x00A0;<br />%&#x00A0;Create&#x00A0;Duplicates
     &#x00A0;<br />if&#x00A0;Duplicates~=1&#x00A0;&amp;&#x00A0;DupSpacing&#x00A0;~=0
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;GAmp=repmat(GAmp,[1&#x00A0;Duplicates]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;TimeOffset&#x00A0;=&#x00A0;repmat(0:DupSpacing:(Duplicates-1)*DupSpacing,&#x00A0;...
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;[length(GTime)&#x00A0;1]);
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;GTime=repmat(GTime,[1&#x00A0;Duplicates])&#x00A0;+&#x00A0;(TimeOffset(:))&#8217;;
     &#x00A0;<br />end
     &#x00A0;<br />end
</div>
     <!--l. 2777--><p class="nopar" >
     </p></li>
     <li 
  class="enumerate" id="x10-98004x2">Register gradient macro <br 
class="newline" />
     <!--l. 2781--><p class="noindent" >The gradient macro file can be saved anywhere as long as the file is included in

     Matlab search path, however it is recommended to save the the file under
     corresponding gradient folder under /SeqElem folder for consistent file
     organization. The customized gradient macro needs to be registered in the
     macro library before using. To register the macro, open file &#8216;SeqElem.xml&#8217;
     under /SeqElem, then add one entry under gradient category with the proper
     attribute list. One example is

</p>
     <div class="verbatim" id="verbatim-12">
     &#x003C;GzGradientMacroName
     &#x00A0;<br />Switch="$1&#8217;on&#8217;,&#8217;off&#8217;"
     &#x00A0;<br />DupSpacing="0"
     &#x00A0;<br />Duplicates="1"
     &#x00A0;<br />Notes="A&#x00A0;new&#x00A0;Gz&#x00A0;gradient&#x00A0;macro"
     &#x00A0;<br />attribute1="$1&#8217;on&#8217;,&#8217;off&#8217;"
     &#x00A0;<br />attribute2="0"
     &#x00A0;<br />attribute3="0"&#x00A0;/&#x003E;
     &#x00A0;<br />
</div>
     <!--l. 2793--><p class="nopar" >
     </p><!--l. 2795--><p class="noindent" >Notice that in the above example, the first 3 attributes are required
     for MRiLab, The remaining attributes are optional based on user&#8217;s
     choice.
</p>
     </li></ol>
<!--l. 2799--><p class="indent" >   Once the gradient macro is coded and registered to the library, the user can
use this customized gradient macro just like default gradient macros in the
library.
</p><!--l. 2801--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.10   </span> <a 
 id="x10-990005.2.10"></a>Load and Edit MR Sequence from XML</h4>
<!--l. 2802--><p class="noindent" >To design a sequence in the MR Sequence Design interface, it is recommended to load
the sequence into the main control console first and then click toolbar icon to
activate the MR Sequence Design interface. This is mainly because imaging
parameters necessary for configuring current sequence will also be loaded
during the sequence loading process. However, if the interface has already
been activated, the user can also use the sequence loading function to load
another sequence with current imaging parameters. To load a sequence,
click &#8216;Load&#8217; menu then click &#8216;Load Sequence File&#8217;, choose a sequence XML
file.<br 
class="newline" />
</p><!--l. 2804--><p class="indent" >   Besides editing seuqence structue graphically, the user can also directly edit the
sequence XML file using Matlab editor by click &#8216;XML&#8217; then &#8216;Edit Seq XML&#8217;. After
modification, the user needs to save changes for the XML file and then click &#8216;Refresh
Seq Tree&#8217; to update sequence structure and waveform.

</p><!--l. 2806--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2.11   </span> <a 
 id="x10-1000005.2.11"></a>Make New MR Sequence</h4>
<!--l. 2807--><p class="noindent" >The user can create a new MR sequence in the MR Sequence Design interface. To
create a new sequence, click &#8216;New&#8217; then click &#8216;Create Sequence File&#8217;. A sequence
creation window (Figure <a 
href="#x10-10000135">5.35<!--tex4ht:ref: fig:NewPSD --></a>) will show up and ask for new sequence name and
notes. To follow MRiLab naming convention, the user is recommended to use &#8216;PSD_&#8217;
followed by a legal name string that differs from the existing sequences in MRiLab.
Then click &#8216;OK&#8217; to select a path for storing the sequence XML file. It&#8217;s strongly
recommended to put the sequence under the MRiLab sequence root folder
/MRiLab/PSD according to the sequence type so that the sequence is visible to
MRiLab. Finally, MRiLab will create a new sequence XML file based on the content
of &#8216;PSD_GRE3D&#8217;.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-10000135"></a>


<!--l. 2811--><p class="noindent" ><img 
src="Pictures/NewPSD.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.35: </span><span  
class="content">The Sequence Creation Window</span></div><!--tex4ht:label?: x10-10000135 -->

   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">5.3   </span> <a 
 id="x10-1010005.3"></a>Virtual Object Design</h3>
<!--l. 2819--><p class="noindent" >To design and optimize MR sequence, the user may need virtual objects with specific
geometry and properties according to their experiment purpose. Although MRiLab
provides a few phantoms with tissue properties mimicking several human
tissue types, the user may still need to define customized virtual object.
There are two ways of creating a new virtual object: 1) create phantom .mat
file directly; 2) create phantom using MRiLab phantom design tool with
XML.
</p><!--l. 2821--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3.1   </span> <a 
 id="x10-1020005.3.1"></a>Create Virtual Object Directly</h4>
<!--l. 2822--><p class="noindent" >To make a new virtual object using this method, you should follow the following
steps :
</p><!--l. 2824--><p class="indent" >
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-102002x1">Make Regular Virtual Object <br 
class="newline" />
     <!--l. 2828--><p class="noindent" >Create  a  Matlab  structure  &#8216;VObj&#8217;.  &#8216;VObj&#8217;  must  contains  variables
     including:
</p>
         <ul class="itemize1">
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">ChemShift (Hz/T) : A array with the size of <!--l. 2832--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing the chemical shift of the spins
         </li>
         <li class="itemize">XDim : The number of voxels in X direction
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction

         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction
         </li>
         <li class="itemize">Type : A string for describing the type of the spin
         </li>
         <li class="itemize">TypeNum : The number of spin species
         </li>
         <li class="itemize">ECon (S/m) : A matrix with the size of <!--l. 2841--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : A matrix with the size of <!--l. 2842--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue mass density (optional)
         </li>
         <li class="itemize">Rho : A matrix with the size of <!--l. 2843--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing spin density
         </li>
         <li class="itemize">T1 (s) : A matrix with the size of <!--l. 2844--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T1 relaxation time
         </li>
         <li class="itemize">T2 (s) : A matrix with the size of <!--l. 2845--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2 relaxation time
         </li>
         <li class="itemize">T2Star (s) : A matrix with the size of <!--l. 2846--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2* relaxation time</li></ul>
     <!--l. 2849--><p class="noindent" >Then save the &#8216;VObj&#8217; structure as a MAT file.
     </p></li>
     <li 
  class="enumerate" id="x10-102004x2">Make Virtual Object with Magnetization Transfer (MT) Properties<br 
class="newline" />
     <!--l. 2853--><p class="noindent" >The current MRiLab version supports two-pool MT model <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XYarnykh2002">9</a>]</span> including a free
     (<!--l. 2853--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>f</mi></math>) water pool and a
     macromolecule bound (<!--l. 2853--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>b</mi></math>)
     proton pool. The &#8216;VObj&#8217; must have the structure like:
</p>
         <ul class="itemize1">
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">ChemShift (Hz/T) : A array with the size of <!--l. 2857--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>2</mn></math>
         for describing the chemical shift of the spins, free pool first, bound
         pool second

         </li>
         <li class="itemize">XDim : The number of voxels in X direction
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction
         </li>
         <li class="itemize">Type : A string for describing the type of the spin
         </li>
         <li class="itemize">TypeNum : 2
         </li>
         <li class="itemize">ECon (S/m) : A matrix with the size of <!--l. 2866--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : A matrix with the size of <!--l. 2867--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue mass density (optional)
         </li>
         <li class="itemize">Rho : A matrix with the size of <!--l. 2868--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>2</mn></math>
         for describing spin density, <!--l. 2868--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>h</mi><msub><mrow 
><mi 
>o</mi></mrow><mrow 
><mi 
>f</mi></mrow></msub 
></math>
         (free pool) first, <!--l. 2868--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>h</mi><msub><mrow 
><mi 
>o</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
></math>
         (bound pool) second
         </li>
         <li class="itemize">T1 (s) : A matrix with the size of <!--l. 2869--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>2</mn></math>
         for describing T1 relaxation time, free pool first, bound pool second
         </li>
         <li class="itemize">T2 (s) : A matrix with the size of <!--l. 2870--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>2</mn></math>
         for describing T2 relaxation time, free pool first, bound pool second
         </li>
         <li class="itemize">T2Star (s) : A matrix with the size of <!--l. 2871--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>2</mn></math>
         for describing T2* relaxation time, free pool first, bound pool second
         </li>
         <li class="itemize">K (1/s) : A matrix with the size of <!--l. 2872--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>4</mn></math>
         for describing MT cross-relaxation rate, the <!--l. 2872--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>f</mi><mi 
>b</mi></mrow></msub 
></math>
         (free pool to bound pool) and the <!--l. 2872--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>b</mi><mi 
>f</mi></mrow></msub 
></math>
         (bound pool to free pool) is the second and third volume at the last

         dimension, respectively. The cross-relaxation rate to itself for any
         pool (i.e. <!--l. 2872--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>f</mi><mi 
>f</mi></mrow></msub 
></math>
         and <!--l. 2872--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>b</mi><mi 
>b</mi></mrow></msub 
></math>)
         is assumed to be zero.</li></ul>
     <!--l. 2875--><p class="noindent" >Notice that the two-pool MT model needs to satisfy chemical equilibrium described
     as <!--l. 2875--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>h</mi><msub><mrow 
><mi 
>o</mi></mrow><mrow 
><mi 
>f</mi></mrow></msub 
> <mo 
class="MathClass-bin">&#x00D7;</mo> <msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>f</mi><mi 
>b</mi></mrow></msub 
> <mo 
class="MathClass-rel">=</mo> <mi 
>R</mi><mi 
>h</mi><msub><mrow 
><mi 
>o</mi></mrow><mrow 
><mi 
>b</mi></mrow></msub 
> <mo 
class="MathClass-bin">&#x00D7;</mo> <msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>b</mi><mi 
>f</mi></mrow></msub 
></math>.
     After making VObj, then save the &#8216;VObj&#8217; structure as a MAT file. <span 
class="cmbx-10">Note</span>
     <span 
class="cmbx-10">that the Bloch-equation kernel is executed when the value of</span>
     <span 
class="cmbx-10">any sequence line updates. The time point at which update</span>
     <span 
class="cmbx-10">occurs is referred to as execution point. </span>To accurately model MT
     exchange during scan, the user needs to create execution points on
     the entire RF sequence line. A typical method is to insert a long RF
     pulse with zero amplitude at the empty portion of the RF sequence
     line. The interested users are referred to PSD_SPGR3DMT for more
     information.
     </p></li>
     <li 
  class="enumerate" id="x10-102006x3">Make Virtual Object with Multiple Exchanging (ME) Water Pools
     Properties<br 
class="newline" />
     <!--l. 2879--><p class="noindent" >The current MRiLab version supports multiple exchanging water pools model
     with flexible number of water pools. The &#8216;VObj&#8217; must have the structure
     like:
</p>
         <ul class="itemize1">
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">ChemShift (Hz/T) : A array with the size of <!--l. 2883--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi></math>
         for describing the chemical shift of the spins
         </li>
         <li class="itemize">XDim : The number of voxels in X direction
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction

         </li>
         <li class="itemize">Type : A string for describing the type of the spin
         </li>
         <li class="itemize">TypeNum : The number of pools
         </li>
         <li class="itemize">ECon (S/m) : A matrix with the size of <!--l. 2892--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : A matrix with the size of <!--l. 2893--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue mass density (optional)
         </li>
         <li class="itemize">Rho : A matrix with the size of <!--l. 2894--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing spin density
         </li>
         <li class="itemize">T1 (s) : A matrix with the size of <!--l. 2895--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T1 relaxation time
         </li>
         <li class="itemize">T2 (s) : A matrix with the size of <!--l. 2896--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2 relaxation time
         </li>
         <li class="itemize">T2Star (s) : A matrix with the size of <!--l. 2897--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2* relaxation time
         </li>
         <li class="itemize">K (1/s) : A matrix with the size of <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><msup><mrow 
><mi 
>m</mi></mrow><mrow 
><mn>2</mn></mrow></msup 
></math>
         for describing ME exchange rate. To explain the order of the exchange
         rate at the last dimension, for example, given there are three pools,
         the exchange rate is ordered as the first pool to itself <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>1</mn><mn>1</mn></mrow></msub 
></math>,
         to the second pool <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>1</mn><mn>2</mn></mrow></msub 
></math>,
         and to the third pool <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>1</mn><mn>3</mn></mrow></msub 
></math>,
         followed by <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>2</mn><mn>1</mn></mrow></msub 
></math>,
         <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>2</mn><mn>2</mn></mrow></msub 
></math>,
         <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>2</mn><mn>3</mn></mrow></msub 
></math>,
         <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>3</mn><mn>1</mn></mrow></msub 
></math>,
         <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>3</mn><mn>2</mn></mrow></msub 
></math>
         and <!--l. 2898--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mn>3</mn><mn>3</mn></mrow></msub 
></math>.
         The exchange rate to itself for any pool is assumed to be zero.</li></ul>
     <!--l. 2901--><p class="noindent" >Notice that the multiple-pool ME model also needs to satisfy chemical
     equilibrium analogous to that of MT model. After making VObj, then
     save the &#8216;VObj&#8217; structure as a MAT file. To accurately model ME
     exchange during scan, the user also needs to create execution points on
     the entire RF sequence line. A typical method is to insert a long RF
     pulse with zero amplitude at the empty portion of the RF sequence
     line. The interested users are referred to PSD_SPGR3DME for more
     information.

     </p></li>
     <li 
  class="enumerate" id="x10-102008x4">Make Virtual Object with Chemical Exchange Saturation Transfer (CEST)
     Properties<br 
class="newline" />
     <!--l. 2906--><p class="noindent" >The current MRiLab version supports three-pool CEST model including a free
     (<!--l. 2906--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>f</mi></math>)
     water pool, a macromolecule bound
     (<!--l. 2906--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>b</mi></math>) proton pool and
     a free CEST (<!--l. 2906--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>c</mi></math>)
     pool. The &#8216;VObj&#8217; must have the structure like:
</p>
         <ul class="itemize1">
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">ChemShift (Hz/T) : A array with the size of <!--l. 2910--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for describing the chemical shift of the spins, free pool first, bound
         pool second, CEST pool last
         </li>
         <li class="itemize">XDim : The number of voxels in X direction
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction
         </li>
         <li class="itemize">Type : A string for describing the type of the spin
         </li>
         <li class="itemize">TypeNum : 3
         </li>
         <li class="itemize">ECon (S/m) : A matrix with the size of <!--l. 2919--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : A matrix with the size of <!--l. 2920--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue mass density (optional)

         </li>
         <li class="itemize">Rho : A matrix with the size of <!--l. 2921--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for describing spin density, free pool first, bound pool second, CEST
         pool last
         </li>
         <li class="itemize">T1 (s) : A matrix with the size of <!--l. 2922--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for describing T1 relaxation time, free pool first, bound pool second,
         CEST pool last
         </li>
         <li class="itemize">T2 (s) : A matrix with the size of <!--l. 2923--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for describing T2 relaxation time, free pool first, bound pool second,
         CEST pool last
         </li>
         <li class="itemize">T2Star (s) : A matrix with the size of <!--l. 2924--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for describing T2* relaxation time, free pool first, bound pool second,
         CEST pool last
         </li>
         <li class="itemize">K (1/s) : A matrix with the size of <!--l. 2925--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>4</mn></math>
         for describing CEST exchange rate. The order of the exchange rate at
         the last dimension is <!--l. 2925--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>f</mi><mi 
>b</mi></mrow></msub 
></math>,
         <!--l. 2925--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>f</mi><mi 
>c</mi></mrow></msub 
></math>,
         <!--l. 2925--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>b</mi><mi 
>f</mi></mrow></msub 
></math>,
         and <!--l. 2925--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><msub><mrow 
><mi 
>K</mi></mrow><mrow 
><mi 
>c</mi><mi 
>f</mi></mrow></msub 
></math>.
         No exchange between bound pool and CEST pool is assumed.</li></ul>
     <!--l. 2928--><p class="noindent" >Notice that the CEST model also needs to satisfy chemical equilibrium
     analogous to that of MT model. After making VObj, then save the &#8216;VObj&#8217;
     structure as a MAT file. To accurately model CEST exchange during scan, the
     user also needs to create execution points on the entire RF sequence line. A
     typical method is to insert a long RF pulse with zero amplitude at the empty
     portion of the RF sequence line. The interested users are referred to
     PSD_SPGR3DCEST for more information.
     </p></li>
     <li 
  class="enumerate" id="x10-102010x5">Make Virtual Object with Generalized Multi-pool (GM) Exchanging Model
     Properties<br 
class="newline" />
     <hr class="figure" /><div class="figure" 
><a 
 id="x10-10201136"></a>   <img 
src="Pictures/GeneralizedExchangeModel.png" alt="pict"  
 />
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;5.36: </span><span  
class="content">Generalized Multi-pool Exchanging Model</span></div><!--tex4ht:label?: x10-10201136 -->
     </div><hr class="endfigure" />
     <!--l. 2940--><p class="noindent" >MRiLab v1.3 and above supports generalized multi-pool (GM) exchanging
     model (Figure <a 
href="#x10-10201136">5.36<!--tex4ht:ref: fig:GeneralizedExchangeModel --></a>) with flexible number of proton pools. The model consists of
     free proton pools, all inter-connected by the magnetization exchange
     pathways, and bound proton pools exchanging with the free proton

     pools through MT. The free proton pools represent compartments with
     measurable transverse magnetization (e.g., water, fat, solute proton exchange
     compounds), while the bound proton pools are used to model semi-solid tissue
     macromolecular content non-visible on standard MRI (e.g., myelin, muscle
     fibers, collagen). A particular configuration of the generalized model
     (i.e., number of the pools, their type, and exchange pathways between
     them) can be chosen along with its parameters (spin density, relaxation
     times, chemical shift spectra, and exchange rates) to represent a given
     tissue type. The user can read more about GM model in literature
     <span class="cite">[<a 
href="MRiLab_User_Guideli3.html#XLiu2016">10</a>]</span>.
     </p><!--l. 2942--><p class="noindent" >The &#8216;VObj&#8217; must have the structure like: </p>
         <ul class="itemize1">
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">ChemShift (Hz/T) : A array with the size of <!--l. 2945--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi></math>
         for describing the chemical shift of the spins
         </li>
         <li class="itemize">TypeFlag : A array with the size of <!--l. 2946--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi></math>
         for describing the type of each pool, 0 for free pool and 1 for bound
         pool
         </li>
         <li class="itemize">LineShapeFlag : A array with the size of <!--l. 2947--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi><mi 
>b</mi><mi 
>e</mi><mi 
>r</mi></math>
         for describing RF saturation line shape for bound proton pool, 0 for
         super-Lorentzian and 1 for Gaussian (:ToDo), the flag is ignored for
         free pool
         </li>
         <li class="itemize">XDim : The number of voxels in X direction
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction
         </li>
         <li class="itemize">Type : A string for describing the type of the spin
         </li>
         <li class="itemize">TypeNum : The number of pools

         </li>
         <li class="itemize">ECon (S/m) : A matrix with the size of <!--l. 2956--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : A matrix with the size of <!--l. 2957--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>
         for describing tissue mass density (optional)
         </li>
         <li class="itemize">Rho : A matrix with the size of <!--l. 2958--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing spin density
         </li>
         <li class="itemize">T1 (s) : A matrix with the size of <!--l. 2959--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T1 relaxation time
         </li>
         <li class="itemize">T2 (s) : A matrix with the size of <!--l. 2960--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2 relaxation time
         </li>
         <li class="itemize">T2Star (s) : A matrix with the size of <!--l. 2961--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing T2* relaxation time
         </li>
         <li class="itemize">K (1/s) : A matrix with the size of <!--l. 2962--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for describing exchange rate. The exchange rate from the <!--l. 2962--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>i</mi></math>th
         pool to the <!--l. 2962--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>j</mi></math>th
         pool is placed as <!--l. 2962--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>K</mi><mrow ><mo 
class="MathClass-open">(</mo><mrow><mo 
class="MathClass-punc">:</mo><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-punc">:</mo><mo 
class="MathClass-punc">,</mo><mo 
class="MathClass-punc">:</mo><mo 
class="MathClass-punc">,</mo><mi 
>i</mi><mo 
class="MathClass-punc">,</mo><mi 
>j</mi></mrow><mo 
class="MathClass-close">)</mo></mrow></math>.
         The exchange rate to itself for any pool is assumed to be zero.</li></ul>
     <!--l. 2965--><p class="noindent" >Notice that the GM model needs to satisfy chemical equilibrium analogous to
     that of MT model. After making VObj, then save the &#8216;VObj&#8217; structure as a
     MAT file. To accurately model GM exchange during scan, the user also needs
     to create execution points on the entire RF sequence line. A typical method is
     to insert a long RF pulse with zero amplitude at the empty portion of the RF
     sequence line. The interested users are referred to PSD_SPGR3DGM for more
     information. <span 
class="cmbx-10">Also notice that the MT, ME and CEST model will be</span>
     <span 
class="cmbx-10">removed in the next MRiLab version and replaced by GM</span>
     <span 
class="cmbx-10">model.</span>
</p>
     </li></ol>
<!--l. 2969--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3.2   </span> <a 
 id="x10-1030005.3.2"></a>Create Virtual Object using XML</h4>
<!--l. 2971--><p class="noindent" >The Phantom Design toolbox can be activated by pressing &#8216;Phantom Design Panel&#8217;
toolbar icon located at the top of the main simulation console. If a phantom XML file

has already been loaded (Chapter <a 
href="MRiLab_User_Guidech3.html#x8-120003.1">3.1<!--tex4ht:ref: chap:LoadingVirtualObject --></a>), the loaded phantom will show in the
Phantom Design interface.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-10300137"></a>


<!--l. 2975--><p class="noindent" ><img 
src="Pictures/PhantomDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.37: </span><span  
class="content">Phantom Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-10300137 -->

   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-10300238"></a>


<!--l. 2982--><p class="noindent" ><img 
src="Pictures/PhantomDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.38: </span><span  
class="content">Phantom Design Panel</span></div><!--tex4ht:label?: x10-10300238 -->

   </div><hr class="endfigure" />
<!--l. 2987--><p class="indent" >   Figure <a 
href="#x10-10300238">5.38<!--tex4ht:ref: fig:PhantomDesignGUI --></a> demonstrates an overview of the Phantom Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-103004x1">VObj Element Macro Library <br 
class="newline" />The  VObj  Element  Macro  Library  contains  VObj  element  macros  for
     constructing  VObj  structure  in  MRiLab.  The  user  needs  to  click  the
     &#8216;VObjElem&#8217; root to unfold subsequent macros.
     </li>
     <li 
  class="enumerate" id="x10-103006x2">VObj Structure <br 
class="newline" />In  MRiLab,  a  VObj  structure  consists  of  arbitrary  number  of  VObj
     elements that are combined to create a digital phantom. The user can
     construct  desired  phantom  by  changing  the  content  within  the  VObj
     structure. To add a macro into the VObj structure, the user needs to click
     one macro in the macro library, then click on the VObj structure root
     (i.e. MRiLabVObj) to which this macro is inserted, then click &#8216;+&#8217; macro
     operation button. To delete a macro from the VObj structure, the user
     needs to click the unwanted macro, then click &#8216;-&#8217; macro operation button.
     To duplicate an existing macro, the user needs to first click the source
     macro, then click &#8216;C&#8217; macro operation button for copying, click on the
     VObj structure root, then click &#8216;P&#8217; macro operation button for pasting.
     MRiLab doesn&#8217;t allow empty VObj structure.
     </li>
     <li 
  class="enumerate" id="x10-103008x3">VObj Element Attribute <br 
class="newline" />Upon clicking on the VObj element macro within the VObj structure,
     the corresponding macro attributes will be shown at the VObj element
     attribute panel down below the VObj structure. The user can edit those
     attributes to modify the VObj element so as to generate different phantom.
     To make any modification effective, the user must press &#8216;Update&#8217; button
     to update the VObj XML file. Based on this XML file, pressing &#8216;Create&#8217;
     button will generate a .mat phantom file which can then be loaded from
     &#8216;Load Phantom from XML&#8217; or &#8216;Load Phantom&#8217;. Pressing &#8216;Render&#8217; button
     will re-render the 3D Object on this interface. For instance, the VObj
     structure root &#8216;MRiLabVObj&#8217; has attributes as follows:
         <ul class="itemize1">
         <li class="itemize">Name : The name of the VObj structure, recommended to use the
         naming convention as &#8216;VObj_&#8217; followed by the phantom shape and
         applied anatomy (e.g. VObj_SphereHead)
         </li>
         <li class="itemize">Model : The phantom model selection including &#8216;Normal&#8217; for regular
         phantom, &#8216;MT&#8217; for two-pool MT phantom, &#8216;ME&#8217; for ME phantom
         and &#8216;GM&#8217; for GM phantom. Note that if &#8216;MT&#8217;, &#8216;ME&#8217; or &#8216;GM&#8217; model
         is selected, the exchange rate &#8216;K&#8217; must be properly provided in every

         VObj element macro
         </li>
         <li class="itemize">Type : A string for describing the type of the phantom
         </li>
         <li class="itemize">Notes : The notes of the phantom
         </li>
         <li class="itemize">TypeNum : The number of the spin species
         </li>
         <li class="itemize">Gyro (rad/s/T) : The gyromagnetic ratio of the spin
         </li>
         <li class="itemize">XDim : The number of voxels in X direction for this phantom
         </li>
         <li class="itemize">YDim : The number of voxels in Y direction for this phantom
         </li>
         <li class="itemize">ZDim : The number of voxels in Z direction for this phantom
         </li>
         <li class="itemize">XDimRes (m) : The voxel size in X direction
         </li>
         <li class="itemize">YDimRes (m) : The voxel size in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The voxel size in Z direction</li></ul>
     </li>
     <li 
  class="enumerate" id="x10-103010x4">3D VObj Rendering<br 
class="newline" />The 3D object based on the VObj structure is displayed on the &#8216;Virtual Object&#8217;
     panel on the right side of this interface.
     </li>
     <li 
  class="enumerate" id="x10-103012x5">VObj Rendering Control <br 
class="newline" />The &#8216;Display&#8217; tab on the &#8216;VObj Simulation&#8217; panel contains parameters for
     controlling object display.
         <ul class="itemize1">
         <li class="itemize">Grid : Turn on and off grid
         </li>
         <li class="itemize">Box : Turn on and off boundary box
         </li>
         <li class="itemize">CameraTool : Hide or show Matlab camera tool</li></ul>
     </li></ol>

   <h4 class="subsectionHead"><span class="titlemark">5.3.3   </span> <a 
 id="x10-1040005.3.3"></a>VObj Element Macro Library</h4>
<!--l. 3030--><p class="noindent" >A VObj element macro is a predefined module for creating a VObj element that
generates a 3D object with certain MR properties. MRiLab VObj element macro
library is a collection of VObj element macros. This section will give an introduction
to each of the VObj element macro provided in MRiLab.
</p><!--l. 3032--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1050005.3.3"></a>VObjSphere</h5>
<!--l. 3034--><p class="noindent" >A VObj element macro that creates a sphere object. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">Notes : The notes of the object
     </li>
     <li class="itemize">Color : The display color
     </li>
     <li class="itemize">Alpha : The display transparency
     </li>
     <li class="itemize">Geometry : The 3D geometry of the object, including
         <ul class="itemize2">
         <li class="itemize">Radius (m) : The radius of the sphere
         </li>
         <li class="itemize">CenterX (m) : The X coordinate of the sphere center
         </li>
         <li class="itemize">CenterY (m) : The Y coordinate of the sphere center
         </li>
         <li class="itemize">CenterZ (m) : The Z coordinate of the sphere center
         </li>
         <li class="itemize">FaceNum : The number of the faces for the sphere</li></ul>
     </li>
     <li class="itemize">Property : The MR properties of the object, including
         <ul class="itemize2">
         <li class="itemize">TypeIdx  :  An  index  number  of  the  spin  species,  used  when  the
         phantom has multiple spin species. The index must not exceed the
         &#8216;TypeNum&#8217;

         </li>
         <li class="itemize">ChemShift (Hz/T) : The chemical shift of the spin for the sphere.
         Note  that  for  the  VObj  element  with  the  same  &#8216;TypeIdx&#8217;,  the
         &#8216;ChemShift&#8217; should be kept the same value
         </li>
         <li class="itemize">TypeFlag : A flag number for describing the type of the spin, 0 for
         free pool and 1 for bound pool
         </li>
         <li class="itemize">LineShapeFlag : A flag number for describing RF saturation line
         shape  for  bound  proton  pool,  0  for  super-Lorentzian  and  1  for
         Gaussian (:ToDo), the flag is ignored for free pool
         </li>
         <li class="itemize">ECon (S/m) : A array with size of <!--l. 3054--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : The tissue mass density (optional)
         </li>
         <li class="itemize">Rho : The spin density for the sphere
         </li>
         <li class="itemize">T1 (s) : The T1 relaxation time for the sphere
         </li>
         <li class="itemize">T2 (s) : The T2 relaxation time for the sphere
         </li>
         <li class="itemize">T2Star (s) : The T2* relaxation time for the sphere
         </li>
         <li class="itemize">K (1/s) : A array with the size of <!--l. 3060--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for  describing  the  exchange  rate  of  the  spin,  ignored  for  regular
         phantom. The rate value must be in the order as the &#8216;TypeIdx&#8217; pool
         to the first pool, to the second pool, until to the last pool. The rate
         to itself for any pool can be set to zero.</li></ul>
     </li></ul>
<!--l. 3065--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1060005.3.3"></a>VObjEllipsoid</h5>
<!--l. 3067--><p class="noindent" >A VObj element macro that creates an ellipsoid object. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">Notes : The notes of the object

     </li>
     <li class="itemize">Color : The display color
     </li>
     <li class="itemize">Alpha : The display transparency
     </li>
     <li class="itemize">Geometry : The 3D geometry of the object, including
         <ul class="itemize2">
         <li class="itemize">RadiusX (m) : The X semi-axis length of the ellipsoid
         </li>
         <li class="itemize">RadiusY (m) : The Y semi-axis length of the ellipsoid
         </li>
         <li class="itemize">RadiusZ (m) : The Z semi-axis length of the ellipsoid
         </li>
         <li class="itemize">CenterX (m) : The X coordinate of the ellipsoid center
         </li>
         <li class="itemize">CenterY (m) : The Y coordinate of the ellipsoid center
         </li>
         <li class="itemize">CenterZ (m) : The Z coordinate of the ellipsoid center
         </li>
         <li class="itemize">FaceNum : The number of the faces for the ellipsoid</li></ul>
     </li>
     <li class="itemize">Property : The MR properties of the object, including
         <ul class="itemize2">
         <li class="itemize">TypeIdx  :  An  index  number  of  the  spin  species,  used  when  the
         phantom has multiple spin species. The index must not exceed the
         &#8216;TypeNum&#8217;
         </li>
         <li class="itemize">ChemShift (Hz/T) : The chemical shift of the spin for the ellipsoid.
         Note  that  for  the  VObj  element  with  the  same  &#8216;TypeIdx&#8217;,  the
         &#8216;ChemShift&#8217; should be kept the same value
         </li>
         <li class="itemize">TypeFlag : A flag number for describing the type of the spin, 0 for
         free pool and 1 for bound pool
         </li>
         <li class="itemize">LineShapeFlag : A flag number for describing RF saturation line
         shape  for  bound  proton  pool,  0  for  super-Lorentzian  and  1  for
         Gaussian (:ToDo), the flag is ignored for free pool
         </li>
         <li class="itemize">ECon (S/m) : A array with size of <!--l. 3089--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for tissue electrical conductivity (optional)

         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : The tissue mass density (optional)
         </li>
         <li class="itemize">Rho : The spin density for the ellipsoid
         </li>
         <li class="itemize">T1 (s) : The T1 relaxation time for the ellipsoid
         </li>
         <li class="itemize">T2 (s) : The T2 relaxation time for the ellipsoid
         </li>
         <li class="itemize">T2Star (s) : The T2* relaxation time for the ellipsoid
         </li>
         <li class="itemize">K (1/s) : A array with the size of <!--l. 3095--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for  describing  the  exchange  rate  of  the  spin,  ignored  for  regular
         phantom. The rate value must be in the order as the &#8216;TypeIdx&#8217; pool
         to the first pool, to the second pool, until to the last pool. The rate
         to itself for any pool can be set to zero.</li></ul>
     </li></ul>
<!--l. 3100--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1070005.3.3"></a>VObjCube</h5>
<!--l. 3102--><p class="noindent" >A VObj element macro that creates a cube object. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">Notes : The notes of the object
     </li>
     <li class="itemize">Color : The display color
     </li>
     <li class="itemize">Alpha : The display transparency
     </li>
     <li class="itemize">Geometry : The 3D geometry of the object, including
         <ul class="itemize2">
         <li class="itemize">Length (m) : The egde length of the cube
         </li>
         <li class="itemize">CenterX (m) : The X coordinate of the cube center
         </li>
         <li class="itemize">CenterY (m) : The Y coordinate of the cube center

         </li>
         <li class="itemize">CenterZ (m) : The Z coordinate of the cube center</li></ul>
     </li>
     <li class="itemize">Property : The MR properties of the object, including
         <ul class="itemize2">
         <li class="itemize">TypeIdx  :  An  index  number  of  the  spin  species,  used  when  the
         phantom has multiple spin species. The index must not exceed the
         &#8216;TypeNum&#8217;
         </li>
         <li class="itemize">ChemShift (Hz/T) : The chemical shift of the spin for the cube. Note
         that for the VObj element with the same &#8216;TypeIdx&#8217;, the &#8216;ChemShift&#8217;
         should be kept the same value
         </li>
         <li class="itemize">TypeFlag : A flag number for describing the type of the spin, 0 for
         free pool and 1 for bound pool
         </li>
         <li class="itemize">LineShapeFlag : A flag number for describing RF saturation line
         shape  for  bound  proton  pool,  0  for  super-Lorentzian  and  1  for
         Gaussian (:ToDo), the flag is ignored for free pool
         </li>
         <li class="itemize">ECon (S/m) : A array with size of <!--l. 3121--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : The tissue mass density (optional)
         </li>
         <li class="itemize">Rho : The spin density for the cube
         </li>
         <li class="itemize">T1 (s) : The T1 relaxation time for the cube
         </li>
         <li class="itemize">T2 (s) : The T2 relaxation time for the cube
         </li>
         <li class="itemize">T2Star (s) : The T2* relaxation time for the cube
         </li>
         <li class="itemize">K (1/s) : A array with the size of <!--l. 3127--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for  describing  the  exchange  rate  of  the  spin,  ignored  for  regular
         phantom. The rate value must be in the order as the &#8216;TypeIdx&#8217; pool
         to the first pool, to the second pool, until to the last pool. The rate
         to itself for any pool can be set to zero.</li></ul>
     </li></ul>

<!--l. 3132--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1080005.3.3"></a>VObjCylinder</h5>
<!--l. 3134--><p class="noindent" >A VObj element macro that creates a cylinder object. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">Notes : The notes of the object
     </li>
     <li class="itemize">Color : The display color
     </li>
     <li class="itemize">Alpha : The display transparency
     </li>
     <li class="itemize">Geometry : The 3D geometry of the object, including
         <ul class="itemize2">
         <li class="itemize">Radius (m) : The radius of the cylinder
         </li>
         <li class="itemize">Length (m) : The length of the cylinder
         </li>
         <li class="itemize">CenterX (m) : The X coordinate of the cylinder center
         </li>
         <li class="itemize">CenterY (m) : The Y coordinate of the cylinder center
         </li>
         <li class="itemize">CenterZ (m) : The Z coordinate of the cylinder center
         </li>
         <li class="itemize">FaceNum : The number of the faces for the cylinder</li></ul>
     </li>
     <li class="itemize">Property : The MR properties of the object, including
         <ul class="itemize2">
         <li class="itemize">TypeIdx  :  An  index  number  of  the  spin  species,  used  when  the
         phantom has multiple spin species. The index must not exceed the
         &#8216;TypeNum&#8217;
         </li>
         <li class="itemize">ChemShift (Hz/T) : The chemical shift of the spin for the cylinder.
         Note  that  for  the  VObj  element  with  the  same  &#8216;TypeIdx&#8217;,  the
         &#8216;ChemShift&#8217; should be kept the same value
         </li>
         <li class="itemize">TypeFlag : A flag number for describing the type of the spin, 0 for
         free pool and 1 for bound pool

         </li>
         <li class="itemize">LineShapeFlag : A flag number for describing RF saturation line
         shape  for  bound  proton  pool,  0  for  super-Lorentzian  and  1  for
         Gaussian (:ToDo), the flag is ignored for free pool
         </li>
         <li class="itemize">ECon (S/m) : A array with size of <!--l. 3155--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : The tissue mass density (optional)
         </li>
         <li class="itemize">Rho : The spin density for the cylinder
         </li>
         <li class="itemize">T1 (s) : The T1 relaxation time for the cylinder
         </li>
         <li class="itemize">T2 (s) : The T2 relaxation time for the cylinder
         </li>
         <li class="itemize">T2Star (s) : The T2* relaxation time for the cylinder
         </li>
         <li class="itemize">K (1/s) : A array with the size of <!--l. 3161--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for  describing  the  exchange  rate  of  the  spin,  ignored  for  regular
         phantom. The rate value must be in the order as the &#8216;TypeIdx&#8217; pool
         to the first pool, to the second pool, until to the last pool. The rate
         to itself for any pool can be set to zero.</li></ul>
     </li></ul>
<!--l. 3166--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1090005.3.3"></a>VObjPyramid</h5>
<!--l. 3168--><p class="noindent" >A VObj element macro that creates a pyramid object. This macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">Notes : The notes of the object
     </li>
     <li class="itemize">Color : The display color
     </li>
     <li class="itemize">Alpha : The display transparency
     </li>
     <li class="itemize">Geometry : The 3D geometry of the object, including

         <ul class="itemize2">
         <li class="itemize">Height (m) : The height of the pyramid
         </li>
         <li class="itemize">Length (m) : The edge length of the pyramid base
         </li>
         <li class="itemize">CenterX (m) : The X coordinate of the pyramid base center
         </li>
         <li class="itemize">CenterY (m) : The Y coordinate of the pyramid base center
         </li>
         <li class="itemize">CenterZ (m) : The Z coordinate of the pyramid base center</li></ul>
     </li>
     <li class="itemize">Property : The MR properties of the object, including
         <ul class="itemize2">
         <li class="itemize">TypeIdx  :  An  index  number  of  the  spin  species,  used  when  the
         phantom has multiple spin species. The index must not exceed the
         &#8216;TypeNum&#8217;
         </li>
         <li class="itemize">ChemShift (Hz/T) : The chemical shift of the spin for the pyramid.
         Note  that  for  the  VObj  element  with  the  same  &#8216;TypeIdx&#8217;,  the
         &#8216;ChemShift&#8217; should be kept the same value
         </li>
         <li class="itemize">TypeFlag : A flag number for describing the type of the spin, 0 for
         free pool and 1 for bound pool
         </li>
         <li class="itemize">LineShapeFlag : A flag number for describing RF saturation line
         shape  for  bound  proton  pool,  0  for  super-Lorentzian  and  1  for
         Gaussian (:ToDo), the flag is ignored for free pool
         </li>
         <li class="itemize">ECon (S/m) : A array with size of <!--l. 3188--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mn>3</mn></math>
         for tissue electrical conductivity (optional)
         </li>
         <li class="itemize">MassDen (kg/m<sup class="textsuperscript"><span 
class="cmr-9">3</span></sup>) : The tissue mass density (optional)
         </li>
         <li class="itemize">Rho : The spin density for the pyramid
         </li>
         <li class="itemize">T1 (s) : The T1 relaxation time for the pyramid
         </li>
         <li class="itemize">T2 (s) : The T2 relaxation time for the pyramid
         </li>
         <li class="itemize">T2Star (s) : The T2* relaxation time for the pyramid

         </li>
         <li class="itemize">K (1/s) : A array with the size of <!--l. 3194--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mn>1</mn> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>y</mi><mi 
>p</mi><mi 
>e</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi></math>
         for  describing  the  exchange  rate  of  the  spin,  ignored  for  regular
         phantom. The rate value must be in the order as the &#8216;TypeIdx&#8217; pool
         to the first pool, to the second pool, until to the last pool. The rate
         to itself for any pool can be set to zero.</li></ul>
     </li></ul>
<!--l. 3198--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3.4   </span> <a 
 id="x10-1100005.3.4"></a>Make New VObj XML</h4>
<!--l. 3200--><p class="noindent" >The user can also use the VObj loading function to load another VObj XML file. To
load a VObj, click &#8216;Load&#8217; menu then click &#8216;Load VObj XML File&#8217;, choose a
VObj XML file. After the VObj XML is loaded, press &#8216;Render&#8217; to display 3D
object.<br 
class="newline" />
</p><!--l. 3202--><p class="indent" >   The user can create a new VObj XML file in the Phantom Design interface. To
create a new VObj, click &#8216;New&#8217; then click &#8216;Create VObj XML File&#8217;. A VObj creation
window will show up and ask for new VObj name and notes. To follow MRiLab
naming convention, the user is recommended to use &#8216;VObj_&#8217; followed by the phantom
shape and applied anatomy (e.g. VObj_SphereHead), make sure that the new VObj
name differs from the existing VObj XML names in MRiLab. Then click &#8216;OK&#8217; to
select a path for storing the VObj XML file. It&#8217;s strongly recommended to put the
VObj XML under the MRiLab VObj root folder /MRiLab/Config/VObj.
Finally, MRiLab will create a new VObj XML file based on the content of
&#8216;VObj_SphereHead&#8217;.
</p><!--l. 3204--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.4   </span> <a 
 id="x10-1110005.4"></a>Coil Design</h3>
<!--l. 3206--><p class="noindent" >The Coil Design toolbox can be activated by pressing &#8216;Coil Design Panel&#8217; toolbar
icon located at the top of the main simulation console. Depending on the coil mode
(i.e. &#8216;Tx&#8217; or &#8216;Rx&#8217;) highlighted on the &#8216;Coil Selection&#8217; panel, the loaded coil will show
in the Coil Design interface.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11100139"></a>


<!--l. 3210--><p class="noindent" ><img 
src="Pictures/CoilDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.39: </span><span  
class="content">Coil Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-11100139 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.4.1   </span> <a 
 id="x10-1120005.4.1"></a>Coil Design GUI</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11200140"></a>


<!--l. 3219--><p class="noindent" ><img 
src="Pictures/CoilDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.40: </span><span  
class="content">Coil Design Panel. An eight channel coil is shown.</span></div><!--tex4ht:label?: x10-11200140 -->

   </div><hr class="endfigure" />
<!--l. 3224--><p class="indent" >   Figure <a 
href="#x10-11200140">5.40<!--tex4ht:ref: fig:CoilDesignGUI --></a> demonstrates an overview of the Coil Design interface. This interface
consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-112003x1">Coil Element Macro Library <br 
class="newline" />
     <!--l. 3229--><p class="noindent" >The  Coil  Element  Macro  Library  contains  coil  element  macros  for
     constructing  coil  structure  in  MRiLab.  The  user  needs  to  click  the
     &#8216;CoilElem&#8217; root to unfold subsequent macros.
     </p></li>
     <li 
  class="enumerate" id="x10-112005x2">Coil Structure <br 
class="newline" />
     <!--l. 3233--><p class="noindent" >In MRiLab, a coil structure consists of arbitrary number of coil elements
     that are combined to create desired B1 field and E1 field (only supported
     by CoilUser). The user can construct desired field by changing the content
     within the coil structure. To add a macro into the coil structure, the
     user needs to click one macro in the macro library, then click on the coil
     structure root (i.e. MRiLabCoil) to which this macro is inserted, then click
     &#8216;+&#8217; macro operation button. To delete a macro from the coil structure,
     the user needs to click the unwanted macro, then click &#8216;-&#8217; macro operation
     button. To duplicate an existing macro, the user needs to first click the
     source macro, then click &#8216;C&#8217; macro operation button for copying, click on
     the coil structure root, then click &#8216;P&#8217; macro operation button for pasting.
     MRiLab doesn&#8217;t allow empty coil structure.
     </p></li>
     <li 
  class="enumerate" id="x10-112007x3">Coil Element Attribute <br 
class="newline" />
     <!--l. 3238--><p class="noindent" >Upon clicking on the coil element macro within the coil structure, the
     corresponding macro attributes will be shown at the coil element attribute
     panel down below the coil structure. The user can edit those attributes
     to modify the coil element so as to generate different field. To make any
     modification effective, the user must press &#8216;Update&#8217; button to update the
     coil file. Pressing &#8216;Execute&#8217; button will update and redraw the field map
     on this interface.
     </p></li>
     <li 
  class="enumerate" id="x10-112009x4">Coil Field <br 
class="newline" />
     <!--l. 3242--><p class="noindent" >The coil configuration and B1 (T) and E1 (V/m) field generated based on
     the coil structure is displayed on the &#8216;3D Coil B1/E1 Field&#8217; panel on the
     right side of this interface.

     </p></li>
     <li 
  class="enumerate" id="x10-112011x5">Coil Simulation Control <br 
class="newline" />
     <!--l. 3246--><p class="noindent" >The  &#8216;Display&#8217;  and  &#8216;Grid&#8217;  tab  on  the  &#8216;Coil  Simulation&#8217;  panel  contains
     parameters for controlling field display.
</p>
         <ul class="itemize1">
         <li class="itemize">Colormap : The colormap for the field, includes &#8216;Jet&#8217;, &#8216;Gray&#8217; and
         &#8216;Hot&#8217;
         </li>
         <li class="itemize">CLimDown (T) : The lower bound of color limits
         </li>
         <li class="itemize">CLimUp (T) : The upper bound of color limits
         </li>
         <li class="itemize">CoilDisplay : The flag for turning on and off coil display
         </li>
         <li class="itemize">CoilShow : The flag for choosing active coil for field display
         </li>
         <li class="itemize">Mode : The B1 field display mode, includes &#8216;Magnitude&#8217;, &#8216;Phase&#8217;,
         &#8216;Real&#8217; and &#8216;Imaginary&#8217;
         </li>
         <li class="itemize">FieldType : The flag to choose B1 field or E1 field, note E1 field only
         support &#8216;Magnitude&#8217; display mode
         </li>
         <li class="itemize">Plane : The flag for activating field slicing plane, includes &#8216;XY&#8217;, &#8216;XZ&#8217;
         and &#8216;YZ&#8217;
         </li>
         <li class="itemize">XDimRes (m) : The display spatial resolution in X direction
         </li>
         <li class="itemize">YDimRes (m) : The display spatial resolution in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The display spatial resolution in Z direction</li></ul>
     </li></ol>
<!--l. 3264--><p class="indent" >   MRiLab provides a group of field display button (Figure <a 
href="#x10-11201241">5.41<!--tex4ht:ref: fig:FieldDisplayButton --></a>) to help inspect
field details.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11201241"></a>


<!--l. 3268--><p class="noindent" ><img 
src="Pictures/FieldDisplayButton.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.41: </span><span  
class="content">The Field Display Button.</span></div><!--tex4ht:label?: x10-11201241 -->

   </div><hr class="endfigure" />
<!--l. 3273--><p class="indent" >   The field display button group consists of:
</p>
     <ul class="itemize1">
     <li class="itemize"><!--l. 3276--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mo 
class="MathClass-bin">&#x2227;</mo></math>
     : Undock field on active slicing plane (Figure <a 
href="#x10-11201342">5.42<!--tex4ht:ref: fig:B1Field --></a>)
     </li>
     <li class="itemize">S+ : Move active slicing plane forwards
     </li>
     <li class="itemize">S- : Move active slicing plane backwards
     </li>
     <li class="itemize">D : Display field in separate window</li></ul>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11201342"></a>


<!--l. 3285--><p class="noindent" ><img 
src="Pictures/B1Field.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.42: </span><span  
class="content">An Example of B1 Field on XY Plane.</span></div><!--tex4ht:label?: x10-11201342 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.4.2   </span> <a 
 id="x10-1130005.4.2"></a>Coil Element Macro Library</h4>
<!--l. 3293--><p class="noindent" >A coil element macro is a predefined module for creating a coil element that
generates B1 and E1 field in three dimensional space. MRiLab coil element macro
library is a collection of coil element macros covering simple coil geometries. <span 
class="cmbx-10">Note</span>
<span 
class="cmbx-10">that in MRiLab v1.3, only &#8216;CoilUser&#8217; support generation of E1 field from</span>
<span 
class="cmbx-10">external data file. </span>This section will give an introduction to each of the coil element
macro provided in MRiLab.
</p><!--l. 3295--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1140005.4.2"></a>CoilCircle</h5>
<!--l. 3297--><p class="noindent" >A coil element macro that creates a Biot-Savart coil circle. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">Azimuth (rad) : The azimuth angle of the circle plane
     </li>
     <li class="itemize">Elevation (rad) : The elevation angle of the circle plane
     </li>
     <li class="itemize">Radius (m) : The coil circle radius
     </li>
     <li class="itemize">PosZ (m) : The Z position of coil circle center
     </li>
     <li class="itemize">PosY (m) : The Y position of coil circle center
     </li>
     <li class="itemize">PosX (m) : The X position of coil circle center
     </li>
     <li class="itemize">CurrentDir : The current direction in the coil circle, 1 for clockwise, -1 for
     counterclockwise
     </li>
     <li class="itemize">Scale : The scale factor for the B1 field amplitude
     </li>
     <li class="itemize">Segment : The number of line segments for approximating circle, MRiLab
     requires the same &#8216;Segment&#8217; for each coil circle

     </li>
     <li class="itemize">CoilID : The assigned coil ID, each coil element must have an unique ID</li></ul>
<!--l. 3313--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1150005.4.2"></a>CoilRectangle</h5>
<!--l. 3315--><p class="noindent" >A coil element macro that creates a Biot-Savart rectangle coil. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">Azimuth (rad) : The azimuth angle of the rectangle plane
     </li>
     <li class="itemize">Elevation (rad) : The elevation angle of the rectangle plane
     </li>
     <li class="itemize">Length (m) : The coil length
     </li>
     <li class="itemize">Width (m) : The coil width
     </li>
     <li class="itemize">PosZ (m) : The Z position of coil rectangle center
     </li>
     <li class="itemize">PosY (m) : The Y position of coil rectangle center
     </li>
     <li class="itemize">PosX (m) : The X position of coil rectangle center
     </li>
     <li class="itemize">CurrentDir  :  The  current  direction  in  the  coil,  1  for  clockwise,  -1  for
     counterclockwise
     </li>
     <li class="itemize">Scale : The scale factor for the B1 field amplitude
     </li>
     <li class="itemize">CoilID : The assigned coil ID, each coil element must have an unique ID</li></ul>

<!--l. 3330--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1160005.4.2"></a>CoilUser</h5>
<!--l. 3332--><p class="noindent" >If the user has B1 and E1 field data saved in a MAT file, the user can easily
import the field into MRiLab coil design interface by using &#8216;CoilUser&#8217; macro.
The B1 field MAT file needs to contain two matrices including &#8216;B1x&#8217; (i.e.
<!--l. 3332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> component of B1
field) and &#8216;B1y&#8217; (i.e. <!--l. 3332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
component of B1 field). Both of the two matrices must have the same size.
The E1 field MAT file needs to contain three matrices including &#8216;E1x&#8217; (i.e.
<!--l. 3332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math> component of E1 field),
&#8216;E1y&#8217; (i.e. <!--l. 3332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math> component of
E1 field) and &#8216;E1z&#8217; (i.e. <!--l. 3332--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>z</mi></math>
component of E1 field). These three matrices must have the same size. The &#8216;CoilUser&#8217;
macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">B1File : The path to the file that stores the B1 field data, quoted using
     single quotes
     </li>
     <li class="itemize">E1File : The path to the file that stores the E1 field data, quoted using
     single quotes
     </li>
     <li class="itemize">Interp : The interpolation method, includes &#8216;linear&#8217;, &#8216;nearest&#8217; and &#8216;cubic&#8217;
     </li>
     <li class="itemize">PosZ (m) : The Z position of coil center (needed for coil display purpose)
     </li>
     <li class="itemize">PosY (m) : The Y position of coil center (needed for coil display purpose)
     </li>
     <li class="itemize">PosX (m) : The X position of coil center (needed for coil display purpose)
     </li>
     <li class="itemize">CoilID : The assigned coil ID, each coil element must have an unique ID</li></ul>
<!--l. 3344--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.4.3   </span> <a 
 id="x10-1170005.4.3"></a>Make New Coil</h4>

<!--l. 3346--><p class="noindent" >The user can also use the coil loading function to load another coil. To load a coil,
click &#8216;Load&#8217; menu then click &#8216;Load Coil File&#8217;, choose a coil XML file. After the coil is
loaded, press &#8216;Execute&#8217; to display field.<br 
class="newline" />
</p><!--l. 3348--><p class="indent" >   The user can create a new coil configuration in the Coil Design interface. To
create a new coil, click &#8216;New&#8217; then click &#8216;Create Coil File&#8217;. A coil creation window
(Figure <a 
href="#x10-11700143">5.43<!--tex4ht:ref: fig:NewCoil --></a>) will show up and ask for new coil name and notes. To follow
MRiLab naming convention, the user is recommended to use &#8216;Coil_&#8217; followed by
the number of coil elements and applied anatomy (e.g. Coil_16ChChest),
make sure that the new coil name differs from the existing coil names in
MRiLab. Then click &#8216;OK&#8217; to select a path for storing the coil XML file. It&#8217;s
strongly recommended to put the coil under the MRiLab coil root folder
/MRiLab/Config/Coil according to the coil type so that the coil is visible to
MRiLab. Finally, MRiLab will create a new coil XML file based on the content of
&#8216;Coil_1ChHead&#8217;.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11700143"></a>


<!--l. 3352--><p class="noindent" ><img 
src="Pictures/NewCoil.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.43: </span><span  
class="content">The Coil Creation Window</span></div><!--tex4ht:label?: x10-11700143 -->

   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">5.5   </span> <a 
 id="x10-1180005.5"></a>Magnet dB0 Design</h3>
<!--l. 3360--><p class="noindent" >The Magnet dB0 Design toolbox can be activated by pressing &#8216;Magnet Design Panel&#8217;
toolbar icon located at the top of the main simulation console. The loaded magnet
will show in the Magnet dB0 Design interface.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11800144"></a>


<!--l. 3364--><p class="noindent" ><img 
src="Pictures/MagnetDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.44: </span><span  
class="content">Magnet Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-11800144 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.5.1   </span> <a 
 id="x10-1190005.5.1"></a>Magnet Design GUI</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-11900145"></a>


<!--l. 3373--><p class="noindent" ><img 
src="Pictures/MagnetDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.45: </span><span  
class="content">Magnet dB0 Design Panel</span></div><!--tex4ht:label?: x10-11900145 -->

   </div><hr class="endfigure" />
<!--l. 3378--><p class="indent" >   Figure <a 
href="#x10-11900145">5.45<!--tex4ht:ref: fig:MagnetDesignGUI --></a> demonstrates an overview of the Magnet dB0 Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-119003x1">Magnet Element Macro Library <br 
class="newline" />
     <!--l. 3383--><p class="noindent" >The Magnet Element Macro Library contains magnet element macros for
     constructing magnet structure in MRiLab. The user needs to click the
     &#8216;MagElem&#8217; root to unfold subsequent macros.
     </p></li>
     <li 
  class="enumerate" id="x10-119005x2">Magnet Structure <br 
class="newline" />
     <!--l. 3387--><p class="noindent" >In MRiLab, a magnet structure consists of arbitrary number of magnet
     elements that are combined to create desired dB0 field. The user can
     construct desired dB0 field by changing the content within the magnet
     structure. To add a macro into the magnet structure, the user needs to
     click one macro in the macro library, then click on the magnet structure
     root (i.e. MRiLabMag) to which this macro is inserted, then click &#8216;+&#8217;
     macro operation button. To delete a macro from the magnet structure,
     the user needs to click the unwanted macro, then click &#8216;-&#8217; macro operation
     button. To duplicate an existing macro, the user needs to first click the
     source macro, then click &#8216;C&#8217; macro operation button for copying, click
     on the magnet structure root, then click &#8216;P&#8217; macro operation button for
     pasting. MRiLab doesn&#8217;t allow empty magnet structure.
     </p></li>
     <li 
  class="enumerate" id="x10-119007x3">Magnet Element Attribute <br 
class="newline" />
     <!--l. 3391--><p class="noindent" >Upon clicking on the magnet element macro within the magnet structure,
     the corresponding macro attributes will be shown at the magnet element
     attribute panel down below the magnet structure. The user can edit those
     attributes to modify the magnet element so as to generate different dB0
     field. To make any modification effective, the user must press &#8216;Update&#8217;
     button to update the magnet file. Pressing &#8216;Execute&#8217; button will update
     and redraw the dB0 field map on this interface.
     </p></li>
     <li 
  class="enumerate" id="x10-119009x4">Magnet Field <br 
class="newline" />
     <!--l. 3395--><p class="noindent" >The dB0 field (T) generated based on the magnet structure is displayed
     on the &#8216;Magnet Field&#8217; panel on the right side of this interface.
     </p></li>
     <li 
  class="enumerate" id="x10-119011x5">Magnet Simulation Control <br 
class="newline" />

     <!--l. 3399--><p class="noindent" >The &#8216;Display&#8217; and &#8216;Grid&#8217; tab on the &#8216;Magnet Simulation&#8217; panel contains
     parameters for controlling dB0 field display.
</p>
         <ul class="itemize1">
         <li class="itemize">Colormap : The colormap for the dB0 field, includes &#8216;Jet&#8217;, &#8216;Gray&#8217; and
         &#8216;Hot&#8217;
         </li>
         <li class="itemize">Plane : The flag for activating dB0 field slicing plane, includes &#8216;XY&#8217;,
         &#8216;XZ&#8217; and &#8216;YZ&#8217;
         </li>
         <li class="itemize">XDimRes (m) : The display spatial resolution in X direction
         </li>
         <li class="itemize">YDimRes (m) : The display spatial resolution in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The display spatial resolution in Z direction</li></ul>
     </li></ol>
<!--l. 3411--><p class="indent" >   MRiLab provides a group of dB0 field display button to help inspect the dB0 field
details. The dB0 field display button group consists of:
</p>
     <ul class="itemize1">
     <li class="itemize">S+ : Move active dB0 field slicing plane forwards
     </li>
     <li class="itemize">S- : Move active dB0 field slicing plane backwards
     </li>
     <li class="itemize">D : Display field in separate window</li></ul>
   <h4 class="subsectionHead"><span class="titlemark">5.5.2   </span> <a 
 id="x10-1200005.5.2"></a>Magnet Element Macro Library</h4>
<!--l. 3421--><p class="noindent" >A magnet element macro is a predefined module for creating a magnet element that
generates dB0 field in three dimensional space. MRiLab magnet element macro
library is a collection of magnet element macros. This section will give an
introduction to each of the magnet element macro provided in MRiLab.
</p><!--l. 3423--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1210005.5.2"></a>MagLinear</h5>
<!--l. 3425--><p class="noindent" >A magnet element macro that creates a linear dB0 field. This macro contains
attributes including:
</p>

     <ul class="itemize1">
     <li class="itemize">GradZ (T/m) : The linear gradient of dB0 field in Z direction
     </li>
     <li class="itemize">GradY (T/m) : The linear gradient of dB0 field in Y direction
     </li>
     <li class="itemize">GradX (T/m) : The linear gradient of dB0 field in X direction
     </li>
     <li class="itemize">Scale : The scale factor for the dB0 field</li></ul>
<!--l. 3434--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1220005.5.2"></a>MagGaussian</h5>
<!--l. 3436--><p class="noindent" >A magnet element macro that creates a 3D Gaussian dB0 field. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">PosZ (m) : The Z position of the center
     </li>
     <li class="itemize">PosY (m) : The Y position of the center
     </li>
     <li class="itemize">PosX (m) : The X position of the center
     </li>
     <li class="itemize">DeltaZ (m) : The width of Gaussian function in Z direction
     </li>
     <li class="itemize">DeltaY (m) : The width of Gaussian function in Y direction
     </li>
     <li class="itemize">DeltaX (m) : The width of Gaussian function in X direction
     </li>
     <li class="itemize">Scale : The scale factor for the dB0 field</li></ul>

<!--l. 3449--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1230005.5.2"></a>MagSymbolic</h5>
<!--l. 3451--><p class="noindent" >A magnet element macro that creates a dB0 field based on symbolic equation. This
macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">Equation : An dB0 field equation</li></ul>
<!--l. 3457--><p class="indent" >   The symbolic equation could be any legal Matlab equation using variables &#8216;X&#8217;, &#8216;Y&#8217;
and &#8216;Z&#8217;. For example, &#8216;X+Y&#8217;, &#8216;2*X.*Y&#8217; and &#8216;2*sin(X)&#8217; etc. Notice that use element
operations for variables in the equation. The user needs to fill the equation between a
pair of single quotes.
</p><!--l. 3459--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1240005.5.2"></a>MagUser</h5>
<!--l. 3461--><p class="noindent" >If the user has the dB0 field data saved in a MAT file, the user can easily import the
dB0 field into MRiLab magnet design interface by using &#8216;MagUser&#8217; macro. The dB0
field MAT file needs to contain one matrix &#8216;dB0&#8217;. The &#8216;MagUser&#8217; macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">MagFile : The path to the file that stores the dB0 field data, quoted using
     single quotes
     </li>
     <li class="itemize">Interp : The interpolation method, includes &#8216;linear&#8217;, &#8216;nearest&#8217; and &#8216;cubic&#8217;</li></ul>
<!--l. 3468--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.5.3   </span> <a 
 id="x10-1250005.5.3"></a>Make New Magnet</h4>
<!--l. 3470--><p class="noindent" >The user can also use the magnet loading function to load another magnet. To load a
magnet, click &#8216;Load&#8217; menu then click &#8216;Load Magnet File&#8217;, choose a magnet XML
file.<br 
class="newline" />
</p><!--l. 3472--><p class="indent" >   The user can create a new magnet in the Magnet Design interface. To create a
new magnet, click &#8216;New&#8217; then click &#8216;Create Magnet File&#8217;. A magnet creation window
will show up and ask for new magnet name and notes. To follow MRiLab
naming convention, the user is recommended to use &#8216;Mag_&#8217; followed by a legal

string and applied anatomy (e.g. Mag_CustomHead), make sure that the new
magnet name differs from the remaining magnet names in MRiLab. Then
click &#8216;OK&#8217; to select a path for storing the magnet XML file. It&#8217;s strongly
recommended to put the magnet under the MRiLab magnet root folder
/MRiLab/Config/Mag according to the magnet type so that the magnet is visible to
MRiLab. Finally, MRiLab will create a new magnet XML file based on the content of
&#8216;Mag_LinearHead&#8217;.
</p><!--l. 3474--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.6   </span> <a 
 id="x10-1260005.6"></a>Gradient Design</h3>
<!--l. 3476--><p class="noindent" >The Gradient Design toolbox can be activated by pressing &#8216;Gradient Design Panel&#8217;
toolbar icon located at the top of the main simulation console. The loaded gradient
will show in the Gradient Design interface.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-12600146"></a>


<!--l. 3480--><p class="noindent" ><img 
src="Pictures/GradientDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.46: </span><span  
class="content">Gradient Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-12600146 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.6.1   </span> <a 
 id="x10-1270005.6.1"></a>Gradient Design GUI</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-12700147"></a>


<!--l. 3489--><p class="noindent" ><img 
src="Pictures/GradientDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.47: </span><span  
class="content">Gradient Design Panel</span></div><!--tex4ht:label?: x10-12700147 -->

   </div><hr class="endfigure" />
<!--l. 3494--><p class="indent" >   Figure <a 
href="#x10-12700147">5.47<!--tex4ht:ref: fig:GradientDesignGUI --></a> demonstrates an overview of the Gradient Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-127003x1">Gradient Element Macro Library <br 
class="newline" />
     <!--l. 3500--><p class="noindent" >The Gradient Element Macro Library contains gradient element macros
     for constructing gradient structure in MRiLab. The user needs to click the
     &#8216;GradElem&#8217; root to unfold subsequent macros.
     </p></li>
     <li 
  class="enumerate" id="x10-127005x2">Gradient Structure <br 
class="newline" />
     <!--l. 3504--><p class="noindent" >In MRiLab, a gradient structure consists of three gradient elements that
     are combined to create gradient field for GzSS, GyPE and GxR. The user
     can construct desired gradient field by changing the content within the
     gradient structure. To add a macro into the gradient structure, the user
     needs to click one macro in the macro library, then click on the gradient
     structure root (i.e. MRiLabGrad) to which this macro is inserted, then
     click &#8216;+&#8217; macro operation button. To delete a macro from the gradient
     structure, the user needs to click the unwanted macro, then click &#8216;-&#8217; macro
     operation button. To duplicate an existing macro, the user needs to first
     click the source macro, then click &#8216;C&#8217; macro operation button for copying,
     click on the gradient structure root, then click &#8216;P&#8217; macro operation button
     for  pasting.  MRiLab  doesn&#8217;t  allow  empty  gradient  structure,  and  also
     requires each of the three gradient sequence lines must have an individual
     gradient field.
     </p></li>
     <li 
  class="enumerate" id="x10-127007x3">Gradient Element Attribute <br 
class="newline" />
     <!--l. 3508--><p class="noindent" >Upon clicking on the gradient element macro within the gradient structure,
     the corresponding macro attributes will be shown at the gradient element
     attribute  panel  down  below  the  gradient  structure.  The  user  can  edit
     those attributes to modify the gradient element so as to generate different
     gradient field. To make any modification effective, the user must press
     &#8216;Update&#8217; button to update the gradient file. Pressing &#8216;Execute&#8217; button will
     update and redraw the gradient field map on this interface.
     </p></li>
     <li 
  class="enumerate" id="x10-127009x4">Gradient Field <br 
class="newline" />
     <!--l. 3512--><p class="noindent" >The gradient field is represented using a 3D quiver plot on the &#8216;Gradient
     Field&#8217; panel. If a constant unit gradient is used, the regular linear spatial
     location  is  applied.  However,  if  non-unit  gradient  is  used,  the  spatial

     location could be non-linear with spatial grid deformation. This means the
     original spatial location will be mapped to a new location in the spatial
     grid. The transformed spatial grid is represented as three slicing planes on
     the &#8216;Gradient Field&#8217; panel. The value (color) of the spatial grid equals to
     the spatial location in the direction indicated by &#8216;GradLine&#8217; in &#8216;Gradient
     Simulation&#8217; panel.
     </p></li>
     <li 
  class="enumerate" id="x10-127011x5">Gradient Simulation Control <br 
class="newline" />
     <!--l. 3516--><p class="noindent" >The &#8216;Display&#8217; and &#8216;Grid&#8217; tab on the &#8216;Gradient Simulation&#8217; panel contains
     parameters for controlling gradient field display.
</p>
         <ul class="itemize1">
         <li class="itemize">Colormap : The colormap for the spatial grid, includes &#8216;Jet&#8217;, &#8216;Gray&#8217;
         and &#8216;Hot&#8217;
         </li>
         <li class="itemize">Plane : The flag for activating grid slicing plane, includes &#8216;XY&#8217;, &#8216;XZ&#8217;
         and &#8216;YZ&#8217;
         </li>
         <li class="itemize">GradLine : The flag for activating gradient sequence line, includes
         &#8216;GzSS&#8217;, &#8216;GyPE&#8217; and &#8216;GxR&#8217;
         </li>
         <li class="itemize">DispMode : The display mode, includes &#8216;Gradient&#8217;, &#8216;Grid&#8217; and &#8216;Both&#8217;
         </li>
         <li class="itemize">XDimRes (m) : The display spatial resolution in X direction
         </li>
         <li class="itemize">YDimRes (m) : The display spatial resolution in Y direction
         </li>
         <li class="itemize">ZDimRes (m) : The display spatial resolution in Z direction</li></ul>
     </li></ol>
<!--l. 3530--><p class="indent" >   MRiLab provides a group of grid display button to help inspect the grid details.
The grid display button group consists of:
</p>
     <ul class="itemize1">
     <li class="itemize">S+ : Move active grid slicing plane forwards
     </li>
     <li class="itemize">S- : Move active grid slicing plane backwards</li></ul>

   <h4 class="subsectionHead"><span class="titlemark">5.6.2   </span> <a 
 id="x10-1280005.6.2"></a>Gradient Element Macro Library</h4>
<!--l. 3540--><p class="noindent" >A gradient element macro is a predefined module for creating a gradient element
that generates gradient field in three dimensional space. MRiLab gradient
element macro library is a collection of gradient element macros. This section
will give an introduction to each of the gradient element macro provided in
MRiLab.
</p><!--l. 3542--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1290005.6.2"></a>GradLinear</h5>
<!--l. 3544--><p class="noindent" >A gradient element macro that creates a linear gradient field. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">GradZ :  A constant  of  gradient  field  vector  in  Z direction,  1  for  unit
     gradient
     </li>
     <li class="itemize">GradY : A constant of gradient field vector in Y direction, 1 for unit
     gradient
     </li>
     <li class="itemize">GradX : A constant of gradient field vector in X direction, 1 for unit
     gradient
     </li>
     <li class="itemize">GradLine : A gradient sequence line assigned to this gradient field</li></ul>
<!--l. 3554--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1300005.6.2"></a>GradSymbolic</h5>
<!--l. 3556--><p class="noindent" >A gradient element macro that creates a gradient field based on symbolic equation.
This macro contains attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">GradZEqu : An equation for gradient field vector in Z direction
     </li>
     <li class="itemize">GradYEqu : An equation for gradient field vector in Y direction

     </li>
     <li class="itemize">GradXEqu : An equation for gradient field vector in X direction
     </li>
     <li class="itemize">GradLine : A gradient sequence line assigned to this gradient field</li></ul>
<!--l. 3565--><p class="indent" >   The symbolic equation could be any legal Matlab equation using variables &#8216;X&#8217;, &#8216;Y&#8217;
and &#8216;Z&#8217;. For example, &#8216;X+Y&#8217;, &#8216;2*X.*Y&#8217; and &#8216;2*sin(X)&#8217; etc. Notice that use element
operations for variables in the equation. The user needs to fill the equation between a
pair of single quotes.
</p><!--l. 3567--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1310005.6.2"></a>GradUser</h5>
<!--l. 3569--><p class="noindent" >If the user has gradient field data saved in a MAT file, the user can easily import the
gradient field into MRiLab gradient design interface by using &#8216;GradUser&#8217;
macro. The gradient field MAT file needs to contain one four dimensional
matrix &#8216;G&#8217; with the size of the fourth dimension equal to 3. G(:,:,:,1) is the
<!--l. 3569--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
component of the gradient vector, G(:,:,:,2) is the
<!--l. 3569--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
component of the gradient vector and G(:,:,:,3) is the
<!--l. 3569--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>z</mi></math>
component of the gradient vector. The &#8216;GradUser&#8217; macro contains attributes
including:
</p>
     <ul class="itemize1">
     <li class="itemize">GradFile : The path to the file that stores the gradient field data, quoted
     using single quotes
     </li>
     <li class="itemize">Interp : The interpolation method, includes &#8216;linear&#8217;, &#8216;nearest&#8217; and &#8216;cubic&#8217;
     </li>
     <li class="itemize">GradLine : A gradient sequence line assigned to this gradient field</li></ul>
<!--l. 3578--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.6.3   </span> <a 
 id="x10-1320005.6.3"></a>Make New Gradient</h4>
<!--l. 3580--><p class="noindent" >The user can also use the gradient loading function to load another gradient. To load
a gradient, click &#8216;Load&#8217; menu then click &#8216;Load Gradient File&#8217;, choose a gradient XML
file.<br 
class="newline" />

</p><!--l. 3582--><p class="indent" >   The user can create a new gradient in the Gradient Design interface. To create a
new gradient, click &#8216;New&#8217; then click &#8216;Create Gradient File&#8217;. A gradient creation
window will show up and ask for new gradient name and notes. To follow MRiLab
naming convention, the user is recommended to use &#8216;Grad_&#8217; followed by a legal string
and applied anatomy (e.g. Grad_CustomHead), make sure that the new gradient
name differs from the existing gradient names in MRiLab. Then click &#8216;OK&#8217; to select a
path for storing the gradient XML file. It&#8217;s strongly recommended to put the
gradient under the MRiLab gradient root folder /MRiLab/Config/Grad
according to the gradient type so that the gradient is visible to MRiLab.
Finally, MRiLab will create a new gradient XML file based on the content of
&#8216;Grad_LinearHead&#8217;.
</p><!--l. 3585--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.7   </span> <a 
 id="x10-1330005.7"></a>Motion Design</h3>
<!--l. 3587--><p class="noindent" >The Motion Design toolbox can be activated by pressing &#8216;Motion Design Panel&#8217;
toolbar icon located at the top of the main simulation console.
</p>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-13300148"></a>


<!--l. 3591--><p class="noindent" ><img 
src="Pictures/MotionDesignPanelIcon.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.48: </span><span  
class="content">Motion Design Panel Toolbar Icon</span></div><!--tex4ht:label?: x10-13300148 -->

   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">5.7.1   </span> <a 
 id="x10-1340005.7.1"></a>Motion Design Panel</h4>
   <hr class="figure" /><div class="figure" 
>

<a 
 id="x10-13400149"></a>


<!--l. 3600--><p class="noindent" ><img 
src="Pictures/MotionDesignGUI.png" alt="pict"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;5.49: </span><span  
class="content">Motion Design Panel</span></div><!--tex4ht:label?: x10-13400149 -->

   </div><hr class="endfigure" />
<!--l. 3605--><p class="indent" >   Figure <a 
href="#x10-13400149">5.49<!--tex4ht:ref: fig:MotionDesignGUI --></a> demonstrates an overview of the Motion Design interface. This
interface consists of
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x10-134003x1">Motion Element Macro Library <br 
class="newline" />
     <!--l. 3610--><p class="noindent" >The Motion Element Macro Library contains motion element macros for
     constructing motion structure in MRiLab. The user needs to click the
     &#8216;MotElem&#8217; root to unfold subsequent macros.
     </p></li>
     <li 
  class="enumerate" id="x10-134005x2">Motion Structure <br 
class="newline" />
     <!--l. 3615--><p class="noindent" >In MRiLab, a motion structure consists of arbitrary number of motion
     elements that are combined to create desired motion pattern. The user
     can construct desired motion pattern by changing the content within the
     motion structure. To add a macro into the motion structure, the user
     needs to click one macro in the macro library, then click on the motion
     structure root (i.e. MRiLabMot) to which this macro is inserted, then click
     &#8216;+&#8217; macro operation button. To delete a macro from the motion structure,
     the user needs to click the unwanted macro, then click &#8216;-&#8217; macro operation
     button. To duplicate an existing macro, the user needs to first click the
     source macro, then click &#8216;C&#8217; macro operation button for copying, click
     on the motion structure root, then click &#8216;P&#8217; macro operation button for
     pasting. MRiLab doesn&#8217;t allow empty motion structure.
     </p></li>
     <li 
  class="enumerate" id="x10-134007x3">Motion Element Attribute <br 
class="newline" />
     <!--l. 3620--><p class="noindent" >Upon clicking on the motion element macro within the motion structure,
     the corresponding macro attributes will be shown at the motion element
     attribute panel down below the motion structure. The user can edit those
     attributes to modify the motion element so as to generate different motion
     pattern. To make any modification effective, the user must press &#8216;Update&#8217;
     button to update the motion file. Pressing &#8216;Execute&#8217; button will update
     and recalculate the motion track.
     </p></li>
     <li 
  class="enumerate" id="x10-134009x4">Motion Tracker <br 
class="newline" />
     <!--l. 3624--><p class="noindent" >MRiLab uses Matlab Simulink 3D Animation to monitor the movement
     track of an imaging object in a motion tracker window. To open this
     window, the user needs to press &#8216;3D Play&#8217; button. In the 3D animation, the
     imaging object is represented as a sphere or ellipsoid attached with three
     small spheres indicating axis directions (red for <!--l. 3624--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>

     axis, green for <!--l. 3624--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
     axis and blue for <!--l. 3624--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>z</mi></math>
     axis).
     </p></li>
     <li 
  class="enumerate" id="x10-134011x5">Motion Simulation Control <br 
class="newline" />
     <!--l. 3628--><p class="noindent" >The &#8216;Display&#8217; and &#8216;Replay&#8217; tab on the &#8216;Motion Simulation&#8217; panel contains
     parameters for controlling 3D animation.
</p>
         <ul class="itemize1">
         <li class="itemize">Object : The object model, currently only supports &#8216;Sphere&#8217;
         </li>
         <li class="itemize">ViewPoint : A default view point, includes &#8216;ZPos&#8217;, &#8216;YPos&#8217; and &#8216;XPos&#8217;
         </li>
         <li class="itemize">ZoomOut : A factor of view zoom out
         </li>
         <li class="itemize">Sample : The sample steps between two adjacent positions during
         movement
         </li>
         <li class="itemize">Repeat : The repeat time of playback</li></ul>
     </li></ol>
   <h4 class="subsectionHead"><span class="titlemark">5.7.2   </span> <a 
 id="x10-1350005.7.2"></a>Motion Element Macro Library</h4>
<!--l. 3643--><p class="noindent" >A motion element macro is a predefined module for creating a motion element that
generates a movement track in three dimensional space. MRiLab motion
element macro library is a collection of motion element macros. This section
will give an introduction to each of the motion element macro provided in
MRiLab.
</p><!--l. 3645--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1360005.7.2"></a>MotTranslate</h5>
<!--l. 3647--><p class="noindent" >A motion element macro that creates translation motion. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The motion starting time

     </li>
     <li class="itemize">tEnd (s) : The motion ending time
     </li>
     <li class="itemize">dt (s) : The time interval of the motion track sample steps
     </li>
     <li class="itemize">Direction : A vector describing translation direction in 3D space
     </li>
     <li class="itemize">Displacement (m) : An equation of translation displacement pattern with
     respect to time</li></ul>
<!--l. 3657--><p class="indent" >   The displacement equation could be any legal Matlab equation using variables &#8216;t&#8217;.
For example, &#8216;2*t&#8217;, &#8216;t+200e-3&#8217; and &#8216;0.05*sin(0.1*t)&#8217; etc. Notice that the user needs to
fill the equation between a pair of single quotes.
</p><!--l. 3660--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1370005.7.2"></a>MotRotate</h5>
<!--l. 3662--><p class="noindent" >A motion element macro that creates rotation motion. This macro contains
attributes including:
</p>
     <ul class="itemize1">
     <li class="itemize">tStart (s) : The motion starting time
     </li>
     <li class="itemize">tEnd (s) : The motion ending time
     </li>
     <li class="itemize">dt (s) : The time interval of the motion track sample steps
     </li>
     <li class="itemize">Axis : A vector describing rotation axis in 3D space
     </li>
     <li class="itemize">Angle (rad) : An equation of rotation angle with respect to time</li></ul>
<!--l. 3672--><p class="indent" >   The rotation angle equation could be any legal Matlab equation using variables
&#8216;t&#8217;. For example, &#8216;2*t&#8217;, &#8216;t+200e-3&#8217; and &#8216;sin(0.1*t)&#8217; etc. Notice that the user needs to
fill the equation between a pair of single quotes.

</p><!--l. 3675--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.7.3   </span> <a 
 id="x10-1380005.7.3"></a>Make New Motion</h4>
<!--l. 3677--><p class="noindent" >The user can also use the motion loading function to load another motion. To load a
motion, click &#8216;Load&#8217; menu then click &#8216;Load Motion File&#8217;, choose a motion XML
file.<br 
class="newline" />
</p><!--l. 3679--><p class="indent" >   The user can create a new motion in the Motion Design interface. To create a new
motion, click &#8216;New&#8217; then click &#8216;Create Motion File&#8217;. A motion creation window will
show up and ask for new motion name and notes. To follow MRiLab naming
convention, the user is recommended to use &#8216;Mot_&#8217; followed by a legal string and
applied anatomy (e.g. Mot_CustomHead), make sure that the new motion name
differs from the existing motion names in MRiLab. Then click &#8216;OK&#8217; to select a path
for storing the motion XML file. It&#8217;s strongly recommended to put the motion
under the MRiLab motion root folder /MRiLab/Config/Mot according to the
motion type so that the motion is visible to MRiLab. Finally, MRiLab will
create a new motion XML file based on the content of &#8216;Mot_ShiftHead&#8217;.
<br 
class="newline" />
</p><!--l. 3681--><p class="indent" >   Note that adding motion pattern is required to stimulate motion, the user also
needs to use extended real time process to trigger motion at the Ext sequence line.
To trigger motion, one or more Ext flag 8 needs to be inserted into Ext line. An
accurate motion tracking can be achieved using both small time interval of the
motion track sample steps and frequent motion triggering, which typically requires
more simulation computing. The interested users are referred to PSD_GRE3D for
more information.
</p><!--l. 3683--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.8   </span> <a 
 id="x10-1390005.8"></a>Image Reconstruction</h3>
<!--l. 3685--><p class="noindent" >MRiLab provides default image reconstruction code for a few types of Cartesian and
Non-Cartesian <span 
class="cmti-10">k</span>-space reconstruction. External reconstruction code is also
acceptable.
</p><!--l. 3687--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.8.1   </span> <a 
 id="x10-1400005.8.1"></a>Default Engine</h4>
<!--l. 3689--><p class="noindent" >To choose default reconstruction for Cartesian readout, the user needs to choose
&#8216;Cartesian&#8217; for &#8216;ReconType&#8217; under the &#8216;Recon&#8217; tab. The Cartesian reconstruction can
be applied to typical Cartesian readout, FSE readout and EPI readout using default
gradient macros. To choose default reconstruction for Non-Cartesian readout, the
user needs to choose &#8216;NonCart&#8217; for &#8216;ReconType&#8217;. The corresponding Non-Cartesian

reconstruction code can be applied to radial readout and spiral readout. Notice
that the Non-Cartesian reconstruction performs 2D gridding process for the
Non-Cartesian <span 
class="cmti-10">k</span>-space trajectory using a Kaiser-Bessel kernel, followed by a regular
iFFT. The 2D gridding process should also in theory be applicable to other
Non-Cartesian readout. Also the &#8216;gridding&#8217; tab is required to perform Non-Cartesian
reconstruction.
</p><!--l. 3692--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.8.2   </span> <a 
 id="x10-1410005.8.2"></a>External Engine</h4>
<!--l. 3694--><p class="noindent" >If the user uses a special <span 
class="cmti-10">k</span>-space trajectory that requires particular reconstruction
code, the user needs to indicate using external reconstruction by changing
&#8216;ReconEng&#8217; to &#8216;External&#8217;, and then provides a reconstruction function quoted
with a pair of single quotes for &#8216;ExternalEng&#8217;. It is recommended to put
the external code under /MRiLab/Src/Recon/External, if not, make sure
the reconstruction code is in Matlab search path. This setting will simply
ignore default reconstruction code and apply external code. It is strongly
recommended to write your own reconstruction code based on the template
:

</p>
   <div class="verbatim" id="verbatim-13">
function&#x00A0;DoCustomRecon
&#x00A0;<br />%Create&#x00A0;an&#x00A0;external&#x00A0;reconstruction&#x00A0;based&#x00A0;on&#x00A0;your&#x00A0;code
&#x00A0;<br />global&#x00A0;VCtl&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VCtl&#x00A0;structure,&#x00A0;read&#x00A0;only
&#x00A0;<br />global&#x00A0;VSig&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VSig&#x00A0;structure,&#x00A0;read&#x00A0;only
&#x00A0;<br />global&#x00A0;VImg&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;%&#x00A0;use&#x00A0;VImg&#x00A0;structure,&#x00A0;read&#x00A0;and&#x00A0;write
&#x00A0;<br />
&#x00A0;<br />%&#x00A0;The&#x00A0;main&#x00A0;code&#x00A0;for&#x00A0;your&#x00A0;reconstruction
&#x00A0;<br />...
&#x00A0;<br />
&#x00A0;<br />%&#x00A0;Store&#x00A0;recon&#x00A0;image&#x00A0;into&#x00A0;VImg&#x00A0;structure
&#x00A0;<br />VImg.Real&#x00A0;=&#x00A0;...;
&#x00A0;<br />VImg.Imag&#x00A0;=&#x00A0;...;
&#x00A0;<br />VImg.Mag&#x00A0;=&#x00A0;...;
&#x00A0;<br />VImg.Phase&#x00A0;=&#x00A0;...;
&#x00A0;<br />VImg.Sx&#x00A0;=&#x00A0;...;
&#x00A0;<br />VImg.Sy&#x00A0;=&#x00A0;...;
&#x00A0;<br />...
&#x00A0;<br />
&#x00A0;<br />end
</div>
<!--l. 3716--><p class="nopar" >
</p><!--l. 3718--><p class="indent" >   Notice that there are two new Virtual Structures (VSig and VImg) in this
template, VSig encapsules acquired MR signal. VImg is declared to store
reconstructed images. For the structure &#8216;VSig&#8217;, MRiLab provides :
</p>
     <ul class="itemize1">
     <li class="itemize">VSig.Sx : A array storing <!--l. 3721--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
     (real) component of acquired MR signal
     </li>
     <li class="itemize">VSig.Sy : A array storing <!--l. 3722--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
     (imaginary) component of acquired MR signal
     </li>
     <li class="itemize">VSig.Kz (1/m) : A array storing Kz location of <span 
class="cmti-10">k</span>-space trajectory
     </li>
     <li class="itemize">VSig.Ky (1/m) : A array storing Ky location of <span 
class="cmti-10">k</span>-space trajectory
     </li>
     <li class="itemize">VSig.Kx (1/m) : A array storing Kx location of <span 
class="cmti-10">k</span>-space trajectory</li></ul>

<!--l. 3728--><p class="indent" >   The sample points in these arrays are organized in the order of <br 
class="newline" />
</p><!--l. 3730--><p class="indent" >   Sample points in one readout <!--l. 3730--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math>
Multiple echos <!--l. 3730--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math> First
phase encoding <!--l. 3730--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math>
Second phase encoding <!--l. 3730--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math>
Coil channel <!--l. 3730--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" > <mo 
class="MathClass-rel">&#x003C;</mo></math>
Spin species <br 
class="newline" />
</p><!--l. 3732--><p class="indent" >   For the structure &#8216;VImg&#8217;, MRiLab provides : </p>
     <ul class="itemize1">
     <li class="itemize">VImg.Real : A matrix for real component of reconstructed complex image
     with a size of <!--l. 3734--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>E</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>T</mi><mi 
>R</mi></math>
     </li>
     <li class="itemize">VImg.Imag : A matrix for imaginary component of reconstructed complex
     image with a size of <!--l. 3735--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>E</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>T</mi><mi 
>R</mi></math>
     </li>
     <li class="itemize">VImg.Mag : A matrix for magnitude of reconstructed complex image with
     a size of <!--l. 3736--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>E</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>T</mi><mi 
>R</mi></math>
     </li>
     <li class="itemize">VImg.Phase : A matrix for phase of reconstructed complex image with a
     size of <!--l. 3737--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>R</mi><mi 
>x</mi><mi 
>C</mi><mi 
>o</mi><mi 
>i</mi><mi 
>l</mi><mi 
>N</mi><mi 
>u</mi><mi 
>m</mi> <mo 
class="MathClass-bin">&#x00D7;</mo> <mi 
>T</mi><mi 
>E</mi><mi 
>P</mi><mi 
>e</mi><mi 
>r</mi><mi 
>T</mi><mi 
>R</mi></math>
     </li>
     <li class="itemize">VImg.Sx : A matrix for <!--l. 3738--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>x</mi></math>
     (real) component of sorted complex MR signal in Cartesian grid
     </li>
     <li class="itemize">VImg.Sy : A matrix for <!--l. 3739--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>y</mi></math>
     (imaginary) component of sorted complex MR signal in Cartesian grid</li></ul>
<!--l. 3742--><p class="indent" >   where <!--l. 3742--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>X</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math>,
<!--l. 3742--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Y</mi> <mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math> and
<!--l. 3742--><math 
 xmlns="http://www.w3.org/1998/Math/MathML"  
display="inline" ><mi 
>R</mi><mi 
>Z</mi><mi 
>D</mi><mi 
>i</mi><mi 
>m</mi></math> are
reconstructed image resolution in three spatial directions.
</p><!--l. 3744--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x10-1420005.8.2"></a>Gadgetron</h5>
<!--l. 3746--><p class="noindent" >If the user are interested in using Gadgetron for image reconstruction, MRiLab also
provides a simple MEX code to convert acquired data into ISMRMRD file
which can be used in Gadgetron process. To activate this function, the user
needs to install ISMRMRD dependency packages to properly run compiled

interface MEX. I am currently working on improving MRiLab support to
Gadgetron recon framework. And I will be very pleased to talk with any
MRiLab users who are willing to contribute to improving MRiLab Gadgetron
support. Please don&#8217;t hesitate to contact me. The ISMRMRD relevant code
is &#8216;DoToHDF5.m&#8217; under /MRiLab/Src/Main and &#8216;DoMatToHDF5&#8217; under
/MRiLab/Lib/src/interface.
</p><!--l. 3748--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5.9   </span> <a 
 id="x10-1430005.9"></a>Simulation Output</h3>
<!--l. 3750--><p class="noindent" >MRiLab can save simulation output into two file formats including &#8216;MAT&#8217; and
&#8216;ISMRMRD&#8217;. The user can choose &#8216;OutputType&#8217; under &#8216;Recon&#8217; tab. If the user
choose &#8216;ISMRMRD&#8217; format, the &#8216;DoMatToHDF5&#8217; MEX has to be functional, if not,
MAT file will be saved instead. MRiLab saves simulation output for each series into a
folder named by MRiLab&#8217;s startup time under /MRiLab/Output folder. For MAT
file, MRiLab saves:
</p>
     <ul class="itemize1">
     <li class="itemize">SeqXMLFile : Applied sequence XML file
     </li>
     <li class="itemize">SeriesName : Series name on the main control console
     </li>
     <li class="itemize">VCtl : Virtual Control structure
     </li>
     <li class="itemize">VImg : Virtual Image structure
     </li>
     <li class="itemize">VSig : Virtual Signal structure</li></ul>

   <!--l. 3760--><div class="crosslinks"><p class="noindent">[<a 
href="MRiLab_User_Guidech6.html" >next</a>] [<a 
href="MRiLab_User_Guidech4.html" >prev</a>] [<a 
href="MRiLab_User_Guidech4.html#tailMRiLab_User_Guidech4.html" >prev-tail</a>] [<a 
href="MRiLab_User_Guidech5.html" >front</a>] [<a 
href="MRiLab_User_Guide3.html#MRiLab_User_Guidech5.html" >up</a>] </p></div>
<!--l. 3760--><p class="indent" >   <a 
 id="tailMRiLab_User_Guidech5.html"></a>  </p> 
</body> 
</html>